this.JST=this.JST||{},this.JST["common/attachment-view-attachment-container"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="attachment-container" title="'+__e(title)+'"><div class="attachment-icon svg-common '+__e(name)+'"></div><div class="attachment-title"><p class="attachment-title-name">'+__e(fileName)+'</p><p class="attachment-title-type">'+__e(fileType)+'</p></div><div class="attachment-size">'+(null==(__t=size)?"":__t)+'</div><div class="attachment-download svg-common"></div><div class="attachment-mask" draggable="'+__e(!!draggable)+'"><div class="attachment-icon svg-common '+__e(name)+'"></div><div class="attachment-title"><p class="attachment-title-name">'+__e(fileName)+'</p><p class="attachment-title-type">'+__e(fileType)+'</p></div><div class="attachment-size">'+(null==(__t=size)?"":__t)+'</div><div class="attachment-download svg-common"></div></div></div>';return __p},this.JST["common/catalogue_view"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="catalogue-header cannot-edit"><div class="catalogue-refresh" title="刷新"><i class="svg-common src--svg--catalogue-refresh"></i></div><div class="catalogue-delete" title="删除"><i class="svg-common src--svg--catalogue_remove"></i></div></div><div class="para-text"></div>';return __p},this.JST["common/color_picker"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="color-picker-panel" tabindex="0"><div class="color-picker-panel-inner"><div class="color-picker-panel-board"><div class="color-picker-panel-board-hsv" style="background-color: rgb(255, 0, 0);"><div class="color-picker-panel-board-value"></div><div class="color-picker-panel-board-saturation"></div></div><span style="left: 126px; top: 93.5px;"></span></div><div class="color-picker-panel-wrap"><div class="color-picker-panel-wrap-ribbon"><div class="color-picker-panel-ribbon"><span style="left: 0%;"></span></div></div><div class="color-picker-panel-wrap-alpha"><div class="color-picker-panel-alpha"><div class="color-picker-panel-alpha-bg" style="background: linear-gradient(to right, rgba(57, 57, 57, 0), rgb(57, 57, 57));"></div><span style="left: 100%;"></span></div></div><div class="color-picker-panel-wrap-preview"><div class="color-picker-panel-preview"><span style="background-color: rgb(57, 57, 57); opacity: 1;"></span></div></div></div><div class="color-picker-panel-wrap" style="height: 40px; margin-top: 6px;"><div class="color-picker-panel-params"><div class="color-picker-panel-params-input"><input type="text" class="color-picker-panel-params-hex" maxlength="6" value="393939"><input type="number" value="57"><input type="number" value="57"><input type="number" value="57"><input type="number" value="100"></div><div class="color-picker-panel-params-lable"><label class="color-picker-panel-params-lable-hex">HEX</label><label class="color-picker-panel-params-lable-number">R</label><label class="color-picker-panel-params-lable-number">G</label><label class="color-picker-panel-params-lable-number">B</label><label class="color-picker-panel-params-lable-alpha">A</label></div></div></div></div></div></div>';return __p},this.JST["common/handwrite-view-container"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="handwrite-container"><img  src="'+(null==(__t=src)?"":__t)+'"/></div><p class="handwrite-copy-hack">select me</p>';return __p},this.JST["common/header-footer"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="header-footer-input" contenteditable="'+(null==(__t=readonly?"false":"true")?"":__t)+'"></div>';return __p},this.JST["common/high_light_item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="high-light-item" style="left: '+(null==(__t=left)?"":__t)+"px; top: "+(null==(__t=top)?"":__t)+"px; height: "+(null==(__t=height)?"":__t)+"px; width: "+(null==(__t=width)?"":__t)+'px;"></div>';return __p},this.JST["common/image-title-input"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="image-title-input" contenteditable="true"style="position: absolute; left: '+__e(left)+"px; top: "+__e(top)+"px; width: "+__e(width)+"px; text-align: "+__e(textAlign)+"; min-height: "+__e(height)+'px;">'+__e(title)+'</div><div class="image-title-placeholder"style="position: absolute; left: '+__e(left)+"px; top: "+__e(top)+"px; width: "+__e(width)+"px; text-align: "+__e(textAlign)+"; min-height: "+__e(height)+'px;">输入标题</div>';return __p},this.JST["common/image-view-image-container"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="image-container"><img ',(width||height)&&(__p+=' class="filter-blur" '),__p+=' src="'+(null==(__t=src)?"":__t)+'"',width&&height?__p+=' style="width: '+__e(width)+"px; height: "+__e(height)+'px;"':width&&(__p+=' style="width: '+__e(width)+'px; height: auto;"'),__p+='/><div class="resize-handle" data-corner="0"></div><div class="resize-handle" data-corner="1"></div><div class="resize-handle" data-corner="2"></div><div class="resize-handle" data-corner="3"></div><div class="menu-wrapper"><div class="yne-button-group"><div class="yne-button-item yne-last" data-button-name="menu" title="快捷菜单"><span class="yne-button svg-common">快捷菜单</span><span class="yne-arrow-down svg-common"></span></div><div class="yne-clear"></div></div><ul class="yne-popup-menu"><li class="yne-popup-item" data-cm-name="image-title"><span>标题</span></li><li class="yne-popup-item" data-cm-name="float-left"><span>左浮动</span></li><li class="yne-popup-item" data-cm-name="float-right"><span>右浮动</span></li><li class="yne-popup-item" data-cm-name="clear-float"><span>清除浮动</span></li><li class="yne-popup-item" data-cm-name="clear-resize"><span>清除缩放</span></li>',hasOCR&&(__p+='<li class="yne-popup-item" data-cm-name="image-ocr"><span>文本识别OCR</span></li>'),__p+='<li class="yne-popup-item yne-popup-split"></li><li class="yne-popup-item" data-cm-name="delete"><span>删除图片</span></li><li class="yne-popup-item" data-cm-name="download"><span>另存为</span></li></ul></div></div><div class="image-title"></div><div class="image-split"></div><p class="image-copy-hack">select me</p>';return __p},this.JST["common/link_view"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="hover-menu hover-menu-show-link"><div class="hover-menu-before"></div><div class="hover-menu-body"><a href="'+(null==(__t=link)?"":__t)+"\" target='_blank'><span>"+(null==(__t=link)?"":__t)+"</span></a>",isReadOnly||(__p+='<div class="link-button"><span class="link-modify-button">编辑</span><span class="link-split">|</span><span class="link-remove-button">移除</span></div>'),__p+='</div></div><div class="hover-menu hover-menu-modify-link"><div class="hover-menu-before"></div><div class="hover-menu-body"><span class="link-label">链接</span><input class="link-input" type="text" name="link" value="'+(null==(__t=link)?"":__t)+'" /><div class="link-confirm-button"><span class="link-button-text">确定</span></div></div></div>';return __p},this.JST["common/list_item_view"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)isOrdered?__p+='<ol class="li-box"><li><div class="para-text"></div></li></ol>':__p+='<ul class="li-box"><li><div class="para-text"></div></li></ul>';return __p},this.JST["common/page_break_view"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="page-break"><span class="spanMark topSpan"></span><span class="spanMark middleSpan"></span><span class="spanMark bottomSpan"></span></div>';return __p},this.JST["common/paragraph_view"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="para-text"></div>';return __p},this.JST["common/table_cell_edit"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="cell-edit-box" contenteditable="true"></div>';return __p},this.JST["common/table_cell_resize"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="resize-up"></div><div class="resize-right"></div><div class="resize-down"></div><div class="resize-left"></div>';return __p},this.JST["common/table_view"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="table-layout"><div class="table-layout-inner" contentEditable="false"><div class="table-wrapper"><table><colgroup></colgroup><tbody></tbody></table><div class="row-resize-line"></div><div class="col-resize-line"></div></div></div></div>';return __p},this.JST["common/todo"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="todo-content"><label class="todo-mark" contenteditable="false"><span class="todo-inner"></span></label><div class="todo-input para-text"></div></div>';return __p},this.JST["pc/float-modifiers-li"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)for(index in allAttendees)__p+='<li id="'+(null==(__t=allAttendees[index].SID)?"":__t)+'" class="attendee"><span class="phote">',allAttendees[index].portrait?__p+='<i class="portrait" style="background-image:url('+(null==(__t=allAttendees[index].portrait)?"":__t)+');"></i>':__p+='<i class="portrait" style="background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAAGvZ15GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUMzMzk1NzA1NDNFMTFFNTk5MURCMjJEMUNENUZFOTUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUMzMzk1NkY1NDNFMTFFNTk5MURCMjJEMUNENUZFOTUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RUNCQThDMTFDNDhBMTFERjg4MThCMUU5Rjk4RDBCMjQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RUNCQThDMTJDNDhBMTFERjg4MThCMUU5Rjk4RDBCMjQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4YtSJRAAAGIUlEQVR42lSKQQrAMAgEay1+IuBB//8l8eYnEhNLQqEDe9jZBTO7/tyV3jsittbmnEdVZ2YiEpGjAGDvm6dS3d3rm5mvGmOo6neJiCWAGNFsBOoAmfX7929ubm4mMIAaz87OLiYmJi8vj3DXfzCAMKA2Ai2CmAjRyMLKygp0N9z4hw8fAgQgg4xRAAZCIIghjY0/EO7/z7L0AdYZMJhcYnEcy6KzK/+Mn2Hb2T94OyhvK1WVmU8PXQVXxsGo6jRxjEqLEbGhiGwmmM3szbvW6iB3PK64+2COD5FlJLsEYJSMVSAGgSB6iIWIlVaKjeD//5SV2Aq292CPDYQLdxbBJOPM7Iw/phNF8/pjXdNZa9HKOaeUJHJyuTxJTtSDCf4550II2ODYPYJSymXCmFqrMj16gvgL095bpXmOMe5MWKEpQmfDEGst9pq41TxYVAFCRkNLcVaL45bjV75yxc45c86PHO9o996lKaEB6r1vrYkBAz+IpxljjIDeApBSBisMg0AQBcm1eBL//+dCLp5E0Fzalw4YWaWldA/BtHF2HWfmuzI/Fz2ZxXXB/F/bDM9BMCcyDSF0NlU5ZxgnE87zhEZ5fgHEH8JSgoizEevxLtKBTiOKlYn2YD6h9F+MmWOMMyduJq+1ZrqZD7h2M+liIp1u3/dlsPBMKR3HwUSm2YIjiQ958pSvNCZMq5lQzEQWCHbYz5qF955ghTKNwxon1VphWglmI/x+2TaSST7p34EuRpiO1Os3gA5KKffeywLO0YQU4RTjZc1XNhaR37PyAlEWMTYozx8LlyJaSeElAPPlsqsgEATRaPgASPj/v2NN2LvwOAfLEXEI8S7uJCboOD39qKpufuVaxPHPuPb/DG1xZO2VGJ6HYUCb+bosCyCiMtQI6j+S8g7ubpMzscO/x3GE6NkCRBQIpYZoQBQT4Lam7g7X7ExiKvOA7YV2lcMt0oILtjEBgjPEeGAdLLoOHNoWWoa8VjFPc9nc76hwQFoPpO19xV6JbmNrRyEPlyZq6u8nG6FoWLmVZbttJRu3qXF9uZnOA9eIkgOp5R/gbZ7n5D5Z93C2WlIbc+CYY5Qvai2gp2nyWRX7qpDr+Fq8WMoC3FCEkBXZFPQz2d1naCZSiCP4TJ5OGnEk0G2FhglJBLgDcSdsFBqjBIjdeuzZZz8m0H/ga9vJFr/QVIgUp8g3nrZy1Pc9tNRcXfLXKFzGLGQAi7TJt/ITCwGr/+vIVNFVvy7PFT2gArw1mDJVbO2ZeA6tLycXmmWzfKSVD5kjfst0alENzvqKcbVHq6enBb/IMQvv7gK0Y0YrDcRAFJVSHwTf+///ty2lTyIoHnPqJSTbZbNW8cEBl1WT7M1k5s6d3KeufUeCRv96HruHP2b/gIbqfq9fm6qjtKR0k5S0PCRVf+gMhmYgG3gQ+cpE4p1nKKfn+lWADDE7P8mBF3oTKCZcyx+9v0h7Jmk+FWMk2TxNE/RsyRVTaHMMkAgslsyXG7E4z6UjtU2TYHUMs5A0lEi4VKYMAw/HkH2YX5KpRKMP4vOMaa4WHCPpwsmQLiNxWH8DsRZQzQ08lX8zmuGr257VMXKdheCxWLOBLVkmjUZEjGZNakr207d4awHpIWPI/NrCK7vrTVpuRpY3tgrQa7F6xSFjLtre6R5Zc+5rAb0VY4sENc3m+Xy+hem9WBOCRi6uvVwup9OJRerLmy08VDsWKKzLRskXiK6molxp1imtzIQY2YZXHgteWQXIHeeizWRhaRQVaMAEXyM2TJxABx8gXorxoriRsZo1hwFlZs4ixM9X/WRyONowv0bR19PrFYaZutbYyRQMxzRysm4D8+7TKnEVOsVEsyWGoulV+RwNWpmCyjE1m0uQ9u0oc5X0PL3OktVY5BaPLMVQ2gZw5Ph6V/c4ahKyN7d0AMuuww5/DNDhcGAfuTFMoV4m/tn6Iykw97kYaMBEzs4Dsj+Sciw9eMXcnu3Xh6pHkrT2q+KE3SIBAJebPoNkb03eF+OF0wEN/lyIu7sYruIrx+MRb5k3ItubCMSdUhCNIbX8gv7HSXwOL6TSfQLiB22gWDHQ+J+XUz8NiKgwQ3nx1DilD+SpF4rN641ZAAAAAElFTkSuQmCC);"></i>',__p+='<i class="color-bg"></i><i class="color" style="background-color:'+(null==(__t=allAttendees[index].color)?"":__t)+';"></i></span><span class="nickname">'+(null==(__t=allAttendees[index].nickname)?"":__t)+"</span></li>";return __p},this.JST["pc/float-modifiers"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="attendee-dialog"><div id="attendee-hint"><i id="attendee-icon"></i><span id="attendee-num"><span id="attend-num-span">1</span><span>人正在编辑</span></span></div><ul id="attendee-list"></ul></div>';return __p},this.JST["pc/presenter_article"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<h1 style="text-align: center; font-size: 48px; margin-top: 100px; margin-bottom: 100px;">'+(null==(__t=title)?"":__t)+'</h1><article class="editor-area"ng-mouseover="over()"ng-mouseleave="leave()"style="padding: 10px 0 10px 0;">'+(null==(__t=content)?"":__t)+"</article>";return __p},this.JST["pc/presenter_page"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="demo-page"><iframe frameborder="none" class="note-content"></iframe><div class="tool-bar" ng-class="{show : inDemoArea}"><div><i class="demo-mode-icon zoom-in-icon" title="放大" data-action="zoom-in"></i></div><div><i class="demo-mode-icon zoom-out-icon" title="缩小" data-action="zoom-out"></i></div><div><i class="demo-mode-icon esc-icon" title="退出" data-action="esc"></i></div></div></div>';return __p},this.JST["pc/toolbar-button-template"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="button-wrapper button-wrapper-'+(null==(__t=name)?"":__t)+'" title="'+(null==(__t=label)?"":__t)+'"><div class="button button-'+(null==(__t=name)?"":__t)+' svg-common"></div><div class="button-text" ',text||(__p+=' style="display:none;" '),__p+=" >"+(null==(__t=text)?"":__t)+"</div></div>";return __p},this.JST["pc/toolbar-combo-box-align"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span>',text&&(__p+='<span class="combo-text combo-text-'+(null==(__t=name)?"":__t)+'">'+__e(text)+"</span>"),__p+='</div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><ul class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'">';for(key in items)__p+='<li class="combo-item" data-value="'+(null==(__t=key)?"":__t)+'"><span class="combo-item-icon-'+(null==(__t=name)?"":__t)+" "+(null==(__t=key)?"":__t)+' svg-common">&nbsp;</span><span class="combo-item-span-'+(null==(__t=name)?"":__t)+'">'+(null==(__t=items[key])?"":__t)+"</span></li>";__p+="</ul></div>"}return __p},this.JST["pc/toolbar-combo-box-back-color"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value svg-common combo-value-'+(null==(__t=name)?"":__t)+'"><span class="combo-value-buttom-color"></span></span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><div class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'"><div class="color-section color-section-default combo-item" data-value="'+(null==(__t=defaultValue)?"":__t)+'"><div class="color-cell combo-item back-color-cell-default" data-value="'+(null==(__t=defaultValue)?"":__t)+'" style="background-color:'+(null==(__t=defaultValue)?"":__t)+';"></div><div class="color-label color-label-default">默认无背景色</div></div><hr class="color-section-split"><div class="color-section color-section-theme"><div class="color-label color-label-theme">主题颜色</div><div class="color-row">';for(key in items.theme)__p+='<div class="color-cell combo-item" data-value="'+(null==(__t=items.theme[key])?"":__t)+'" style="background-color:'+(null==(__t=items.theme[key])?"":__t)+';"></div>';__p+='</div><div class="color-row-split"></div><div class="color-part-theme">';for(row in items.other){__p+='<div class="color-row">';for(key in items.other[row])__p+='<div class="color-cell combo-item" data-value="'+(null==(__t=items.other[row][key])?"":__t)+'" style="background-color:'+(null==(__t=items.other[row][key])?"":__t)+';"></div>';__p+="</div>"}__p+='</div></div><hr class="color-section-split"><div class="color-section color-section-standard"><div class="color-label color-label-standard">推荐颜色</div><div class="color-row">';for(key in items.standard)__p+='<div class="color-cell combo-item" data-value="'+(null==(__t=items.standard[key])?"":__t)+'" style="background-color:'+(null==(__t=items.standard[key])?"":__t)+';"></div>';__p+='</div></div><hr class="color-section-split"><div class="color-section color-section-other combo-item"><div class="color-img-other"></div><div class="color-label color-label-other">其他颜色</div><div></div></div>'}return __p},this.JST["pc/toolbar-combo-box-color"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"><span class="combo-value-buttom-color"></span></span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><div class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'"><div class="color-section color-section-default combo-item" data-value="'+(null==(__t=defaultValue)?"":__t)+'"><div class="color-cell combo-item color-cell-default" data-value="'+(null==(__t=defaultValue)?"":__t)+'" style="background-color:'+(null==(__t=defaultValue)?"":__t)+';"></div><div class="color-label color-label-default">默认颜色</div></div><hr class="color-section-split"><div class="color-section color-section-theme"><div class="color-label color-label-theme">主题颜色</div><div class="color-row">';for(key in items.theme)__p+='<div class="color-cell combo-item" data-value="'+(null==(__t=items.theme[key])?"":__t)+'" style="background-color:'+(null==(__t=items.theme[key])?"":__t)+';"></div>';__p+='</div><div class="color-row-split"></div><div class="color-part-theme">';for(row in items.other){__p+='<div class="color-row">';for(key in items.other[row])__p+='<div class="color-cell combo-item" data-value="'+(null==(__t=items.other[row][key])?"":__t)+'" style="background-color:'+(null==(__t=items.other[row][key])?"":__t)+';"></div>';__p+="</div>"}__p+='</div></div><hr class="color-section-split"><div class="color-section color-section-standard"><div class="color-label color-label-standard">推荐颜色</div><div class="color-row">';for(key in items.standard)__p+='<div class="color-cell combo-item" data-value="'+(null==(__t=items.standard[key])?"":__t)+'" style="background-color:'+(null==(__t=items.standard[key])?"":__t)+';"></div>';__p+='</div></div><hr class="color-section-split"><div class="color-section color-section-other combo-item"><div class="color-img-other"></div><div class="color-label color-label-other">其他颜色</div><div></div></div>'}return __p},this.JST["pc/toolbar-combo-box-font-family"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><ul class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'">';for(font in items)__p+='<li class="combo-item" data-value="'+(null==(__t=items[font].singleValue)?"":__t)+'"><span style="font-family:'+(null==(__t=items[font].fullValue)?"":__t)+';">'+(null==(__t=items[font].name)?"":__t)+"</span></li>";__p+="</ul></div>"}return __p},this.JST["pc/toolbar-combo-box-font-size"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><ul class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'">';for(key in items)__p+='<li class="combo-item" data-value="'+(null==(__t=key)?"":__t)+'"><span>'+(null==(__t=items[key])?"":__t)+"</span></li>";__p+="</ul></div>"}return __p},this.JST["pc/toolbar-combo-box-heading"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+'"></span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><ul class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'">';for(key in items)__p+='<li class="combo-item" data-value="'+(null==(__t=key)?"":__t)+'"><span style="font-size: '+(null==(__t=items[key]["font-size"])?"":__t)+'px">'+(null==(__t=items[key].name)?"":__t)+"</span></li>";__p+="</ul></div>"}return __p},this.JST["pc/toolbar-combo-box-insert-link"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="combo-display-wrapper combo-link-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper combo-value-wrapper-'+(null==(__t=name)?"":__t)+'"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span><span class="combo-text" ',text||(__p+=' style="display:none;" '),__p+=" >"+(null==(__t=text)?"":__t)+'</span></div></div><div class="combo-menu-wrapper  wrapper-'+(null==(__t=name)?"":__t)+'"><div class="combo-menu-'+(null==(__t=name)?"":__t)+'"><span class="link-label">链接</span><input class="link-input" type="text" name="link" placeholder="输入链接" /><div class="link-button"><span class="link-button-text">确定</span></div></div></div>';return __p},this.JST["pc/toolbar-combo-box-line-height"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><ul class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'">';for(idx in items)__p+='<li class="combo-item" data-value="'+(null==(__t=items[idx].key)?"":__t)+'"><span class="combo-item-icon-'+(null==(__t=name)?"":__t)+" line-height-"+(null==(__t=idx)?"":__t)+'">&nbsp;</span><span class="combo-item-span-'+(null==(__t=name)?"":__t)+'">'+(null==(__t=items[idx].value)?"":__t)+"</span></li>";__p+="</ul></div>"}return __p},this.JST["pc/toolbar-combo-box-set-background"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span><span class="combo-text combo-text-'+(null==(__t=name)?"":__t)+'">纸张背景</span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><div class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'"><div class="background-section-top">';for(row in items.normalUser){__p+='<div class="background-row">';for(key in items.normalUser[row])"NoBackground"===items.normalUser[row][key]?__p+='<div class="background-cell combo-item" data-value="'+(null==(__t=items.normalUser[row][key])?"":__t)+'"><svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg></div>':__p+='<div class="background-cell combo-item" data-value="'+(null==(__t=items.normalUser[row][key])?"":__t)+'" style="background-image:url(\''+(null==(__t=items.normalUser[row][key])?"":__t)+'\');"><svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg></div>';__p+="</div>"}__p+='</div><hr class="background-section-split"><div class="background-section-bottom"><div class="background-label background-label-vip">会员特权</div>';for(row in items.VIP){__p+='<div class="background-row">';for(key in items.VIP[row])"NoBackground"===items.VIP[row][key]?__p+='<div class="background-cell combo-item" data-value="'+(null==(__t=items.VIP[row][key])?"":__t)+'"><svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg></div>':__p+='<div class="background-cell combo-item" data-value="'+(null==(__t=items.VIP[row][key])?"":__t)+'" style="background-image:url(\''+(null==(__t=items.VIP[row][key])?"":__t)+'\');"><svg class="background-cell-check-mark" xmlns="http://www.w3.org/2000/svg" viewBox="-16 -16 52 52"><path d="M1.05584113,8.97696545 C0.884930054,8.78831051 0.877161369,8.59965557 1.03253508,8.41100063 L1.52196226,7.7742902 C1.6617986,7.56991402 1.84047836,7.53847153 2.05800155,7.67996273 L6.39292802,10.6748599 C6.79689966,10.9421211 7.19310261,10.9185392 7.58153688,10.6041143 L19.1180347,0.982712344 C19.3044832,0.825499894 19.4831629,0.833360516 19.654074,1.00629421 L19.9104406,1.26569475 C20.0813517,1.43862845 20.0813517,1.61942277 19.9104406,1.80807771 L7.53492477,14.5187043 C7.17756524,14.880293 6.8279744,14.8881536 6.48615224,14.5422862 L1.05584113,8.97696545 Z"/></svg></div>';__p+="</div>"}__p+="</div></div></div>"}return __p},this.JST["pc/toolbar-combo-box-show-more"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="toolbar-more-split"></div><div class="combo-display-wrapper combo-showmore-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper combo-value-wrapper-'+(null==(__t=name)?"":__t)+'"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common">更多</span><span class="combo-expand-gray svg-common"></span></div></div><div class="combo-menu-wrapper  wrapper-'+(null==(__t=name)?"":__t)+'"><div class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'"></div></div>';return __p},this.JST["pc/toolbar-combo-box-table"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper combo-display-wrapper-'+(null==(__t=name)?"":__t)+'" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper combo-value-wrapper-'+(null==(__t=name)?"":__t)+'"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span><span class="combo-text" ',text||(__p+=' style="display:none;" '),__p+=" >"+(null==(__t=text)?"":__t)+'</span></div></div><div class="combo-menu-wrapper"><div class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'">';for(var i=0;i<maxRows;i++)for(var j=0;j<maxCols;j++)__p+='<span class="combo-item" data-row="'+(null==(__t=i)?"":__t)+'" data-col="'+(null==(__t=j)?"":__t)+'"></span>';__p+='<div class="combo-menu-label-'+(null==(__t=name)?"":__t)+'">插入表格</div></div></div>'}return __p},this.JST["pc/toolbar-combo-box-template"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="combo-display-wrapper"><div class="combo-value-wrapper"></div><div class="combo-expand-wrapper"></div></div><div class="combo-menu-wrapper"></div>';return __p},this.JST["pc/toolbar-combo-box-zoom"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="combo-display-wrapper" title="'+(null==(__t=label)?"":__t)+'"><div class="combo-value-wrapper"><span class="combo-value combo-value-'+(null==(__t=name)?"":__t)+' svg-common"></span></div><div class="combo-expand-wrapper"><span class="combo-expand svg-common"></span></div></div><div class="combo-menu-wrapper"><ul class="combo-menu combo-menu-'+(null==(__t=name)?"":__t)+'">';for(key in items)__p+='<li class="combo-item" data-value="'+(null==(__t=key)?"":__t)+'"><span>'+(null==(__t=items[key])?"":__t)+"</span></li>";__p+="</ul></div>"}return __p},this.JST["pc/toolbar_view"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="toolbar-container">',
_.each(items,function(a,b){"button"===a.type?__p+='<button class="'+(null==(__t=b)?"":__t)+'" action="'+(null==(__t=a.action)?"":__t)+'" name="'+(null==(__t=a.name)?"":__t)+'" type="button" data-yne-is-block="'+(null==(__t=!!a.block)?"":__t)+'">'+(null==(__t=a.label)?"":__t)+"</button>":"select"===a.type&&(__p+='<select class="'+(null==(__t=b)?"":__t)+'" action="'+(null==(__t=a.action)?"":__t)+'" name="'+(null==(__t=a.name)?"":__t)+'" data-yne-is-block="'+(null==(__t=!!a.block)?"":__t)+'">',_.each(a.options,function(a,b){__p+='<option value="'+(null==(__t=b)?"":__t)+'">'+(null==(__t=a)?"":__t)+"</option>"}),__p+="</select>")}),__p+="</div>";return __p};var yne_jtk_core_L,yne_underscore,yne_jtk_core_Class,yne_pc_convertor_nativeApiInterface,yne_pc_convertor_Bridge,yne_backbone,yne_jtk_core_Base,yne_jquery,yne_underscorestring,yne_common_data_blockTypes,yne_common_util_freeze,yne_common_data_xmlBlockStyleConfig,yne_common_data_supportedBlockStyles,yne_common_util_platform,yne_collaboration_collabUtils,yne_common_data_Block,yne_jtk_web_dom_parseHTML,yne_common_constants,yne_common_util_schemaVersion,yne_common_util_unknownTree,yne_common_util_blockStyles,yne_common_util_formatLocalSource,yne_common_data_Attachment,yne_jtk_core_assert,yne_common_data_xmlFont,yne_tinycolor,yne_common_data_xmlInlineStyleConfig,yne_common_data_supportedInlineStyles,yne_common_util_unknownInlineStyles,yne_common_util_codePointAt,yne_common_util_clearString,yne_common_util_toCharArrayByCodePoint,yne_common_data_RichText,yne_common_fontMaps,yne_common_data_inlineStyleToCss,yne_common_util_xssFilter,yne_common_data_Rich2HtmlConvertor,yne_common_util_convertPlain,yne_common_util_countText,yne_common_data_Paragraph,yne_common_data_Catalogues,yne_common_data_Catalogue,yne_common_util_headingMaps,yne_common_data_Heading,yne_common_data_Hr,yne_common_data_listItemMarker,yne_common_data_List,yne_common_data_ListItem,yne_common_util_parseImgSource,yne_common_data_Image,yne_jtk_web_dom_nodeType,yne_common_data_table_tableCellType,yne_common_data_table_Resource,yne_common_util_xml,yne_common_data_table_AttachmentResource,yne_common_data_table_ImageResource,yne_common_data_table_Lines,yne_common_data_table_tableCellUtil,yne_common_data_table_tableRenderer,yne_common_data_table_resourceClassMap,yne_common_data_table_blockStyleConfig,yne_common_data_table_supportedBlockStyles,yne_common_data_Todo,yne_common_data_table_TableCell,yne_common_data_table_constantConfig,yne_common_data_table_tableUtil,yne_common_data_tableDataCheck_createBlankCell,yne_common_data_tableDataCheck_createBlankTable,yne_common_data_tableDataCheck_size,yne_common_data_tableDataCheck_cellValue,yne_common_data_tableDataCheck_mergeDefaults,yne_common_data_tableDataCheck_mergeCells,yne_common_data_tableDataCheck_checkAndFix,yne_common_util_forEachTimes,yne_common_data_Table,yne_common_data_Unknown,yne_common_data_blockMap,yne_parser_html_handlers_tagHandlers,yne_parser_html_utils_convertColor,yne_parser_html_handlers_styleHandlers,yne_parser_html_handlers_BaseHandler,yne_parser_html_utils_handleParagraphSpaces,yne_parser_html_handlers_ParagraphHandler,yne_parser_html_handlers_DocumentHandler,yne_parser_html_handlers_UnknownHandler,yne_cssom,yne_specificity,yne_parser_html_cssParser_CSSParser,yne_parser_html_Parser,yne_parser_html_mathTags,yne_parser_html_svgTags,yne_parser_html_handlers_AnchorHandler,yne_parser_html_handlers_InlineHandler,yne_parser_html_handlers_BreakHandler,yne_parser_html_handlers_HrHandler,yne_common_data_HandWrite={},yne_parser_html_handlers_ImageHandler,yne_parser_html_handlers_ListHandler,yne_parser_html_handlers_ListItemHandler,yne_parser_html_utils_isWhiteColor,yne_parser_html_handlers_TableHandler,yne_parser_html_handlers_TodoHandler,yne_parser_html_handlers_handlerMap,yne_parser_html_tagConfig,yne_parser_html_mso_ListHandler,yne_parser_html_convert,yne_parser_plain_createRichText,yne_common_commands_link_LinkMatch,yne_parser_plain_parseLine,yne_parser_plain_convert,yne_parser_json_createBlock,yne_parser_json_convert,yne_parser_ocr_convert,yne_parser_Parser,yne_common_data_HeaderFooter,yne_common_util_ListItemNode,yne_common_util_events,yne_common_data_Note,yne_common_util_htmlConvert,yne_pc_util_convertHtmlWithResMap,yne_common_util_isXml,yne_common_util_attachmentParse,yne_common_util_attachmentPresentProcess,yne_common_util_addPrintStyle,yne_pc_convertor_convertorApi,yne_pc_convertor_main;yne_jtk_core_L=function(){for(var a,b=this,c=b.DEBUG||null!=b.logLevel,d=b.console,e={},f=function(){},g="log warn error time timeEnd profile profileEnd".split(" "),h=g.length;--h>=0;)a=g[h],c&&d[a]?e[a]=d[a].bind(d):e[a]=f;return c&&b.alert?e.debugAlert=function(a){b.alert(a)}:e.debugAlert=e.error,e.DEBUG=c,e}(),yne_underscore=function(){var a=window._;if(!a&&window.require&&(a=window.require("underscore")),!a)throw"no `underscore` library";return a}(),yne_jtk_core_Class=function(a){function b(a){var b=this;b.options=c.extend({},a),b.initialize.apply(b,arguments)}var c=yne_underscore,d=function(a,b){var d,e,f=this;return d=a&&c.has(a,"constructor")?a.constructor:function(){return f.apply(this,arguments)},c.extend(d,f,b),e=function(){this.constructor=d},e.prototype=f.prototype,d.prototype=new e,a&&c.extend(d.prototype,a),d.__super__=f.prototype,d};return b.prototype.initialize=function(){},b.extend=d,b}(),yne_pc_convertor_nativeApiInterface={Ready:function(a){},OnConvertSuccess:function(a,b,c){},OnConvertError:function(a,b,c){}},yne_pc_convertor_Bridge=function(a){var b,c=yne_underscore,d=yne_jtk_core_Class,e=yne_jtk_core_L,f=yne_pc_convertor_nativeApiInterface,g=c.keys(f);return b=c.extend({initialize:function(a){var b=this;b._convertor=a.convertor,b._hasReadyRun=!1,b._nativeApiObj=window.YNote||{}},execConvertorApi:function(a,b){var c,d,f=this,g=f._convertor,h="EditorApi."+a;if(e.log("execConvertorApi "+a,b),!g[a])return d="convertor does not implement api: "+a,e.error(d),c;if(e.DEBUG)e.profile(h),e.time(h),c=g[a].apply(g,b);else try{c=g[a].apply(g,b)}catch(b){d="Failed to execute EditorAPI:"+a,e.error(d)}return e.DEBUG&&(e.timeEnd(h),e.profileEnd(h)),c},callNativeApi:function(a,b){var c,d,f=this,h=f._nativeApiObj,i="nativeApi."+a;return-1===g.indexOf(a)?void e.error("The native api ["+a+"] is not in nativeApiInterface.js"):(e.log("Executing native Api:"+a,b),c=h[a],c?(e.DEBUG&&(e.profile(i),e.time(i)),d=c.apply(h,b||[]),e.DEBUG&&(e.timeEnd(i),e.profileEnd(i))):e.error("no native api: "+a),d)},ready:function(){var a=this;a._hasReadyRun||(a._hasReadyRun=!0,a._checkNativeApi(),a._nativeApiObj.Ready(a.execConvertorApi.bind(a)))},_checkNativeApi:function(){var a=this,b=a._nativeApiObj,d=[];c.each(g,function(a){null==b[a]&&(d.push(a),e.error("Native does not implement api: "+a))}),e.DEBUG&&d.length>0&&(d=d.join("\n - "),window.alert("No native apis: \n - "+d))}}),d.extend(b)}(),yne_backbone=function(){var a=window.Backbone;if(!a&&window.require&&(a=window.require("Backbone")||window.require("backbone")),!a)throw"no `backbone` library";return a}(),yne_jtk_core_Base=function(a){var b=yne_backbone,c=yne_underscore,d=yne_jtk_core_Class,e=c.extend({},b.Events);return d.extend(e)}(),yne_jquery=function(){var a=window.jQuery||window.$;if(!a&&window.require&&(a=window.require("jQuery")||window.require("jquery")),!a)throw"no `jQuery` library";return a}(),yne_underscorestring=function(){var a,b=window._;if(!b&&window.require&&(b=window.require("underscore")),!b)throw"no `underscore` library";if(a=b.string||b.str||window.s,!a&&window.require&&(a=window.require("underscore.string")),!a)throw"no `underscore.string` library";return a}(),yne_common_data_blockTypes=function(a){var b=yne_underscore,c={ATTACHMENT:"attachment",BLOCK:"block",CATALOGUE:"catalogue",HANDWRITE:"handwrite",HEADER_FOOTER:"header-footer",HEADING:"heading",HR:"horizontal-line",IMAGE:"image",LIST_ITEM:"list-item",PARAGRAPH:"paragraph",TABLE:"table",TODO:"todo",UNKNOWN:"unknown"},d={getAllBlockTypes:function(){return b.values(c)},getType:function(a){if(a&&a.getType)return a.getType()},isParagraph:function(a){var b=this;return b.getType(a)===b.PARAGRAPH},isParagraphCluster:function(a){var b=this,c=b.getType(a);return c===b.PARAGRAPH||c===b.LIST_ITEM||c===b.HEADING||c===b.CATALOGUE||c===b.TODO},isListItem:function(a){var b=this;return b.getType(a)===b.LIST_ITEM},isAttachment:function(a){var b=this;return b.getType(a)===b.ATTACHMENT},isHeaderFooter:function(a){return this.getType(a)===this.HEADER_FOOTER},isTable:function(a){var b=this;return b.getType(a)===b.TABLE},isImage:function(a){var b=this;return b.getType(a)===b.IMAGE},isHr:function(a){var b=this;return b.getType(a)===b.HR},isUnknown:function(a){return this.getType(a)===this.UNKNOWN},isHeading:function(a){var b=this;return b.getType(a)===b.HEADING},isCatalogue:function(a){var b=this;return b.getType(a)===b.CATALOGUE},isTodo:function(a){return this.getType(a)===this.TODO},isTextBlock:function(a){return this.isParagraphCluster(a)},isTextOrTableBlock:function(a){var b=this;return b.isTextBlock(a)||b.isTable(a)},isHandWrite:function(a){return this.getType(a)===this.HANDWRITE}};return b.extend(d,c),d}(),yne_common_util_freeze=function(a){var b=yne_underscore,c=function(a){var d=b.keys(a);return b.each(d,function(b){var d=a[b];"object"==typeof d&&null!==d&&c(d)}),Object.freeze(a)};return function(a,b){return a&&"object"==typeof a?(b=!1!==b,Object.freeze?b?c(a):Object.freeze(a):a):a}}(),yne_common_data_xmlBlockStyleConfig=function(a){var b=yne_common_data_blockTypes,c=yne_jtk_core_L,d=yne_underscore,e=yne_common_util_freeze,f={align:{type:"Enum",possible:{left:!0,right:!0,center:!0,justify:!0},default:"left"},"line-height":{type:"Number",default:1.75},indent:{type:"Number",default:0},"text-indent":{type:"Number",default:0},width:{type:"Number",default:null},float:{type:"Enum",possible:{none:!0,left:!0,right:!0},default:"none"},height:{type:"Number",default:1},color:{type:"String",default:"#999999"}},g={},h={},i={};return g[b.HR]={width:{type:"Number",default:100}},h[b.PARAGRAPH]=["align","indent","text-indent","line-height"],h[b.LIST_ITEM]=["align","indent","text-indent","line-height"],h[b.HEADING]=["align","indent","text-indent","line-height"],h[b.CATALOGUE]=["align","indent","text-indent","line-height"],h[b.TODO]=["align","indent","text-indent","line-height"],h[b.IMAGE]=["align","width","float","height"],h[b.ATTACHMENT]=["align","float"],h[b.HR]=["align","width","height","color"],d.each(b.getAllBlockTypes(),function(a){h[a]||c.warn("no block style config for block["+a+"]")}),d.each(b.getAllBlockTypes(),function(a){var b={},e=h[a]||[],j=g[a];d.each(e,function(a){j&&j[a]?b[a]=j[a]:f[a]?b[a]=f[a]:c.error("no config for style named ["+a+"]")}),i[a]=b}),c.log("xml block style config",i),e(i)}(),yne_common_data_supportedBlockStyles=function(a){var b,c=yne_underscore,d=yne_common_data_xmlBlockStyleConfig,e=yne_common_data_blockTypes,f=yne_jtk_core_L,g={};return{getConfigsOfBlock:function(a,b){if(!a)return void f.error("parameter is not valid",a);var e=d[a],h={};return b=!1!==b,c.each(e,function(d,e){var f=c.clone(d);b&&g[a]&&null!=g[a][e]&&(f.default=g[a][e]),h[e]=f}),h},getConfig:function(a,b,c){return(this.getConfigsOfBlock(b,c)||{})[a]},isSupport:function(a,b){var c=this.getConfigsOfBlock(b)||{},d=c[a];return d&&null!=d.type},getStyleNamesOfBlock:function(a){var b=this.getConfigsOfBlock(a);return b?c.keys(b):[]},getAllStyleNames:function(){return b||(b=[],c.each(d,function(a){var d=c.keys(a);c.each(d,function(a){-1===b.indexOf(a)&&b.push(a)})})),[].concat(b)},getDefault:function(a,b,c){if(!a||!b)return void f.error("parameter is not valid",a,b);var d=this.getConfigsOfBlock(b,c)||{},e=d[a];return e&&null!=e.default?e.default:void 0},getDefaultsOfBlock:function(a,b){var d=this.getConfigsOfBlock(a,b),e={};return c.each(d,function(a,b){e[b]=a.default}),e},setDefault:function(a,b,d){a&&null!=b||f.error("parameter is not valid",a,b);var h=[];d?h.push(d):h=e.getAllBlockTypes(),c.each(h,function(c){g[c]||(g[c]={}),g[c][a]=b})},reset:function(){g={}}}}(),yne_common_util_platform=function(a){var b=yne_underscore,c=yne_jtk_core_L,d=new RegExp(/^\/yws\/res\/|^https?:\/\/note.youdao.com\/yws\/res/),e=new RegExp(/^\/yws\/api\/group|^https?:\/\/note.youdao.com\/yws\/api\/group/),f={UNKNOWN:-1,WEB_NOTE:1,WEB_GROUP:2,PC:3,IPHONE:4,ANDROID:5,MAC:6},g=window.YNE_PLATFORM||f.UNKNOWN,h=b.keys(f),i={};return f.name=g,b.each(h,function(a){var b=a.toLowerCase(),c=g[a];f["IS_"+a]=g===c||g===b}),g.IS_UNKNOWN&&c.error("The platform is unknown!"),i.isFromWebNote=function(a){return d.test(a)},i.isFromWebGroup=function(a){return e.test(a)},b.extend(f,i),f}(),yne_collaboration_collabUtils=function(){return{newGUID:function(){var a="";return a+=(Math.floor(100*Math.random())+"00").substr(0,2),a+=(Math.floor(100*Math.random())+"00").substr(0,2),a+="-",a+=Date.now().toString()},isCollabCommand:function(a){var b=!1;return null!=a&&null!=a.collabProperties&&(b=a.collabProperties.isCollabCmd),b},isInlineStateSetCommand:function(a){return null!=a.isInlineStateSet&&!0===a.isInlineStateSet()},isGUID:function(a){return!!a&&/^[\w\-]+$/.test(a)}}}(),yne_common_data_Block=function(a){var b,c,d,e=yne_underscore,f=yne_jquery,g=yne_backbone,h=yne_jtk_core_Class,i=yne_common_data_blockTypes,j=yne_common_data_supportedBlockStyles,k=yne_jtk_core_L,l=yne_common_util_platform,m=yne_collaboration_collabUtils;return b={_type:i.BLOCK,_styles:null,_extraInfo:null,_blockId:null,_locked:!1,unknownTree:null,_resourceIds:null,_xmlNodeName:null,_validForCollab:!0,_isReadOnly:!1,initialize:function(){var a=this;a._styles={},null==a._blockId&&(a._blockId=m.newGUID()),a.unknownTree={}},isSupportedBlockStyle:function(a){return j.isSupport(a,this._type)},isEmptyContent:function(){return!1},isEmpty:function(){return!1},setBlockStyle:function(a,b){var c=this,d=j.getConfig(a,c._type);d&&("Enum"===d.type?d.possible[b]||(b=d.default):"Number"!==d.type||e.isNumber(b)?"Boolean"!==d.type||e.isBoolean(b)?e["is"+d.type]&&(e["is"+d.type](b)||(b=b.default)):b="true"===b:(b=null===b||""===b?NaN:Number(b),!isNaN(b)&&b||(b=d.default)),b=b||d.default,c._styles[a]=b,k.log("style-change "+a+": "+b),c.trigger("style-change",a,b))},setBlockStyles:function(a){var b=this;a&&e.each(a,function(a,c){b.setBlockStyle(c,a)})},getBlockStyles:function(){return e.clone(this._styles)},getBlockStyle:function(a,b){var c=this,d=j.getConfig(a,c._type);return d?!0===b?c._styles[a]:c._styles[a]||d.default:null},getDefaultBlockStyles:function(){return j.getDefaultsOfBlock(this._type)},removeBlockStyles:function(){var a=this;a._styles={},a.trigger("styles-reset")},removeAllStyles:function(){this.removeBlockStyles()},toXml:function(a){var b,c,e,f=this,g=f.getId();return null==g?void k.debugAlert("The block has NO id",f):(b=a.createElement(f._xmlNodeName),c=a.createElement(d.TAG_ID_NAME),e=a.createTextNode(g),c.appendChild(e),b.appendChild(c),b)},getType:function(){return this._type},_getChildByTagName:function(a,b){if(a)for(var c=a.childNodes[0];c;){if(c.nodeName&&c.nodeName===b)return c;c=c.nextSibling}},parseIdFromXml:function(a){var b,c,e=this;b=e._getChildByTagName(a,d.TAG_ID_NAME),b&&(c=b.textContent),c||l.IS_ANDROID||(b=e._getChildByTagName(a,d.LEGACY_TAG_ID_NAME))&&(c=b.textContent),null==c?e._validForCollab=!1:e._blockId=c},toJSON:function(){var a=this;return{blockType:a._type,styles:a.getBlockStyles(),blockId:a.getId()}},toHtml:function(){k.error("toHtml() should be implemented by subclass!")},toPlain:function(){k.error("toPlain() should be implemented by subclass!")},countWords:function(){k.error("countWords() should be implemented by subclass!")},setResourceIds:function(a){var b=this;a&&a.length&&(b._resourceIds=a)},getResourceIds:function(){return this._resourceIds},getExtraInfo:function(a){var b,c=this;return c.trigger("get-extra-info",a,function(a){b=a}),b},getDefaultSetFont:function(){var a;return this.trigger("get-default-set-font",function(b){a=b}),a},highlight:function(a,b,c){this.trigger("high-light",a,b,c)},getId:function(){var a=this,b=a._blockId;return null==b&&k.debugAlert("The blockId should NOT be null"),b},setId:function(a){var b=this;if(null==a)return void k.debugAlert("The param blockId should NOT be null");b._blockId=a},setLocked:function(a,b){var c=this;c._locked===a&&b&&!b.lockUpdated||(c._locked=a,c.trigger("locked-change",b))},isLocked:function(){return this._locked},isValidForCollab:function(){return this._validForCollab},resetLockState:function(){this._locked=!1},toCollabJSON:function(){return this.toJSON()},setReadOnly:function(a){this._isReadOnly=!!a},isReadOnly:function(){return this._isReadOnly}},c={TAG_ID_NAME:"coId",LEGACY_TAG_ID_NAME:"id",fromXml:function(){k.error("The fromXml should be implemented by subclass!")},parseResourceList:function(a){var b=[];return f(a).find(">resource-list>resource-mono>res-id").each(function(a,c){var d=f(c).text();(d=f.trim(d))&&b.push(d)}),b}},e.extend(b,g.Events),d=h.extend(b,c)}(),yne_jtk_web_dom_parseHTML=function(){var a=function(a,b){var c,d,e;if(b.implementation&&b.implementation.createHTMLDocument)return c=b.implementation.createHTMLDocument("title"),c.body.innerHTML=a,c;if(e=b.defaultView||window,e.DOMParser){d=new e.DOMParser;try{c=d.parseFromString("","text/html")}catch(a){}if(c)return c.body.innerHTML=a,c}};return function(b,c,d,e){if(e=!0===e,b||e){c=c||document;var f,g,h,i,j=a(b,c);if(j){if(!1!==d)return j.body;for(h=j.body.childNodes,f=h.length,i=[],g=0;g<f;g++)i.push(h[g]);return i}}}}(),yne_common_constants=function(){return{COMPAT:"compat",DEFAULT_BACKGROUND:"NoBackground",INTERM:"interm",INDENT_WIDTH:28,MAX_LIST_ITEM_LEVEL:9,LINE_BREAK:/Windows/.test(window.navigator.userAgent)?"\r\n":"\n",IS_MAC:/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),PLATFORM_LINE_HEIGHT:1.75,PAGE_TYPE_A4:"A4",PAGE_TYPE_B5:"B5",PAGE_TYPE_NONE:"NONE",PAGE_TYPE_TEST:"TEST",PAGE_HEIGHT_A4:1123,PAGE_HEIGHT_B5:945,PAGE_HEIGHT_NONE:Number.MAX_VALUE,PAGE_HEIGHT_TEST:100,PAGE_WIDTH_A4:792,PAGE_WIDTH_B5:663,PAGE_WIDTH_NONE:Number.MAX_VALUE,PAGE_WIDTH_TEST:792,PAGE_SPLIT_BLANK_HEIGHT:70,PAGE_SPLIT_MIDDLE_HEIGHT:10,TOLERABLE_HEIGHT_CHANGE:3,PAGE_CLASS_A4:"page-A4",PAGE_CLASS_B5:"page-B5",PAGE_CLASS_TEST:"page-TEST",WSClientStatusCode:{Connecting:0,Open:1,Closing:2,Closed:3,Ready:5,Disabled:10,Intializing:11},WSEVENTID_HOST_CLOSE:4500,MAX_MESSAGE_SIZE:5e3,MAX_UNDO_STACK_SIZE:20,MAX_CMD_DELAY_MILLIS:4e3,MAX_INIT_DELAY_MILLIS:2e3,MAX_LOCAL_CMD_COUNT_PER_SEC:20,REGULAR_CMD_SENT_MILLIS:2e3,LATENCY_TO_SHOW_SET_CONTENT_PROGRESS:2e3,CJSON_ACTION:"action",CJSON_COMMANDID:"cmdId",CJSON_COMMANDOWNER:"cmdOwner",CJSON_COLLABCOMMANDS:"collabCmds",CJSON_COLLAB_NOTE_READY:"collabNoteReady",CJSON_COLLAB_VERSION:"collabVersion",CJSON_DATA_CMD_ERROR:"dataCmdError",CJSON_ENDVERSION:"endVersion",CJSON_ERROR_TO_CLOSE:"errToClose",CJSON_FINALVERSION:"finalVersion",CJSON_INITIALIZE_COLLABSTARTED:"collabStarted",CJSON_INITIALIZE_DONE:"done",CJSON_INITIALIZE_RESULT:"initResult",CJSON_IS_HISTORY_SAVE:"isHistorySave",CJSON_IS_SERVER_CMD:"isServerCmd",CJSON_LOCKCOLOR:"lockColor",CJSON_LOCK_BLOCK_ID:"lockedBlkId",CJSON_MODIFIERS:"modifiers",CJSON_NICKNAME:"nickname",CJSON_NONDATACOMMANDS:"nondataCmds",CJSON_NOTEVERSIONUPDATE:"versionUpdate",CJSON_PORTRAIT:"portraitUrl",CJSON_READONLY:"readOnly",CJSON_SESSIONID:"sessionId",CJSON_SESSIONPROPERTY:"sessionProp",CJSON_STARTVERSION:"startVersion",NONDATACMD_BLOCKSELECTION:"nb_BlkSelection",NONDATACMD_CLINTPONG:"nb_clientPong",NONDATACMD_COLLABCLOSE:"nb_CollabClose",NONDATACMD_COLLABINFO:"nb_CollabInfo",NONDATACMD_DATACMDFAILED:"nb_dataCmdFailed",NONDATACMD_GETMODIFIERS:"nb_getModifiers",NONDATACMD_NOTESAVE:"nb_noteSave",NONDATACMD_LOCKRELEASE:"nb_lockRelease",NONDATACMD_SESSIONINITIALIZED:"nb_sessionInitialized",NONDATACMD_SEVERPING:"nb_serverPing",OPTIONS_COLLABID:"collabId",OPTIONS_NICKNAME:"nickname",OPTIONS_NOTEVERSION:"noteVersion",OPTIONS_PORTRAIT:"portraitUrl",OPTIONS_SESSIONTYPE:"sessionType",OPTIONS_SESSIONID:"sessionId",OPTIONS_USERID:"userId",OPTIONS_BUILDVERSION:"buildVersion",OPTIONS_RECONNECT:"reconn",ERRORID_FAILED_RECEIVE_COLLAB_CMD:4001,ERRORID_FAILED_SEND_LOCAL_CMD:4002,ERRORID_COLLAB_ENGINE_NULL:4003,CONNECTION_FAILED_SEND:"发送协同命令失败：",CONNECTION_NO_CONNECTED:"当前没有与协同服务器连接",CONNECTION_REFUSED:"协同服务器连接被拒绝",CONNECTION_SERVER_CLOSED:"协同服务器已经关闭",ERROR_CODE:"错误编码：",ERROR_CONFLICT_EXECUTION:"编辑区域冲突",ERROR_FAILED_SEND_LOCAL_CMD:"发送本地已执行命令失败",ERROR_FAILED_RECEIVE_COLLAB_CMD:"接收协同命令超时",ERROR_EXCEPTION:"未知错误：",ERROR_REASON:"原因：",ERROR_UNMATCHED_VERSION:"本地笔记版本与服务器端不匹配，本地/服务器：",INVALIDACTION_BLANK_NOTE:"笔记还没有加载",INVALIDACTION_BLOCKS_DIRTY:"目标段落已经被人修改过",INVALIDACTION_COLLAB_NOT_READY:"笔记内容不满足协同的要求",INVALIDACTION_EDIT_READ_ONLY:"只读模式下不可以编辑",INVALIDACTION_EDIT_NOT_READY:"笔记还没有进入编辑状态，如果此状态持续数秒，请刷新页面",INVALIDACTION_FINALVERSION_NOTREADY:"被撤销命令正在同步中，请稍后再试",INVALIDACTION_EMPTY_CMDJSON:"空协同操作指令，将被忽略",INVALIDACTION_EMPTY_LOCALCMD:"空本地操作指令，将被忽略",INVALIDACTION_INVALID_LOCALCMD:"无效的本地命令",INVALIDACTION_FAILED_COLLABCMD:"协同命令执行失败",INVALIDACTION_FAILED_LOCALCMD:"本地命令执行失败",INVALIDACTION_INVALID_CMD_VERSION:"被撤销命令版本无效，丢弃此命令",INVALIDACTION_INVALID_RANGE:"命令所操作区域已经被删除或者无效",INVALIDACTION_TOO_MANY_CMD:"命令操作过快，请稍候，等待处理命令个数：",INVALIDACTION_TOO_LARGE_MESSAGE:"操作所含数据过多，请减少操作数据：",INVALIDACTION_UNSUPPORTED_CMD:"不支持的操作指令：",INVALIDACTION_WORK_ON_LOCKED_BLOCK:"当前或相邻的段落或目标段落被锁定或删除，请稍后操作",LOADING_IMAGE_PATH:"http://note.youdao.com/editor/collab/loading.gif?47",INSERT_BLANK_CATALOGUE_TEXT:"目录为空，请插入标题（字体左侧）后点击刷新按钮"}}(),yne_common_util_schemaVersion=function(a){var b=yne_underscore,c={major:1,minor:0,revision:3},d=function(a){a=a||"";var b=parseInt(a+"",10);return isNaN(b)?0:b},e={GRETER:1,EQUAL:0,LESS:-1},f=function(a,b){return a===b?e.EQUAL:a>b?e.GRETER:e.LESS};return{getDefaultAsString:function(){return c.major+"."+c.minor+"."+c.revision},parse:function(a){if(a){var b=(a+"").split(".");return{major:d(b[0]),minor:d(b[1]),revision:d(b[2])}}},_compare:function(a,c){var d=e.EQUAL;return b.some(["major","minor","revision"],function(b){var g=f(a[b]||0,c[b]||0);if(g!==e.EQUAL)return d=g,!0}),d},isLessThanDefault:function(a){if(!a)return!0;var b=this,d=b.parse(a);return b._compare(d,c)===e.LESS},isCompatible:function(a){if(!(a=a||"")||"true"===a)return!0;var b=this,d=b.parse(a);return b._compare(c,d)!==e.LESS}}}(),yne_common_util_unknownTree=function(a){var b=yne_underscore,c=yne_jquery,d=yne_jtk_core_L,e=yne_common_constants,f=yne_common_util_schemaVersion;return{appendToTree:function(a,b){if(!a||!b)return void d.error("arguments are not valid!");var g=c(b).attr(e.COMPAT);f.isCompatible(g)&&(a.unknown||(a.unknown=[]),a.unknown.push(b.cloneNode(!0)))},appendToXml:function(a,e){if(!a||!e)return void d.error("arguments are not valid!");a.unknown&&a.unknown.length&&b.each(a.unknown,function(a){var b,f;a&&a.cloneNode&&(f=a.nodeName,b=c(e).find(">"+f).length>0,b?d.error("unknown node <"+f+"> has already exist!"):e.appendChild(a.cloneNode(!0)))})}}}(),yne_common_util_blockStyles=function(a){var b=yne_common_util_unknownTree,c=yne_common_data_supportedBlockStyles,d=yne_jquery,e=yne_underscore;return{toXml:function(a,d,f){var g=a.getBlockStyles(),h=a.getType(),i=c.getStyleNamesOfBlock(h);e.each(i,function(a){var b=g[a],e=c.getConfig(a,h,!1);if(null!=b&&b!==e.default){var i=f.createElement(a),j=f.createTextNode(b);i.appendChild(j),d.appendChild(i)}}),a.unknownTree&&a.unknownTree.styles&&b.appendToXml(a.unknownTree.styles,d)},fromXml:function(a,f){var g=a.unknownTree,h=a.getType(),i=c.getStyleNamesOfBlock(h),j=[];d(f).children().each(function(c,e){var f,h=e.nodeName;a.isSupportedBlockStyle(h)?(f=d(e).text(),a.setBlockStyle(h,f),j.push(h)):(g.styles||(g.styles={}),b.appendToTree(g.styles,e))}),e.each(i,function(b){var d;-1===j.indexOf(b)&&(d=c.getConfig(b,h,!1),a.setBlockStyle(b,d.default))})}}}(),yne_common_util_formatLocalSource=function(a){if(!a||/^http/i.test(a))return a;var b,c=a.lastIndexOf("\\");return-1===c?a:(b=a.substring(c+1),a.substring(0,c+1)+encodeURIComponent(b))},yne_common_data_Attachment=function(a){var b,c,d,e=yne_jquery,f=yne_underscore,g=yne_common_data_Block,h=yne_common_data_blockTypes,i=yne_jtk_core_L,j=yne_jtk_web_dom_parseHTML,k=yne_common_util_unknownTree,l=yne_common_util_blockStyles,m=yne_common_util_formatLocalSource,n=yne_common_util_platform;return b={_type:h.ATTACHMENT,_source:null,_resource:null,_fileName:null,_fileLength:null,_fakeLoading:!1,initialize:function(a){var b=this;g.prototype.initialize.apply(b,arguments),b._source=a.source,b._resource=a.resource,b._fileName=a.fileName,b._fileLength=a.fileLength,b._fakeLoading=!!a._fakeLoading},setSource:function(a){var b=this;return!(!(a=(a||"")+"")||a===b._source)&&(b._source=a,b.trigger("content-change"),!0)},getSource:function(a){var b,c=this,d=c._source;return!0===a&&(b=c.getExtraInfo("pcResMap"))&&b[d]&&(d=b[d]),d},getResource:function(a){var b,c=this,d=c._resource;return!0===a&&(b=c.getExtraInfo("pcResMap"))&&b[d]&&(d=b[d]),d},setResource:function(a){var b=this;return!(!(a=(a||"")+"")||a===b._resource)&&(b._resource=a,b.trigger("content-change"),!0)},getFileName:function(){return this._fileName},setFileName:function(a){var b=this;return!(!(a=String(a||""))||a===b._fileName)&&(b._fileName=a,b.trigger("content-change"),!0)},getFileLength:function(){return this._fileLength},setFileLength:function(a){var b=this;return a=parseInt(a,10),isNaN(a)&&(a=0),!(!a||a===b._fileLength)&&(b._fileLength=a,b.trigger("content-change"),!0)},getStyles:function(a){var b=this;return a?b.getBlockStyle(a):b.getBlockStyles()},setStyles:function(a,b){var c=this;return f.isString(a)?c.setBlockStyle(a,b):f.isObject(a)&&f.each(a,function(a,b){c.setBlockStyle(b,a)}),!0},toXml:function(a){var b,c,e=this,g=e.getSource(),h=["Source","Resource","FileName","FileLength"];if(g)return b=d.__super__.toXml.apply(e,[a]),f.each(h,function(c){var d=a.createElement(c.toLowerCase()),f=e["get"+c](),g=a.createTextNode(f);d.appendChild(g),b.appendChild(d)}),c=a.createElement("styles"),l.toXml(e,c,a),b.appendChild(c),k.appendToXml(e.unknownTree,b),b},toJSON:function(){var a=this,b=d.__super__.toJSON.apply(a);return b.source=a.getSource(),b.resource=a.getResource(),b.fileName=a.getFileName(),b.fileLength=a.getFileLength(),b},toHtml:function(a,b,c){var d,g,h=this,i=h.getStyles(),k=j("",document,!0,!0),l=k.ownerDocument,o=l.createElement("div"),p=e(o),q=e(l.createElement("img"));return p.attr("yne-bulb-block","attachment"),f.each(i,function(a,b){switch(b){case"align":p.css("text-align",a);break;case"float":p.css("float",a)}}),g=h.getSource(!0===c),n.IS_PC&&(g=m(g)),q.attr({"data-media-type":"attachment",src:g,path:h.getResource(),filelength:h._fileLength,title:h._fileName,alt:h._fileName,filename:h._fileName}),p.append(q),d=o.outerHTML,o=p=q=null,d},toPlain:function(){return""},countWords:function(){return 0},setFakeLoading:function(a){this._fakeLoading=a},getFakeLoading:function(){return this._fakeLoading}},c={fromXml:function(a){var b,c="无文件名",f=e(a),h=e.trim(f.find("source").text()),i=e.trim(f.find("resource").text()),j=e.trim(f.find("filename").text())||c,m=e.trim(f.find("filelength").text());return m=parseInt(m,10),isNaN(m)&&(m=0),b=new d({source:h,resource:i,fileName:j,fileLength:m}),b.parseIdFromXml(a),f.children().each(function(a,c){switch(c.nodeName){case g.TAG_ID_NAME:case g.LEGACY_TAG_ID_NAME:case"source":case"resource":case"filename":case"filelength":break;case"styles":l.fromXml(b,c);break;default:k.appendToTree(b.unknownTree,c)}}),b},fromJSON:function(a){if(!(a&&a.blockType&&a.blockType===h.ATTACHMENT&&a.source&&a.resource))return void i.warn("jsonObj or jsonObj.source/resource does NOT exist!");var b=new d({source:a.source,resource:a.resource,fileName:a.fileName,fileLength:a.fileLength});return a.styles&&b.setStyles(a.styles),a.blockId&&b.setId(a.blockId),b}},d=g.extend(b,c)}(),yne_jtk_core_assert=function(){var a=this,b=a.DEBUG,c=a.console,d=function(){};return b&&c.assert?c.assert.bind(c):d}(),yne_common_data_xmlFont=function(a){return yne_common_util_freeze({DEFAULT_FONT:"Microsoft YaHei"})}(),yne_tinycolor=function(){var a=window.tinycolor;if(!a&&window.require&&(a=window.require("tinycolor")),!a)throw"no `tinycolor` library";return a}(),yne_common_data_xmlInlineStyleConfig=function(a){var b=yne_common_util_freeze,c=yne_common_data_xmlFont,d=yne_tinycolor,e={COLOR:"#000000",BACK_COLOR:"transparent"};return b({bold:{key:"b",default:!1,type:"Boolean"},italic:{key:"i",default:!1,type:"Boolean"},underline:{key:"u",default:!1,type:"Boolean"},strike:{key:"s",default:!1,type:"Boolean"},"font-family":{key:"ff",default:c.DEFAULT_FONT,type:"String"},"font-size":{key:"fs",default:14,type:"Number"},color:{key:"cl",default:e.COLOR,type:"String",equalDefault:function(a){return a===e.COLOR||d.equals(a,e.COLOR)}},"back-color":{key:"bc",default:e.BACK_COLOR,type:"String",equalDefault:function(a){return a===e.BACK_COLOR||d.equals(a,e.BACK_COLOR)}},href:{key:"href",default:"",type:"String"}})}(),yne_common_data_supportedInlineStyles=function(a){var b=yne_underscore,c=yne_common_data_xmlInlineStyleConfig,d={};return{getConfig:function(a){var e=c[a],f=d[a];return e&&f&&(e=b.clone(e),e.default=f),e},isSupport:function(a){return null!=c[a]},getAllConfig:function(a){var c=this,d=c.getStyleNames(a),e={};return b.each(d,function(a){e[a]=c.getConfig(a)}),e},getAllDefault:function(a){var c=this,d=c.getStyleNames(a),e={};return b.each(d,function(a){e[a]=c.getDefault(a)}),e},getStyleNames:function(a){var d=b.keys(c);return a&&a.length?b.difference(d,a):d},getDefault:function(a){var b;return null!=(b=d[a])?b:(b=c[a],b?b.default:void 0)},setDefault:function(a,b){var c=this,e=c.getDefault(a);null!=b&&b!==e&&(d[a]=b)},reset:function(){d={}}}}(),yne_common_util_unknownInlineStyles=function(a){var b=yne_underscore,c=yne_common_data_supportedInlineStyles,d=[];return{add:function(a){a&&!c.isSupport(a)&&(b.contains(d,a)||d.push(a))},get:function(){return d},reset:function(){d=[]}}}(),yne_common_util_codePointAt=function(a,b){if(String.prototype.codePointAt)return String.prototype.codePointAt.call(a,b);if(null===a||void 0===a)throw new TypeError("codePointAt第一个参数必须为String");a=String(a);var c,d,e=a.length,f=isNaN(b)?0:Number(b);if(!(f<0||f>=e))return c=a.charCodeAt(f),c>=55296&&c<=56319&&e>f+1&&(d=a.charCodeAt(f+1))>=56320&&d<=57343?1024*(c-55296)+d-56320+65536:c},yne_common_util_clearString=function(a){function b(a){var b,c,f=a.length;if(!d.isString(a))return!1;for(b=0;b<f;b++)if(!(9===(c=e(a,b))||10===c||13===c||c>=32&&c<=55295||c>=57344&&c<=65533)){if(!(c>=65536&&c<=1114111))return!1;b++}return!0}function c(a){var b,c,f="",g=a.length;if(!d.isString(a))return a;for(b=0;b<g;b++)c=e(a,b),9===c||10===c||13===c||c>=32&&c<=55295||c>=57344&&c<=65533?f+=a[b]:c>=65536&&c<=1114111&&(f+=a[b],b++,f+=a[b]);return f}var d=yne_underscore,e=yne_common_util_codePointAt;return{checkValid:b,clear:c}}(),yne_common_util_toCharArrayByCodePoint=function(a){var b=yne_common_util_codePointAt;return function(a){var c,d=[];for(c=0;c<a.length;c++)b(a,c)>65535?(d.push(a.slice(c,c+2)),c++):d.push(a[c]);return d}}(),yne_common_data_RichText=function(a){var b,c=yne_underscore,d=yne_jquery,e=yne_jtk_core_Class,f=yne_jtk_core_assert,g=yne_jtk_core_L,h=yne_common_constants,i=yne_common_util_schemaVersion,j=yne_common_data_supportedInlineStyles,k=yne_common_util_unknownInlineStyles,l=yne_common_util_clearString,m=function(a){f(l.checkValid(a)),this.char=a,this.length=a.length,this.styles={}},n=function(a){var b,c=a.length,d=new Array(c);for(b=0;b<c;++b)d[b]=a[b].clone();return d},o=yne_common_util_toCharArrayByCodePoint,p=function(a){var b=a.indexOf("|");return-1===b?{value:a}:{compat:a.substring(0,b),value:a.substring(b+1)}};return m.prototype.toString=function(){return this.char},m.prototype.setStyle=function(a,b){var d=this.styles,e=j.getConfig(a);if(!e)return void g.warn("The RichText does not support `"+a+"` style!");if(b&&!c["is"+e.type](b))switch(e.type){case"Number":b=Number(b),b=isNaN(b)?e.default:b;break;case"Boolean":b=b+""=="true";break;default:g.warn("The value `"+b+"` of `"+a+"` is not valid type!"),b=null}
!b||(e.equalDefault?e.equalDefault(b):b===e.default)?delete d[a]:d[a]=b},m.prototype.setUnknownStyle=function(a,b){var c=this;if(j.isSupport(a))return void g.warn("The RichText supports `"+a+"` style!");c.unknownStyles||(c.unknownStyles={}),c.unknownStyles[a]=b},m.prototype.getStyle=function(a,b){var d,e=j.getConfig(a);return e?(d=this.styles[a],b=!1!==b,null==d?b?e.default:null:(c["is"+e.type](d)||(g.warn("The value `"+d+"` of `"+a+"` is not valid type!"),d=null),b?null==d?e.default:d:d===e.default?null:d)):null},m.prototype.getUnknownStyle=function(a){var b=this,c=b.unknownStyles;if(c)return c[a]},m.prototype.getStyles=function(){var a=this,b={},d=j.getAllConfig();return c.each(d,function(c,d){b[d]=a.getStyle(d)}),b},m.prototype.removeStyles=function(){this.styles={}},m.prototype.clone=function(){var a=this,b=new m(a.char);return b.styles=c.clone(a.styles),a.unknownStyles&&(b.unknownStyles=c.clone(a.unknownStyles)),b},m.prototype.isLineBreak=function(){return"\r"===this.char||"\n"===this.char},m.prototype.toJSON=function(){var a=this,b={char:a.char},d={},e=!1,f=j.getAllConfig();return c.each(f,function(b,c){var f=a.getStyle(c,!1);f&&(d[c]=f,e=!0)}),e&&(b.styles=d),b},m.fromJSON=function(a){if(a&&a.char){var b=new m(a.char);return c.each(a.styles,function(a,c){b.setStyle(c,a)}),b}},b=e.extend({_data:null,initialize:function(a){a=c.defaults(a||{},{text:"",keepLineBreak:!0});var b=this,d=a.text||"",e=b._data=[];b._keepLineBreak=a.keepLineBreak,delete b.options,d=l.clear(d),b._keepLineBreak||(d=d.replace(/[\r\n]/g,"")),c.each(o(d),function(a){e.push(new m(a))})},getLength:function(a){var b,c=this._data,e=c.length;if(a)for(b=0;b<c.length;b++)d.trim(c[b].toString())||e--;return e},indexOf:function(a,b,c){var d,e,f,g,h,i=a.getReadOnlyData(),j=i.length,k=this.getReadOnlyData(),l=k.length;if(j>l)return-1;for(e=b;e<l;e++){for(d=!0,f=0;f<j;f++){if(g=k[e+f],h=i[f],!g){d=!1;break}if((!0!==c||g.char.toLowerCase()!==h.char.toLowerCase())&&g.char!==h.char){d=!1;break}}if(d)return e}return-1},isEmpty:function(){return this.getLength()<=0},getClonedData:function(){return n(this._data)},getReadOnlyData:function(){return this._data},toString:function(){return this._data.join("")},setStyle:function(a,b,d,e){if(d&&null!=e){var f,g=this,h=g._data,i=c.isArray(e);for(b=Math.min(b,h.length),f=a;f<b;++f)h[f].setStyle(d,i?e[f-a]:e)}},setUnknownStyle:function(a,b,d,e){var f,g=this,h=g._data,i=c.isArray(e);for(b=Math.min(b,h.length),f=a;f<b;++f)h[f].setUnknownStyle(d,i?e[f-a]:e)},getStyle:function(a,b,c){var d,e,h,i=this,j=i._data;if(f(a>=0),f(a<=b),f(b<=j.length),void 0===a||a<0||void 0===b||a>b||b>j.length)return g.error("unexpected params:",a,b,j.length),null;for(h=new Array(b-a),d=a;d<b;++d)e=j[d].getStyle(c),h[d-a]=e;return h},setStyles:function(a,b,d){var e=this;d&&c.each(d,function(c,d){e.setStyle(a,b,d,c)})},getStylesAtIndex:function(a){var b=this._data,c=b.length;return a<0||a>=c?void g.warn("invlid index of the text",a,b):b[a].getStyles()},getCommonStyle:function(a,b,c,d){var e,f,i=this,k=i._data,l=null;if(i.isEmpty())return j.getDefault(c);if(a<0)return void g.warn("start should not be less than 0",a);if(a>b)return void g.warn("start should not greater than end",a,b);if(b>k.length)return void g.warn("end should not geater than data.length",b,k);if(a===b)0===a&&k[0]?l=k[0].getStyle(c):k[a-1]&&(l=k[a-1].getStyle(c));else for(e=a;e<b;++e)if(k&&k[e]){if(f=k[e].getStyle(c),null===l)l=f;else if(l!==f)return d?null:h.INTERM}else g.warn("unexpected undefine in data",k);return!d||l!==h.INTERM&&l!==j.getDefault(c)?l:null},getCommonStyles:function(a,b,d){var e=this,f={},g=j.getAllConfig();return c.each(g,function(c,g){var h=e.getCommonStyle(a,b,g,d);null!=h&&(f[g]=h)}),f},removeStyles:function(){var a,b=this,c=b._data,d=c.length;for(a=0;a<d;++a)c[a].removeStyles()},slice:function(a,c,d){var e=this,f=e._data.slice(a,c),g=new b;return!1!==d&&(f=n(f)),g.appendRichChars(f),g},isKeepLineBreak:function(){return this._keepLineBreak},setKeepLineBreak:function(a){a=!!a;var b=this;a!==b._keepLineBreak&&(b._keepLineBreak=a,!1===b._keepLineBreak&&b.removeLineBreak())},_removeLineBreak:function(a){return a&&0!==a.length?a=c.filter(a,function(a){return!1===a.isLineBreak()}):[]},removeLineBreak:function(){var a=this;a._data=a._removeLineBreak(a._data)},clone:function(){var a=this,c=new b({text:"",keepLineBreak:a.isKeepLineBreak()});return c.appendRichChars(a.getClonedData()),c},append:function(a){a&&a.getClonedData||g.warn("no richText"),this.appendRichChars(a.getClonedData())},appendRichChars:function(a){if(!a||0===a.length)return void g.warn("richChars is not valid",a);var b=this;b.isKeepLineBreak()||(a=b._removeLineBreak(a)),b._data=b._data.concat(a)},insert:function(a,b){if(a&&a.getClonedData){var c=this,d=c._data,e=d.splice(b),f=a.getClonedData();g.log("insert ...",a,b),!1===c.isKeepLineBreak()&&!0===a.isKeepLineBreak()&&(f=c._removeLineBreak(f)),c._data=d.concat(f,e)}},getReadOnlyStylesList:function(a){var b=this,d=b._data,e=[],f=j.getAllConfig();return a=!1!==a,c.each(d,function(b){var d={};c.each(f,function(c,e){var f=b.getStyle(e,a);(a||!a&&null!=f)&&(d[e]=f)}),e.push(d)}),e},getStyleRanges:function(a,b){if(a){if(b=!0===b,j.isSupport(a))b=!1;else if(!b)return;var d,e,f,g,h=this,i=h._data,k=i.length,l=[],m=!1;for(d=0;d<k;d++)e=i[d],f=b?e.getUnknownStyle(a):e.getStyle(a,!1),f?(g=c.last(l),!m&&g&&g.value===f?g.to=d+1:l.push({from:d,to:d+1,value:f}),m=!1):m=!0;return l}},_handleStyleRangesForXML:function(a,b,d,e,f){e&&e.length&&c.each(e,function(c){if(c&&c.value){var e,g,i,j=a.createElement(d),k=a.createElement("from"),l=a.createElement("to"),m=a.createElement("value");k.appendChild(a.createTextNode(c.from)),j.appendChild(k),l.appendChild(a.createTextNode(c.to)),j.appendChild(l),f?(e=p(c.value),i=e.compat,i&&j.setAttribute(h.COMPAT,i),g=e.value):g=c.value,m.appendChild(a.createTextNode(g)),j.appendChild(m),b.appendChild(j)}})},_handleStyleRangesForJSON:function(a,b,d,e){d&&d.length&&c.each(d,function(c){if(c&&c.value){var d,f,g=a[b];g||(g=a[b]=[]),e?(d=p(c.value),f=d.value):f=c.value,g.push({from:c.from,to:c.to,value:f})}})},toXml:function(a){var b,d=this,e=a.createElement("inline-styles"),f=j.getAllConfig();return c.each(f,function(b,c){var f=d.getStyleRanges(c,!1);d._handleStyleRangesForXML(a,e,c,f,!1)}),b=k.get(),c.each(b,function(b){var c=d.getStyleRanges(b,!0);d._handleStyleRangesForXML(a,e,b,c,!0)}),e},_toSimplifyJSON:function(){var a,b,d=this,e={},f=j.getAllConfig();return c.each(f,function(a,b){var c=d.getStyleRanges(b,!1);d._handleStyleRangesForJSON(e,b,c,!1)}),a=k.get(),c.each(a,function(a){var b=d.getStyleRanges(a,!0);d._handleStyleRangesForJSON(e,a,b,!0)}),b={text:d.toString(),keepLineBreak:d.isKeepLineBreak()},c.isEmpty(e)||(b.inlineStyles=e),b},toJSON:function(a){var b,d=this;return!0===a?d._toSimplifyJSON():(b=c.map(d._data,function(a){return a.toJSON()}),{isRichText:!0,keepLineBreak:d.isKeepLineBreak(),data:b})},toCollabJSON:function(){return this.toJSON(!0)}},{create:function(a,c){return new b({text:a,keepLineBreak:!1!==c})},createBlank:function(a){return b.create("",a)},fromXml:function(a){var c=d(a),e=new b({text:c.find("text").text()});return c.find("inline-styles").children().each(function(a,b){var c,f,g=b.nodeName.toLowerCase(),l=d(b),m=parseInt(l.find("from").text()),n=parseInt(l.find("to").text()),o=l.find("value");0!==o.length&&(c=o.text(),j.isSupport(g)?e.setStyle(m,n,g,c):(f=l.attr(h.COMPAT),i.isCompatible(f)&&(k.add(g),c=f+"|"+c,e.setUnknownStyle(m,n,g,c))))}),e},fromJSON:function(a){if(a&&a.isRichText&&a.data){var d,e=[];return c.each(a.data,function(a){var b=m.fromJSON(a);b&&e.push(b)}),d=new b({text:"",keepLineBreak:a.keepLineBreak}),d.appendRichChars(e),d}},fromCollabJSON:function(a){if(!a||!a.text)return b.createBlank(!0);var d=b.create(a.text,a.keepLineBreak);return c.each(a.inlineStyles,function(a,b){c.each(a,function(a){j.isSupport(b)?d.setStyle(a.from,a.to,b,a.value):d.setUnknownStyle(a.from,a.to,b,a.value)})}),d}})}(),yne_common_fontMaps=function(a){var b=yne_underscore,c=yne_jquery,d=yne_jtk_core_L,e=yne_common_data_xmlFont,f={"微软雅黑":[e.DEFAULT_FONT,"STXihei"],"宋体":["SimSun","STSong"],"新宋体":["NSimSun"],"仿宋":["FangSong_GB2312","FangSong","STFangsong"],"楷体":["KaiTi_GB2312","KaiTi","STKaiti"],"黑体":["SimHei","STHeiti"],Arial:["Arial"],"Arial Black":["Arial Black"],"Times New Roman":["Times New Roman"],"Courier New":["Courier New"],Tahoma:["Tahoma"],Verdana:["Verdana"]},g=function(a,c){return b.some(a,function(a){return(a+"").toLowerCase()===c})};return Object.freeze(f),{DEFAULT_FONT:e.DEFAULT_FONT,getFontMap:function(){return f},getFont:function(a){var c,d,e=this;if((a=(a||"").toLowerCase())&&(d=e.splitFontFamily(a)))return b.some(d,function(a){if(b.some(f,function(b,d){if(d.toLowerCase()===a||g(b,a))return c=d,!0}),c)return!0}),c},getFontFirstValue:function(a){var b,c=this.getFont(a);if(b=f[c])return b[0]},getAllValueByFont:function(a){var b=this.getFont(a);if(b)return f[b].join(",");d.warn("Font does not exit in Font Maps: "+a)},getNames:function(){return b.keys(f)},getItems:function(){var a=[];return b.each(f,function(b,c){a.push({singleValue:b[0],fullValue:b.join(","),name:c})}),a},splitFontFamily:function(a){var d,e=[];return(a=c.trim(a||""))?(d=a.split(","),b.each(d,function(a){a=a||"",(a=c.trim(a.replace(/["']/g,"")))&&e.push(a)}),e):[]}}}(),yne_common_data_inlineStyleToCss=function(a){var b=yne_underscore,c=yne_common_fontMaps,d={"font-size":function(a){var b=a["font-size"];if(null!=b)return b+"px"},"font-family":function(a){var b=a["font-family"];return b=c.getAllValueByFont(b)||b},color:function(a){return a.color},"background-color":function(a){return a["back-color"]},"font-weight":function(a){return{true:"bold",false:"normal"}[a.bold+""]},"font-style":function(a){return{true:"italic",false:"normal"}[a.italic+""]},"text-decoration":function(a){if(!1===a.underline&&!1===a.strike)return"none";var b=[];return a.underline&&b.push("underline"),a.strike&&b.push("line-through"),(b=b.join(" "))||""}};return{getRules:function(a){var c=a?b.clone(a):{};return b.defaults(c,d),c},convertToCssStyle:function(a,c,d){var e=this,f={},g=e.getRules(d);return b.isArray(c)&&(g=b.pick(g,c)),b.isObject(a)&&b.each(g,function(b,c){f[c]=b(a)}),f}}}(),yne_common_util_xssFilter=function(){function a(a){return a.replace(o,"&lt;").replace(p,"&gt;")}function b(a){return a=i(a),v.lastIndex=0,v.test(a)?"":a=j(a)}function c(a,b){if(b=i(b),"href"===a||"src"===a){if("#"===(b=b.trim(b)))return"#";if("http://"!==b.substr(0,7)&&"https://"!==b.substr(0,8)&&"mailto:"!==b.substr(0,7)&&"#"!==b[0]&&"/"!==b[0])return""}else if("background"===a){if(v.lastIndex=0,v.test(b))return""}else if("style"===a){if(w.lastIndex=0,w.test(b))return"";if(x.lastIndex=0,x.test(b)&&(v.lastIndex=0,v.test(b)))return""}return b=j(b)}function d(a){return a.replace(q,"&quot;")}function e(a){return a.replace(r,'"')}function f(a){return a.replace(s,function(a,b){return"x"===b[0]||"X"===b[0]?String.fromCharCode(parseInt(b.substr(1),16)):String.fromCharCode(parseInt(b,10))})}function g(a){return a.replace(t,":").replace(u," ")}function h(a){for(var b="",c=0,d=a.length;c<d;c++)b+=a.charCodeAt(c)<32?" ":a.charAt(c);return b.trim()}function i(a){return a=e(a),a=f(a),a=g(a),a=h(a)}function j(b){return b=d(b),b=a(b)}function k(){return""}function l(a,b){function c(b){return!!d||-1!==a.indexOf(b)}"function"!=typeof b&&(b=function(){});var d=!Array.isArray(a),e=[],f=!1;return{onIgnoreTag:function(a,d,g){if(c(a)){if(g.isClosing){var h="[/removed]",i=g.position+h.length;return e.push([!1!==f?f:g.position,i]),f=!1,h}return f||(f=g.position),"[removed]"}return b(a,d,g)},remove:function(a){var b="",c=0;return e.forEach(function(d){b+=a.slice(c,d[0]),c=d[1]}),b+=a.slice(c)}}}function m(a){return a.replace(y,"")}function n(a){var b=a.split("");return b=b.filter(function(a){var b=a.charCodeAt(0);return 127!==b&&(!(b<=31)||(10===b||13===b))}),b.join("")}var o=/</g,p=/>/g,q=/"/g,r=/&quot;/g,s=/&#([a-zA-Z0-9]*);?/gim,t=/&colon;?/gim,u=/&newline;?/gim,v=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,w=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,x=/u\s*r\s*l\s*\(.*/gi,y=/<!--[\s\S]*?-->/g,z={};return z.safeAttrValue=c,z.safeHref=b,z.escapeHtml=a,z.escapeQuote=d,z.unescapeQuote=e,z.escapeHtmlEntities=f,z.escapeDangerHtml5Entities=g,z.clearNonPrintableCharacter=h,z.friendlyAttrValue=i,z.escapeAttrValue=j,z.onIgnoreTagStripAll=k,z.StripTagBody=l,z.stripCommentTag=m,z.stripBlankChar=n,z}(),yne_common_data_Rich2HtmlConvertor=function(a){var b=yne_underscore,c=yne_jquery,d=yne_common_data_RichText,e=yne_common_data_supportedInlineStyles,f=yne_common_data_inlineStyleToCss,g=yne_common_util_xssFilter,h=function(a,c){var d,e=document.createElement("span");return b.each(c,function(b,c){var d=b(a);(d||0===d)&&(e.style[c]=d)}),d=e.outerHTML,d=d.replace(/<\/span>$/i,"")},i=function(){return"</span>"},j=function(a){return a+="",'<a href="'+g.safeHref(a)+'">'},k=function(){return"</a>"},l=function(a,c,d){b.isEmpty(c)||a.push(h(c,d))},m=function(a,b){b&&a.push(j(b))},n=function(a,c){b.isEmpty(c)||a.push(i(c))},o=function(a,b){b&&a.push(k(b))},p=e.getStyleNames(),q=function(a,b){if(!a||!b)return!1;var c,d=p.length;for(c=0;c<d;c++)if(a[p[c]]!==b[p[c]])return!1;return!0},r={},s={};return{setCssRules:function(a){var c=this;b.each(a,function(a,d){b.isFunction(a)&&(r[d]=a,c.resetInlineStyleDefaultForHtml(d))})},getCssRule:function(a){return r[a]},resetCssRules:function(){var a=this;r={},a.resetInlineStyleDefaultForHtml()},getDefaultForHtml:function(a){var b,c,d,f=this,g=s[a];return null==g&&(b=f.getCssRule(a),c=e.getDefault(a),b?(d={},d[a]=c,g=b(d)):g=c,s[a]=g),g},resetInlineStyleDefaultForHtml:function(a){a?(a+="",delete s[a]):s={}},rich2html:function(a,c){var d,e,g,h,i,j,k=a.getReadOnlyData(),p=k.length,s=[],t="";if(c=b.defaults(c||{},{withDefault:!0,styleRules:null}),0===p)return"<br>";for(d=a.getReadOnlyStylesList(c.withDefault),c.styleRules?(j=b.clone(c.styleRules),b.defaults(j,r)):j=r,j=f.getRules(j),e=0;e<p;++e)g=k[e],i=d[e],q(h,i)||(n(s,h),t!==i.href&&(o(s,t),m(s,i.href)),l(s,i,j)),s.push(b.escape(g.toString())),h=i,t=i.href;return n(s,h),o(s,t),s=s.join("")},html2rich:function(a){return new d(c(a).text())}}}(),yne_common_util_convertPlain=function(a){var b=/\xA0/g;return a.replace(b," ")},yne_common_util_countText=function(a){var b,c=0;return a?(b="string"==typeof a?a:a.toString(),c=b.replace(/(\s)/g,"").length):c},yne_common_data_Paragraph=function(a){var b,c,d,e=yne_underscore,f=yne_jquery,g=yne_common_data_Block,h=yne_common_data_Rich2HtmlConvertor,i=yne_common_data_blockTypes,j=yne_common_constants,k=yne_common_data_RichText,l=yne_jtk_core_L,m=yne_common_util_unknownTree,n=yne_common_util_blockStyles,o=yne_common_data_supportedBlockStyles,p=yne_common_data_supportedInlineStyles,q=yne_common_util_convertPlain,r=yne_common_util_countText;return b={_type:i.PARAGRAPH,_richText:null,_styles:null,_inlineStylesForEmpty:null,initialize:function(){var a=this;a.options.id&&a.setId(a.options.id),a.options.text?a.setText(a.options.text):a.setText(""),g.prototype.initialize.apply(a,arguments)},isEmptyContent:function(){return 0===this.getLength(!1)},setText:function(a){a instanceof k||(e.isString(a)||(a=String(a)),a=new k({text:a}));var b=this;b._richText=a,b.trigger("content-change",b)},getText:function(){return this._richText.slice(0)},getReadOnlyText:function(){return this._richText},getStartOffset:function(){return 0},getEndOffset:function(){return this.getLength()},getLength:function(a){return this._richText.getLength(a)},isEmpty:function(){return this._richText.isEmpty()},getRangeText:function(a){if(a&&null!=a.start){return this.sliceText(a.start,a.end)}},sliceText:function(a,b,c){return this._richText.slice(a,b,c)},append:function(a){this._richText.append(a)},insertText:function(a,b){var c=this;return l.log("insert Text",a,b),c._richText.insert(b,a),l.log(c._richText),c.trigger("content-change"),!0},deleteText:function(a,b){e.isObject(a)&&!e.isUndefined(a.start)&&(b=a.end,a=a.start);var c=this,d=c._richText,f=d.slice(0,a),g=new k,h=new k;b>=0&&(g=d.slice(b)),h.append(f),h.append(g),c.setText(h)},setTextStyle:function(a,b,c,d){var f=this,g=f._richText;e.isObject(c)&&null!=c.start&&(d=c.end,c=c.start),g.setStyle(c,d,a,b),f.trigger("content-change")},getTextStyle:function(a,b,c){var d=this,f=d._richText;return e.isObject(b)&&null!=b.start&&(c=b.end,b=b.start),f.getStyle(b,c,a)},getTextStylesAtIndex:function(a){return this._richText.getStylesAtIndex(a)},getCommonInlineStyle:function(a,b){var c,d,e=this;return b?(c=b.start,d=b.end):(c=e.getStartOffset(),d=e.getEndOffset()),e._richText.getCommonStyle(c,d,a)},getCommonInlineStyles:function(a){var b,c,d=this,e=d._richText;return a?(b=a.start,c=a.end):(b=d.getStartOffset(),c=d.getEndOffset()),e.getCommonStyles(b,c)},removeAllStyles:function(){var a=this;g.prototype.removeAllStyles.apply(a,arguments),a._richText.removeStyles(),a.trigger("content-change",a)},setInlineStylesForEmpty:function(a){this._inlineStylesForEmpty=a},getInlineStylesForEmpty:function(a){var b=this,c=b._inlineStylesForEmpty;return a&&(c=c||p.getAllDefault()),c=e.clone(c),c||(c=b.getDefaultSetFont()),c},getDefaultInlineStyles:function(){return p.getAllDefault()},getInlineStyleForEmpty:function(a,b){return(this.getInlineStylesForEmpty(b)||{})[a]},getStyleRanges:function(a,b){return this._richText.getStyleRanges(a,b)},toXml:function(a){var b,c,e=this,f=d.__super__.toXml.apply(e,[a]),g=a.createElement("text"),h=e._richText.toString(),i=a.createTextNode(h);return g.appendChild(i),f.appendChild(g),c=e._richText.toXml(a),c&&f.appendChild(c),b=a.createElement("styles"),n.toXml(e,b,a),f.appendChild(b),m.appendToXml(e.unknownTree,f),f},toJSON:function(a,b){a=a||0;var c=this,e=c.sliceText(a,b,!1),f=d.__super__.toJSON.apply(c);return f.richText=e.toJSON(),f},toHtml:function(a,b,c){var d,e,g,i=this,j=document.createElement("div"),k=f(j);return c=!0===c,k.attr("yne-bulb-block","paragraph").css("white-space","pre-wrap"),i._applyBlockStylesOnElement(k),a=a||0,b=null==b?i.getEndOffset():b,d=i.sliceText(a,b,!1),e=h.rich2html(d,{withDefault:c}),k.html(e),g=j.outerHTML,j=k=null,g},_applyBlockStylesOnElement:function(a,b){var c,d=this,f=d.getBlockStyles(),g={};e.each(f,function(a,e){switch(e){case"align":g["text-align"]=a;break;case"indent":case"text-indent":b?(a=d.getBlockStyle("indent")+d.getBlockStyle("text-indent"),c="text-indent"):(a=a>0?a:0,c="indent"===e?"margin-left":"text-indent"),g[c]=a*j.INDENT_WIDTH||"";break;case"line-height":a>0&&(g["line-height"]=String(a));break;default:l.warn("unknown block style: "+e)}}),g["line-height"]||(c=o.getDefault("line-height",i.PARAGRAPH),g["line-height"]=c),c=h.getDefaultForHtml("font-size"),g["font-size"]=c,a.css(g)},toPlain:function(a,b){var c,d,e=this;return a=a||0,c=e.sliceText(a,b,!1),d=c.toString(),d=q(d)},countWords:function(a){var b,c=this,d=0,e=c._richText;return j.IS_MOBILE||!a?d=r(e):(b=c.getRangeText(a))&&(d=r(b)),d},getHighlight:function(a,b){if(a&&a.length){var c=this,d=c._richText,f=[];return e.each(a,function(a){for(var c=a.getLength(),e=0,g=d.indexOf(a,e,b.ignoreCase);-1!==g;)f[g]={start:g,end:g+c},g=d.indexOf(a,g+c,b.ignoreCase)}),f=e.compact(f),f.length?f:null}},toCollabJSON:function(){var a=this,b=d.__super__.toJSON.apply(a);return b.richText=a._richText.toCollabJSON(),b}},c={fromXml:function(a){var b=new d;return b.parseIdFromXml(a),b.setText(k.fromXml(a)),f(a).children().each(function(a,c){switch(c.nodeName){case g.TAG_ID_NAME:case g.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":n.fromXml(b,c);break;default:m.appendToTree(b.unknownTree,c)}}),b},fromJSON:function(a){return this._generalFromJSON(a,!1)},fromCollabJSON:function(a){return this._generalFromJSON(a,!0)},_generalFromJSON:function(a,b){if(!a||!a.blockType||a.blockType!==i.PARAGRAPH||!a.richText)return void l.warn("jsonObj is not valid!");var c,f=new d;return c=b?k.fromCollabJSON(a.richText):k.fromJSON(a.richText),f.setText(c),e.each(a.styles,function(a,b){f.setBlockStyle(b,a)}),a.blockId&&f.setId(a.blockId),f},createBlank:function(a){var b=new d;return!0===a&&j.PLATFORM_LINE_HEIGHT&&j.PLATFORM_LINE_HEIGHT!==o.getDefault("line-height",i.PARAGRAPH)&&b.setBlockStyle("line-height",j.PLATFORM_LINE_HEIGHT),b}},d=g.extend(b,c)}(),yne_common_data_Catalogues=function(a){var b=yne_underscore,c=yne_jquery,d=yne_jtk_core_Class,e=yne_jtk_core_assert,f=yne_collaboration_collabUtils,g=d.extend(b.extend({_id:null,_items:null,unknownAttrs:null,state:null,initialize:function(a){var b=this;b._id=a.id||f.newGUID(),b._items=[],b.unknownAttrs=[]},getId:function(){return this._id},getItems:function(){return this._items},getLength:function(){return this._items.length},updateIndexes:function(){var a=this,b=a._items;b.forEach(function(a,c){a.removeSorting(),0===c&&a.setFirst(),c===b.length-1&&a.setLast()})},insertBefore:function(a,b){var c=this,d=c._items,e=b?d.indexOf(b):0;c.insertItem(e,a)},insertAfter:function(a,b){var c=this,d=c._items,e=b?d.indexOf(b):-1;c.insertItem(e+1,a)},insertItem:function(a,b){var c=this,d=c._items;return e(a>0||a<=d.length),d.splice(a,0,b),c.updateIndexes(),a},removeItem:function(a){var b=this,c=b._items,d=c.indexOf(a);return d>=0&&(c.splice(d,1),b.updateIndexes()),d},select:function(){var a=this,b=a._items;a.isLock()||b[0]&&b[0].focus()},removeSelect:function(){var a=this,b=a._items;b[0]&&b[0].blur()},updateLockState:function(a){this.state=a,this.state&&this.removeSelect()},isLock:function(){return!!this.state}}),{fromXml:function(a){var d=c(a),e=d.attr("id"),f=new g({id:e});return b.each(a.attributes,function(a){switch(a.nodeName){case"id":case"type":break;default:f.unknownAttrs.push(a.cloneNode(!0))}}),f}});return g}(),yne_common_data_Catalogue=function(a){var b,c,d,e=yne_jquery,f=yne_jtk_core_L,g=yne_underscore,h=yne_common_data_Paragraph,i=yne_common_data_RichText,j=yne_common_data_blockTypes,k=yne_common_data_Catalogues,l=yne_common_util_unknownTree,m=yne_common_util_blockStyles,n=yne_common_data_Rich2HtmlConvertor,o=yne_collaboration_collabUtils;return c={_type:j.CATALOGUE,_href:null,_level:null,_isFirst:null,_isLast:null,initialize:function(){var a=this,b=a.options;h.prototype.initialize.apply(a,arguments),a.setHref(b.href),a.setIndent(b.indent),b.ownerList&&a.setOwnerList(b.ownerList),a.on("attached",a._onAttached.bind(a)),a.on("detached",a._onDetached.bind(a)),a.on("select",a._onSelect.bind(a)),a.on("remove-select",a._onRemoveSelect.bind(a))},setOwnerList:function(a){this._ownerList=a},getOwnerList:function(){return this._ownerList||f.warn('No ownerList! check have "setOwnerList"'),this._ownerList},getOwnerId:function(){return this.getOwnerList().getId()},_onAttached:function(a){var b=this,c=b.getOwnerList(),d=a.getPreBlock(b),e=a.getNextBlock(b);if(!c)return b.findAndSetOwnerList(a);d&&j.isCatalogue(d)&&d.getOwnerId()===b.getOwnerId()?c.insertAfter(b,d):e&&j.isCatalogue(e)&&e.getOwnerId()===b.getOwnerId()?c.insertBefore(b,e):c.insertAfter(b,null)},findAndSetOwnerList:function(a){var b,c=this,d=a.getPreBlock(c),e=a.getNextBlock(c),g=c._oldOwnerId;return g?j.isCatalogue(e)&&g===e.getOwnerId()?(b=e.getOwnerList(),c.setOwnerList(b),b.insertBefore(c,e)):j.isCatalogue(d)&&g===d.getOwnerId()?(b=d.getOwnerList(),c.setOwnerList(b),b.insertAfter(c,d)):(b=new k({id:g}),c.setOwnerList(b),b.insertAfter(c,null)):f.error("No oldOwnerId!")},_onDetached:function(){this.getOwnerList().removeItem(this)},_onSelect:function(){this.getOwnerList().select()},_onRemoveSelect:function(){this.getOwnerList().removeSelect()},focus:function(){this.trigger("focus")},blur:function(){this.trigger("blur")},setIndent:function(a){a>0&&this.setBlockStyle("indent",a)},setHref:function(a){this._href=a||null,this.trigger("style-change","href",a)},getHref:function(){return this._href},getViewHref:function(){var a=this._href;return o.isGUID(a)?null:a},getHtmlHref:function(){var a=this._href;return o.isGUID(a)?"#"+a:a||"#"},setFirst:function(){this._isFirst||(this._isFirst=!0,this.trigger("sorting-change"))},isFirst:function(){return this._isFirst},setLast:function(){this._isLast||(this._isLast=!0,this.trigger("sorting-change"))},isLast:function(){return this._isLast},removeSorting:function(){var a=!1;this._isFirst&&(a=!0,this._isFirst=null),this._isLast&&(a=!0,this._isLast=null),a&&this.trigger("sorting-change")},toHtml:function(a,b,c){var d,f,g,h=this,i=document.createElement("div"),j=e("<a></a>"),k=e(i),l="";return c=!0===c,k.attr("yne-bulb-block","catalogue").css("white-space","pre-wrap"),h.isFirst()&&(l="first"),h.isLast()&&(l+="last"),k.attr("yne-bulb-order",l),h._applyBlockStylesOnElement(k,!0),a=a||0,b=null==b?h.getEndOffset():b,d=h.sliceText(a,b,!1),f=n.rich2html(d,{withDefault:c}),j.attr("href",h.getHtmlHref()).html(f),k.html(j),g=i.outerHTML,i=k=j=null,g},toXml:function(a){var b,c,d,f,g=this,i=h.__super__.toXml.apply(g,[a]),j=a.createElement("text"),k=g._richText.toString(),n=a.createTextNode(k);return j.appendChild(n),i.appendChild(j),f=g._richText.toXml(a,!0),f&&i.appendChild(f),b=a.createElement("styles"),m.toXml(g,b,a),i.appendChild(b),g.getHref()&&(c=a.createElement("href"),d=a.createElement("value"),e(d).text(g.getHref()),c.appendChild(d),i.appendChild(c)),l.appendToXml(g.unknownTree,i),e(i).attr("catalogue-id",g.getOwnerId()),e(i).attr("compat","true"),i},toJSON:function(a,c){var d=this,e=d.sliceText(a,c,!1),f=b.__super__.toJSON.apply(d);return f.richText=e.toJSON(),f.href=d.getHref(),f.ownerId=d.getOwnerId(),f},toCollabJSON:function(){var a=this,c=b.__super__.toJSON.apply(a);return c.richText=a._richText.toCollabJSON(),c.href=a.getHref(),c.ownerId=a.getOwnerId(),c}},d={fromXml:function(a){var c,d=new b;return d.parseIdFromXml(a),d.setText(i.fromXml(a)),e(a).children().each(function(a,b){switch(b.nodeName){case h.TAG_ID_NAME:case h.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":m.fromXml(d,b);break;case"href":c=e(b).find("value").text(),d.setHref(e(b).find("value").text());break;default:l.appendToTree(d.unknownTree,b)}}),d},fromJSON:function(a){return this._generalFromJSON(a,!1)},fromCollabJSON:function(a){var b=this._generalFromJSON(a,!0);return a.ownerId&&(b._oldOwnerId=a.ownerId),b},_generalFromJSON:function(a,c){if(!a||!a.blockType||a.blockType!==j.CATALOGUE||!a.richText)return void f.warn("jsonObj is not valid!");var d,e=new b;return d=c?i.fromCollabJSON(a.richText):i.fromJSON(a.richText),e.setText(d),g.each(a.styles,function(a,b){e.setBlockStyle(b,a)}),a.blockId&&e.setId(a.blockId),a.href&&e.setHref(a.href),e}},b=h.extend(c,d)}(),yne_common_util_headingMaps=function(a){var b,c,d,e,f=yne_underscore,g=!0,h={};b={default:{name:"普通文本","font-size":14},a:{name:"标题","font-size":32,bold:g},b:{name:"副标题","font-size":18,color:"#595959",bold:g},1:{name:"标题1","font-size":28,bold:g},2:{name:"标题2","font-size":20,bold:g},3:{name:"标题3","font-size":16,bold:g},4:{name:"标题4","font-size":14,bold:g}},c=[b.default,b.a,b.b,b[1],b[2],b[3],b[4]],d={};for(e in b)"default"!==e&&(h[e]=f.clone(b[e]),delete h[e].name,delete h[e].align);return{headingMap:b,headingArray:c,headingBlockStyles:d,headingInlineStyles:h}}(),yne_common_data_Heading=function(a){function b(a,b){var c=a.getLevel();c&&g(b).attr("level",c),g(b).attr("compat","true")}function c(a,b){var c=g(b).attr("level");a.setLevel(c)}var d,e,f,g=yne_jquery,h=yne_jtk_core_L,i=yne_underscore,j=yne_common_data_Paragraph,k=yne_common_data_RichText,l=yne_common_data_blockTypes,m=yne_common_util_headingMaps,n=yne_common_util_unknownTree,o=yne_common_util_blockStyles,p=yne_common_data_Rich2HtmlConvertor;return e={_type:l.HEADING,_level:null,initialize:function(){var a=this,b=a.options;j.prototype.initialize.apply(a,arguments),a.setLevel(b.level)},setLevel:function(a){a&&(this._level=a,this.trigger("content-change",this))},getLevel:function(){return this._level},getDefaultBlockStyles:function(){return i.extend({},d.__super__.getDefaultBlockStyles.apply(this,[]),m.headingBlockStyles[this._level])},getDefaultInlineStyles:function(){return i.extend({},d.__super__.getDefaultInlineStyles(),m.headingInlineStyles[this._level])},getBlockStyle:function(a,b){return"heading"===a?this._level:d.__super__.getBlockStyle.call(this,a,b)},getInlineStylesForEmpty:function(){return i.extend({heading:this.level},this.getDefaultInlineStyles())},toHtml:function(a,b,c){var d,e,f,h=this,i=document.createElement("div"),j=g(i);return c=!0===c,j.attr("yne-bulb-block","heading").attr("yne-bulb-level",h.getLevel()).attr("id",h.getId()).css("white-space","pre-wrap"),h._applyBlockStylesOnElement(j),a=a||0,b=null==b?h.getEndOffset():b,d=h.sliceText(a,b,!1),e=p.rich2html(d,{withDefault:c}),j.html(e),f=i.outerHTML,i=j=null,f},toXml:function(a){var c=this,e=d.__super__.toXml.apply(c,[a]);return b(c,e),e},toJSON:function(a,b){var c=this,e=c.sliceText(a,b,!1),f=d.__super__.toJSON.apply(c);return f.richText=e.toJSON(),f.level=c.getLevel(),f},toCollabJSON:function(){var a=this,b=d.__super__.toJSON.apply(a);return b.richText=a._richText.toCollabJSON(),b.level=a.getLevel(),b}},f={fromXml:function(a){var b=new d;return b.parseIdFromXml(a),b.setText(k.fromXml(a)),c(b,g(a)),g(a).children().each(function(a,c){switch(c.nodeName){case j.TAG_ID_NAME:case j.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":o.fromXml(b,c);break;default:n.appendToTree(b.unknownTree,c)}}),b},fromJSON:function(a){return this._generalFromJSON(a,!1)},fromCollabJSON:function(a){return this._generalFromJSON(a,!0)},_generalFromJSON:function(a,b){if(!a||!a.blockType||a.blockType!==l.HEADING||!a.richText)return void h.warn("jsonObj is not valid!");var c,e=new d;return c=b?k.fromCollabJSON(a.richText):k.fromJSON(a.richText),e.setText(c),i.each(a.styles,function(a,b){e.setBlockStyle(b,a)}),a.blockId&&e.setId(a.blockId),a.level&&e.setLevel(a.level),e}},d=j.extend(e,f)}(),yne_common_data_Hr=function(a){var b,c,d,e=yne_common_data_Block,f=yne_common_data_blockTypes,g=yne_jtk_core_L,h=yne_underscore,i=yne_jquery,j=yne_common_util_unknownTree,k=yne_common_util_blockStyles;return c={_type:f.HR,_styles:null,initialize:function(){var a=this;e.prototype.initialize.apply(a,arguments)},toXml:function(a){var c=this,d=b.__super__.toXml.apply(c,[a]),e=a.createElement("styles");return k.toXml(c,e,a),d.appendChild(e),j.appendToXml(c.unknownTree,d),d},toHtml:function(){var a=this,b=document.createElement("hr"),c=i(b),d=a.getBlockStyles();return c.attr("yne-bulb-block","hr"),h.each(d,function(a,b){c.attr("yne-style-"+b,a)}),c.css("clear","both"),b.outerHTML},toJSON:function(){return b.__super__.toJSON.apply(this)},toPlain:function(){return new Array(81).join("-")},countWords:function(){return 0},toCollabJSON:function(){return this.toJSON()}},d={fromXml:function(a){var c=new b,d=i(a);return c.parseIdFromXml(a),d.children().each(function(a,b){switch(b.nodeName){case e.TAG_ID_NAME:case e.LEGACY_TAG_ID_NAME:break;case"styles":k.fromXml(c,b);break;default:j.appendToTree(c.unknownTree,b)}}),c},fromJSON:function(a){if(!a||a.blockType!==f.HR)return void g.error("invalid jsonObj");var c=new b;return h.each(a.styles,function(a,b){c.setBlockStyle(b,a)}),c},fromCollabJSON:function(a){var b=this.fromJSON(a);return a.blockId&&b.setId(a.blockId),b}},b=e.extend(c,d)}(),yne_common_data_listItemMarker=function(a){function b(a){if(isNaN(a))return"";for(var b=[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xcc"],["","c","cc","ccc","cd","d","dc","dcc","dcc","cm"]],c="",d=0,e=0,f=1e3;e<3;e++,f/=10)d=Math.floor(a%f/(f/10)),c+=b[2-e][d];return c}function c(a){if(isNaN(a))return"";var b="a".charCodeAt(0),c="z".charCodeAt(0),d=c-b+1,e="";for(a--;a>=0;)e=String.fromCharCode(a%d+b)+e,a=Math.floor(a/d)-1;return e}var d=yne_jtk_core_L,e=yne_underscore,f=yne_common_data_inlineStyleToCss,g=["lower-roman","decimal","lower-alpha"],h=["square","disc","circle"];return{SUPPORTED_STYLES:["font-size","font-family","color","bold","italic"],isSupportedStyle:function(a){return this.SUPPORTED_STYLES.indexOf(a)>-1},
convertToCssStyle:function(a,b){if(a){var c=this,d=e.pick(a,c.SUPPORTED_STYLES);return b&&e.each(d,function(a,c){null!=a&&(d[c]=b.valueToView(c,a))}),f.convertToCssStyle(d)}},makeHtmlMarker:function(a){if(!a)return void d.warn("Failed to create marker",a);var b,c,e=this,f=a.getLevel(),i=a.getText();return b=a.isOrdered()?g[f%3]:h[f%3],i.getLength()&&(c=e.convertToCssStyle(i.getStylesAtIndex(0))),{listStyleType:b,markerStyles:c}},makePlainMarker:function(a,e){if(!a)return d.warn("Failed to create marker",a),"";e=!1!==e;var f,g="",h=a.getLevel();if(a.isOrdered()){switch(f=a.getIndex(),h%3){case 0:g=b(f);break;case 2:g=c(f);break;default:case 1:g=f}g+="."}else switch(h%3){case 0:g="■";break;case 2:g="○";break;default:case 1:g="●"}return e&&(g+=" "),g}}}(),yne_common_data_List=function(a){var b,c=yne_jtk_core_Class,d=yne_backbone.Events,e=yne_underscore,f=yne_jquery,g=yne_jtk_core_assert,h=yne_jtk_core_L;return b=c.extend(e.extend({_id:null,_type:null,_items:null,unknownAttrs:null,initialize:function(a){var c=this;c._id=a.listId,c._type=a.type,c._items=[],c._type!==b.ORDERED&&c._type!==b.UNORDERED&&(h.error("type should be ORDERED or UNORDERED",c._type),c._type=b.UNORDERED),c.unknownAttrs=[]},getId:function(){return this._id},isOrdered:function(){return this._type===b.ORDERED},isUnordered:function(){return this._type===b.UNORDERED},getType:function(){return this._type},setType:function(a){g(a===b.ORDERED||a===b.UNORDERED),a!==this._type&&(this._type=a,this.updateIndexes(!0),this.trigger("type-change"))},getLength:function(){return this._items.length},getItems:function(){return this._items},updateIndexes:function(a){var b,c,d,e=this,f=e._items,g=f.length,h=0,i={};for(b=0;b<g;++b)c=f[b],d=c.getLevel(),d>h?i[d]=1:i[d]?i[d]++:i[d]=1,h=d,c.setIndex(i[d]),a&&c.updateListType()},insertItem:function(a,b){var c=this,d=c._items;return g(a>0||a<=d.length),g(!(b in d)),d.splice(a,0,b),c.updateIndexes(),a},addItem:function(a){var b=this;a&&(b._items.push(a),b.updateIndexes())},insertAfter:function(a,b){var c=this,d=c._items,e=b?d.indexOf(b):-1;c.insertItem(e+1,a)},removeItem:function(a){var b=this,c=b._items,d=c.indexOf(a);return d>=0&&(c.splice(d,1),b.updateIndexes()),d},toCollabJSON:function(){var a=this,b={};return b.id=a._id,b.type=a._type,b}},d),{ORDERED:"ordered",UNORDERED:"unordered",fromXml:function(a){var c=f(a),d=c.attr("id"),g=c.attr("type"),h=new b({listId:d,type:g});return e.each(a.attributes,function(a){switch(a.nodeName){case"id":case"type":break;default:h.unknownAttrs.push(a.cloneNode(!0))}}),h},fromCollabJSON:function(a){return new b({type:a.type,listId:a.id})}})}(),yne_common_data_ListItem=function(a){var b,c=yne_common_data_Paragraph,d=yne_common_data_RichText,e=yne_common_data_blockTypes,f=yne_common_data_Rich2HtmlConvertor,g=yne_jquery,h=yne_underscore,i=yne_underscorestring,j=yne_jtk_core_L,k=yne_common_util_unknownTree,l=yne_common_util_blockStyles,m=yne_jtk_core_assert,n=yne_common_data_listItemMarker,o=yne_common_util_convertPlain,p=yne_common_data_Block,q=yne_common_data_List,r=yne_common_constants,s=yne_collaboration_collabUtils;return b=c.extend({_type:e.LIST_ITEM,_level:null,_ownerList:null,_index:null,listId:null,listType:null,initialize:function(a){var b=this,d=a.level||1;c.prototype.initialize.call(b,a),b.setLevel(d),b.setIndex(1),a.list&&(b._ownerList=a.list,b.listId=b._ownerList.getId(),b.listType=b._ownerList.getType()),!b.listId&&a.listId&&(b.listId=a.listId),!b.listType&&a.listType&&(b.listType=a.listType),a.id&&b.setId(a.id),a.text&&b.setText(a.text),b.on("attached",b._onAttached.bind(b)),b.on("detached",b._onDetached.bind(b))},setLevel:function(a){h.isNumber(a)&&(a=Math.max(a,1),a=Math.min(a,r.MAX_LIST_ITEM_LEVEL),this._level=a,this._ownerList&&this._ownerList.updateIndexes(),this.trigger("level-change",a))},getLevel:function(){return this._level},setIndex:function(a){h.isNumber(a)&&a>0&&(this._index=a,this.trigger("index-change",a))},getIndex:function(){return this._index},setOwnerList:function(a){var b=this;b._ownerList=a,b._ownerList&&(b.listId=b._ownerList.getId(),b.listType=b._ownerList.getType())},getOwnerList:function(){return this._ownerList},isOrdered:function(){return this._ownerList.isOrdered()},_onAttached:function(a){var c,d,f=this,g=f.getOwnerList(),h=a.getAllBlocks(),i=a.getBlockIndex(f),j=null;if(m(i>=0,"Block not attached yet.",i,f),!g&&f.listId&&(g=b.getOrCreateListById(h,d.getListId(),d.getListType())),0===g.getLength())g.insertAfter(f,null);else{for(c=i-1;c>=0;--c)if(d=h[c],e.isListItem(d)&&d.getOwnerList()===g){j=d;break}g.insertAfter(f,j)}},_onDetached:function(){this.getOwnerList().removeItem(this)},toXml:function(a){var c,d=this,e=d.getOwnerList();return e?(c=b.__super__.toXml.apply(d,[a]),c.setAttribute("level",d.getLevel()),c.setAttribute("list-id",d.listId),{listId:d.listId,listType:e.getType(),ownerList:e,listItem:c}):void j.error("The list item has no owner list!")},toJSON:function(a,b){return this._generalToJSON(a,b,!1)},toCollabJSON:function(){return this._generalToJSON(null,null,!0)},_generalToJSON:function(a,c,d){var e,f=this;return e=d?b.__super__.toCollabJSON.apply(f):b.__super__.toJSON.apply(f,[a,c]),e.level=f.getLevel(),e.index=f.getIndex(),f.listId&&(e.listId=f.listId),f.listType&&(e.listType=f.listType),e},toHtml:function(a,b,c){var d,e,h,i,j=this,k=document.createElement("li"),l=g(k);return c=!0===c,j._applyBlockStylesOnElement(l),l.css("list-style-position","inside").css("white-space","pre-wrap"),i=n.makeHtmlMarker(j),i&&i.listStyleType&&l.css("list-style-type",i.listStyleType),i&&i.markerStyles&&l.css(i.markerStyles),a=a||0,d=j.sliceText(a,b,!1),e=f.rich2html(d,{withDefault:c}),k.innerHTML=e,h=k.outerHTML,k=l=null,h},toPlain:function(a,b){var c,d,e=this,f=e.getLevel()||1;return a=a||0,c=e.sliceText(a,b,!1),d=c.toString(),d=o(d),d=n.makePlainMarker(e)+d,d=i.repeat(" ",4*f-2)+d},getListId:function(){var a=this;return a._ownerList?a._ownerList.getId():a.listId},getListType:function(){var a=this;return a._ownerList?a._ownerList.getType():a.listType},updateListType:function(){var a=this;a._ownerList&&(a.listType=a._ownerList.getType())}},{fromXml:function(a){var c,e=g(a),f=parseInt(e.attr("level"))||1;return c=new b({level:f}),c.setText(d.fromXml(a)),c.parseIdFromXml(a),g(a).children().each(function(a,b){switch(b.nodeName){case p.TAG_ID_NAME:case p.LEGACY_TAG_ID_NAME:case"text":case"inline-styles":break;case"styles":l.fromXml(c,b);break;default:k.appendToTree(c.unknownTree,b)}}),c},fromJSON:function(a){return this._generalFromJSON(a,!1)},fromCollabJSON:function(a){return this._generalFromJSON(a,!0)},getOrCreateListById:function(a,b,c){var d,f,g=null,h=b;for(f=a.length-1;f>=0;--f)if(d=a[f],e.isListItem(d)&&d.getOwnerList()&&d.getOwnerList().getId()===b){d.getOwnerList().getType()===c?g=d.getOwnerList():h=s.newGUID();break}return g||(g=new q({type:c,listId:h})),g},_generalFromJSON:function(a,c){var f,g,i,k;return a&&a.blockType&&a.blockType===e.LIST_ITEM?(a.listType&&(i=a.listType),a.listId&&(g=a.listId),a.blockId&&(k=a.blockId),f=new b({level:a.level,listId:g,listType:i,id:k}),a.index&&f.setIndex(a.index),c?f.setText(d.fromCollabJSON(a.richText)):f.setText(d.fromJSON(a.richText)),h.each(a.styles,function(a,b){f.setBlockStyle(b,a)}),f):void j.warn("jsonObj is not valid!")}})}(),yne_common_util_parseImgSource={parseImgSource:function(a){var b=a.split("?")[0].replace(/^\//,"").split("/");return{resId:b[b.length-1]}}},yne_common_data_Image=function(a){var b,c,d,e=yne_jquery,f=yne_underscore,g=yne_common_data_Block,h=yne_common_data_blockTypes,i=yne_jtk_core_L,j=yne_jtk_web_dom_parseHTML,k=yne_common_util_unknownTree,l=yne_common_util_blockStyles,m=yne_common_util_parseImgSource,n=yne_common_util_formatLocalSource,o=yne_common_util_platform;return b={_type:h.IMAGE,_source:null,_title:null,_fakeLoading:!1,_imageInfo:null,initialize:function(a){var b=this;g.prototype.initialize.apply(b,arguments),b._source=a.source,b._title=a.title,b._fakeLoading=a.fakeLoading||!1,b._resId=m.parseImgSource(b._source).resId},getHighlight:function(a){if(a&&a.length){var b=this,c=b._title,d=[];return f.each(a,function(a){for(var b=a.getLength(),e=0,f=c.indexOf(a,e);-1!==f;)d[f]={start:f,end:f+b},f=c.indexOf(a,f+b)}),d=f.compact(d),d.length?d:null}},setSource:function(a){var b=this;return!(!a||a===b._source)&&(b._source=a+"",b.trigger("content-change"),!0)},getSource:function(a){var b,c=this,d=c._source;return!0===a&&(b=c.getExtraInfo("pcResMap"))&&b[d]&&(d=b[d]),d},setTitle:function(a){var b=this;return a!==b._title&&(b._title=a+"",b.trigger("content-change"),!0)},getTitle:function(){return this._title},getResId:function(){return this._resId},getStyles:function(a){var b=this;return a?b.getBlockStyle(a):b.getBlockStyles()},setStyles:function(a,b){var c=this;return f.isString(a)?c.setBlockStyle(a,b):f.isObject(a)&&c.setBlockStyles(a),!0},setImageInfo:function(a){var b=this;a&&a.resId&&"number"==typeof a.rawWide?b._imageInfo=a:i.error("The imageInfo is not valid in image: "+b._resId)},getImageInfo:function(){return this._imageInfo},toXml:function(a){var b,c,e,f,g,h,i=this,j=i.getSource(),m=i.getTitle()||"";if(j)return b=d.__super__.toXml.apply(i,[a]),c=a.createElement("source"),e=a.createTextNode(j),c.appendChild(e),b.appendChild(c),f=a.createElement("text"),g=a.createTextNode(m),f.appendChild(g),b.appendChild(f),h=a.createElement("styles"),l.toXml(i,h,a),b.appendChild(h),k.appendToXml(i.unknownTree,b),b},toJSON:function(){var a=this,b=d.__super__.toJSON.apply(a);return b.source=a.getSource(),b.title=a.getTitle(),b},toHtml:function(a,b,c){var d,g,h,i=this,k=j("",document,!0,!0),l=k.ownerDocument,m=i.getStyles(),p=l.createElement("div"),q=e(p),r=e(l.createElement("img"));return q.attr("yne-bulb-block","image"),f.each(m,function(a,b){switch(b){case"align":q.css("text-align",a);break;case"width":null==a?r.css("width",""):r.css("width",a);break;case"float":q.css("float",a)}}),g=i.getSource(!0===c),h=i.getTitle(!0===c),o.IS_PC&&(g=n(g)),r.attr({"data-media-type":"image",src:g,alt:h}),q.append(r),d=p.outerHTML,l=p=q=r=null,d},toPlain:function(){return""},countWords:function(){return 0},setFakeLoading:function(a){this._fakeLoading=a},getFakeLoading:function(){return this._fakeLoading}},c={fromXml:function(a){var b=e(a),c=e.trim(b.find("> source:first").text()),f=e.trim(b.find("> text:first").text()),h=new d({source:c,title:f});return h.parseIdFromXml(a),b.children().each(function(a,b){switch(b.nodeName){case g.TAG_ID_NAME:case g.LEGACY_TAG_ID_NAME:case"source":case"text":break;case"styles":l.fromXml(h,b);break;default:k.appendToTree(h.unknownTree,b)}}),h},fromJSON:function(a){if(!a||!a.blockType||a.blockType!==h.IMAGE||!a.source)return void i.warn("jsonObj or jsonObj.source does NOT exist!");var b=new d({source:a.source,title:a.title});return a.styles&&b.setStyles(a.styles),a.blockId&&b.setId(a.blockId),b}},d=g.extend(b,c)}(),yne_jtk_web_dom_nodeType=function(a){var b=yne_underscore;return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,getType:function(a){if(a&&a.nodeType)return a.nodeType},isNode:function(a){var c=this,d=c.getType(a);return b.isNumber(d)&&d>=c.ELEMENT_NODE&&d<=c.NOTATION_NODE},isElement:function(a){return this.getType(a)===this.ELEMENT_NODE},isAttribute:function(a){return this.getType(a)===this.ATTRIBUTE_NODE},isText:function(a){return this.getType(a)===this.TEXT_NODE},isCDataSection:function(a){return this.getType(a)===this.CDATA_SECTION_NODE},isEntityReference:function(a){return this.getType(a)===this.ENTITY_REFERENCE_NODE},isEntity:function(a){return this.getType(a)===this.ENTITY_NODE},isProcessingInstruction:function(a){return this.getType(a)===this.PROCESSING_INSTRUCTION_NODE},isComment:function(a){return this.getType(a)===this.COMMENT_NODE},isDocument:function(a){return this.getType(a)===this.DOCUMENT_NODE},isDocumentType:function(a){return this.getType(a)===this.DOCUMENT_TYPE_NODE},isDocumentFragment:function(a){return this.getType(a)===this.DOCUMENT_TYPE_NODE},isNotation:function(a){return this.getType(a)===this.NOTATION_NODE}}}(),yne_common_data_table_tableCellType={TEXT:"text",IMAGE:"image",ATTACHMENT:"attachment"},yne_common_data_table_Resource=function(a){var b=yne_jtk_core_Class,c=yne_jtk_core_L;return b.extend({_type:null,_resId:null,getType:function(){return this._type},isType:function(a){return this._type===a},getResId:function(){return this._resId||c.error("No resId"),this._resId},toHtml:function(){c.error("toHtml() should be implemented by sub-class")},toPlain:function(){c.error("toPlain() should be implemented by sub-class")},toXml:function(){c.error("toXml() should be implemented by sub-class")},toJSON:function(){c.error("toJSON() should be implemented by sub-class")},toCollabJSON:function(){c.error("toCollabJSON() should be implemented by sub-class")}},{fromXml:function(){c.error("fromXml() should be implemented by sub-class")},fromCollabJSON:function(){c.error("fromCollabJSON() should be implemented by sub-class")},TYPE_IMAGE:"image",TYPE_ATTACHMENT:"attachment"})}(),yne_common_util_xml=function(a){var b=yne_jtk_core_L;return{appendText:function(a,c,d,e){if(!(a&&c&&d&&e))return void b.warn("unvalid parameters");var f=a.createElement(d),g=a.createTextNode(e);f.appendChild(g),c.appendChild(f)}}}(),yne_common_data_table_AttachmentResource=function(a){var b,c=yne_common_data_table_Resource,d=yne_common_util_parseImgSource,e=yne_jtk_core_L,f=yne_jquery,g=yne_underscore,h=yne_common_util_xml,i=yne_jtk_web_dom_parseHTML,j=yne_common_util_formatLocalSource,k=yne_common_util_platform;return b=c.extend({_type:c.TYPE_ATTACHMENT,initialize:function(a){var b=this;a=a||{},b._resId=a.resId||d.parseImgSource(a.resource).resId,b._source=a.source,b._resource=a.resource,b._fileLength=a.fileLength,b._fileName=a.fileName,delete b.options},getSource:function(a){var b=this,c=b._source;return a&&a[c]&&(c=a[c]),c},getResource:function(a){var b=this,c=b._resource;return a&&a[c]&&(c=a[c]),c},getInfo:function(){return{source:this._source,resource:this._resource,fileLength:this._fileLength,fileName:this._fileName}},getFileName:function(){return this._fileName},toPlain:function(){return""},toXml:function(a,b){var c=this,d=a.createElement("resource-mono"),e=a.createElement("attach"),f=c.getInfo();h.appendText(a,d,"res-id",c.getResId()),h.appendText(a,e,"source",f.source),h.appendText(a,e,"resource",f.resource),h.appendText(a,e,"filename",f.fileName),h.appendText(a,e,"filelength",f.fileLength),d.appendChild(e),b.appendChild(d)},toJSON:function(){return{resId:this.getResId()}},toCollabJSON:function(){var a,b=this;return a=b.getInfo(),a.resId=b._resId,a},toHtml:function(a){var b,c,d=this,e=i("",document,!0,!0),h=e.ownerDocument,l=f(h.createElement("img"));return a=g.defaults(a||{},{resourceMap:null}),c=d.getSource(a.resourceMap)||"",k.IS_PC&&(c=j(c)),l.attr({"data-media-type":"attachment",src:c,path:d.getResource(),filelength:d._fileLength,title:d._fileName,alt:d._fileName,filename:d._fileName}),b=l.get(0).outerHTML,h=l=null,b}},{create:function(a){return a&&a.source&&a.resource&&null!=a.fileLength&&a.fileName?(a.resId||e.warn("Will create resId by url!"),new b(a)):void e.warn("Failed to create AttachmentResource",a)},fromXml:function(a,c){var d=f(c),e=d.children("source:first").text(),g=d.children("resource:first").text(),h=d.children("filename:first").text(),i=d.children("filelength:first").text();return i&&(i=parseInt(i,10)),b.create({resId:a,source:e,resource:g,fileName:h,fileLength:i})},fromJSON:function(a,b){a.resId&&b&&b.attachMap||e.error("jsonObj or resourceList is wrong, ",a,b);var c=this,d=b.attachMap[a.resId];return d||e.error("resourceList is wrong"),c.fromCollabJSON(g.extend(a,d))},fromCollabJSON:function(a){return a.fileLength&&a.fileName&&a.resId&&a.resource&&a.source||e.error("jsonObj is wrong, ",a),b.create({resId:a.resId,source:a.source,resource:a.resource,fileName:a.fileName,fileLength:a.fileLength})}})}(),yne_common_data_table_ImageResource=function(a){var b,c=yne_common_data_table_Resource,d=yne_common_util_parseImgSource,e=yne_jtk_core_L,f=yne_jquery,g=yne_underscore,h=yne_common_util_xml,i=yne_common_util_formatLocalSource,j=yne_common_util_platform,k=yne_jtk_web_dom_parseHTML;return b=c.extend({_type:c.TYPE_IMAGE,_source:null,_width:null,_height:null,initialize:function(a){var b=this;a=a||{},b._resId=a.resId||d.parseImgSource(a.source).resId,b._source=a.source,b._width=a.width,b._height=a.height,delete b.options},getSource:function(a){var b=this,c=b._source;return a&&a[c]&&(c=a[c]),c},getSize:function(){return{width:this._width||null,height:this._height||null}},getInfo:function(){var a=this,b=a.getSize();return null===b.width&&null===b.height&&(b=null),g.extend({source:this.getSource()},b)},toPlain:function(){return""},toXml:function(a,b){var c=this,d=a.createElement("resource-mono"),e=a.createElement("image"),f=c.getSize();h.appendText(a,d,"res-id",c.getResId()),h.appendText(a,e,"source",c.getSource()),f&&g.each(["width","height"],function(a){var b=f[a];b&&h.appendText(e,a,b+"")}),d.appendChild(e),b.appendChild(d)},toJSON:function(){return{resId:this.getResId()}},toCollabJSON:function(){var a=this,b={};return b.source=a.getSource(),b.width=a._width||null,b.height=a._height||null,b.resId=a._resId,b},toHtml:function(a){var b,c,d=this,e=k("",document,!0,!0),h=e.ownerDocument,l=f(h.createElement("img"));return a=g.defaults(a||{},{resourceMap:null}),c=d.getSource(a.resourceMap)||"",j.IS_PC&&(c=i(c)),l.attr({"data-media-type":"image",src:c,width:"100%",height:"auto"}),b=l.get(0).outerHTML,h=l=null,b}},{create:function(a){return a&&a.source?(a.resId&&e.warn("Will create resId by url!"),new b(a)):void e.warn("Failed to create ImageResource",a)},fromXml:function(a,c){var d=f(c),e=d.children("source:first").text(),g=d.children("width:first").text(),h=d.children("height:first").text();return g&&(g=parseInt(g,10)),h&&(h=parseInt(h,10)),b.create({resId:a,source:e,width:g,height:h})},fromJSON:function(a,b){a.resId&&b&&b.imageMap||e.error("jsonObj is or resourceList wrong , ",a,b);var c=this,d=b.imageMap[a.resId];return d||e.error("resourceList wrong"),c.fromCollabJSON(g.extend(a,d))},fromCollabJSON:function(a){return a.resId&&a.source||e.error("jsonObj is wrong , ",a),b.create({resId:a.resId,source:a.source,width:a.width,height:a.height})}})}(),yne_common_data_table_Lines=function(a){var b,c=yne_jtk_core_Class,d=yne_underscore,e=yne_jtk_core_L,f=yne_common_data_Rich2HtmlConvertor,g=yne_common_data_RichText,h=yne_common_constants;return b=c.extend({initialize:function(a){var b=this;a=d.defaults(a||{},{richText:null}),delete b.options,b._richTextList=[],b.appendRichText(a.richText)},appendRichText:function(a){var c=this,d=b.splitRichText(a);d&&d.length&&(c._richTextList=c._richTextList.concat(d))},getAsRichTextList:function(){return[].concat(this._richTextList)},appendLines:function(a){if(a){var b=this;b._richTextList=b._richTextList.concat(a.getAsRichTextList())}},getCount:function(){return this._richTextList.length},isEmpty:function(){var a=this._richTextList;return!a||!a.length||d.every(a,function(a){return a&&a.isEmpty()})},_walkLinesRange:function(a,b){var c,d,e,f,g=this,h=g.getCount(),i=a.startLine,j=a.endLine;for(c=i;c<j&&c<h;c++)c===i?(d=g._richTextList[c],e=a.startChar,f=d.getLength()):c===j?(e=0,f=Math.min(d.getLength(),a.endChar)):(e=0,f=d.getLength()),b(d,e,f)},setStyle:function(a,b){var c,e=this;d.isArray(b)?(c=b,d.each(e._richTextList,function(b,d){var e=c[d];b.setStyle(0,b.getLength(),a,e)})):d.each(e._richTextList,function(c){c.setStyle(0,c.getLength(),a,b)})},getStyle:function(a){var b=this,c=[];return d.each(b._richTextList,function(b){var d=b.getStyle(0,b.getLength(),a);c.push(d)}),c},getCommonStyles:function(a,b,c){var d=this,e=d.toRichText();return a=a||0,b=b||e.getLength(),e.getCommonStyles(a,b,c)},getCommonStyle:function(a){var b,c=this;return d.some(c._richTextList,function(c){if(c&&!c.isEmpty()){var d=c.getCommonStyle(0,c.getLength(),a,!0);if(null==b)null!=d&&(b=d);else if(b!==d)return b=h.INTERM,!0}}),b===h.INTERM&&(b=null),b},toRichText:function(){var a,b=this,c=b.getCount(),d=b._richTextList,e=g.create("",!0);for(a=0;a<c;a++)e.append(d[a]),a<c-1&&e.append(g.create("\n",!0));return e},toString:function(){return this.toRichText().toString()},toPlain:function(){return d.map(this._richTextList,function(a){return a?a.toString():""})},toHtml:function(a){a=d.defaults(a||{},{handleLineWrapper:function(a){a.className="table-cell-line"}});var b=this,c=a.styleRules,e=d.map(b._richTextList,function(b,d){var e=f.rich2html(b,{styleRules:c}),g=document.createElement("div");return a.handleLineWrapper(g,b,d),g.innerHTML=e,g.outerHTML});return e=e.join("")},toJSON:function(){return d.map(this._richTextList,function(a){return a.toJSON()})},toCollabJSON:function(){return d.map(this._richTextList,function(a){return a.toCollabJSON()})}},{create:function(a){return a&&a.richText?new b(a):void e.warn("Failed to create Lines",a)},createBlank:function(a){return a?b.create({richText:g.createBlank(!1)}):new b({})},splitRichText:function(a){if(a){if(0===a.getLength()||!a.isKeepLineBreak())return[a];var b,c=a.getReadOnlyData(),e=[],f=[],h=0;for(h=0;h<c.length;h++)b=c[h],b.isLineBreak()?(e.push(f),f=[]):f.push(b);return f.length&&e.push(f),e=d.map(e,function(a){var b=g.create("",!1);return b.appendRichChars(a),b})}},fromJSON:function(a){var c=b.createBlank();return d.map(a,function(a){c.appendRichText(g.fromJSON(a))}),c},fromCollabJSON:function(a){var c=b.createBlank();return d.map(a,function(a){c.appendRichText(g.fromCollabJSON(a))}),c}})}(),yne_common_data_table_tableCellUtil=function(a){var b=yne_common_data_table_tableCellType,c=yne_jtk_core_L,d=yne_underscore,e=yne_common_data_table_Resource,f=yne_common_data_table_AttachmentResource,g=yne_common_data_table_ImageResource,h=yne_common_data_table_Lines;return{contentToPlain:function(a,b){if(!a)return"";var d;return a instanceof h?(d=a.toPlain(),d.join(b?"\n":"")):a instanceof g?a.toPlain():a instanceof f?a.toPlain():(c.warn("unvalid content",a),"")},contentToHtml:function(a,b){return a?a instanceof h||a instanceof g||a instanceof f?a.toHtml({resourceMap:b}):(c.warn("unvalid content",a),""):""},contentToJSON:function(a,c){c=!0===c;var d,f=b.TEXT;if(a){if(a.getType)switch(a.getType()){case e.TYPE_IMAGE:f=b.IMAGE;break;case e.TYPE_ATTACHMENT:f=b.ATTACHMENT}return d=c?a.toCollabJSON():a.toJSON(),{type:f,data:d}}},contentToCollabJSON:function(a){return this.contentToJSON(a,!0)},contentFromJSON:function(a,d,e){if(a){var i,j=a.type,k=a.data;switch(j){case b.IMAGE:i=d?g.fromCollabJSON(k):g.fromJSON(k,e);break;case b.ATTACHMENT:i=d?f.fromCollabJSON(k):f.fromJSON(k,e);break;case b.TEXT:i=d?h.fromCollabJSON(k):h.fromJSON(k);break;default:c.error("do not support type",j)}return i}},contentFromCollabJSON:function(a){return this.contentFromJSON(a,!0)},oldStyleNameMap:{bold:"bold",italic:"italic",underline:"underline",lineThrough:"strike",fontName:"font-family",fontSize:"font-size",textColor:"color",link:"href"},inlineStyle2oldCell:function(a){var b=this,c=this.oldStyleNameMap,e={};return d.map(c,function(c,d){if(null!=a[c])return void(e[d]=b.boolean2string(a[c]))}),e},blockStyle2oldCell:function(a){var b=this,c={};return d.map(a,function(a,d){c[d]=b.boolean2string(a)}),c},boolean2string:function(a){return d.isBoolean(a)?String(a):a}}}(),yne_common_data_table_tableRenderer=function(a){var b=yne_underscore,c=yne_jquery,d=yne_jtk_core_L,e=yne_common_data_table_tableCellUtil;return{_table:null,_tableEl:null,_setCellStyles:function(a,b,c){c=!1!==c;var d;d=b.textAlign,a.style.textAlign="center"===d||"right"===d||"left"===d?d:"",d=b.verticalAlign,a.style.verticalAlign="top"===d||"middle"===d||"bottom"===d?d:"",c||"true"===b.wrap?a.style.whiteSpace="pre-wrap":a.style.whiteSpace="nowrap",d=b.backColor,a.style.backgroundColor=d&&"inherit"!==d&&"transparent"!==d?d:""},_handleMergePointIfNeeded:function(a,b){if(b.isMergePoint()){var c=b.getMergePointAttr();c.width>0&&a.setAttribute("colspan",c.width),c.height>0&&a.setAttribute("rowspan",c.height)}},_renderCell:function(a,d,f,g){f=f||document.createElement("td"),c(f).css({"font-size":14,color:"#393939",border:"1px solid #a7a7a7",overflow:"hidden","vertical-align":"middle","word-wrap":"break-word","background-color":"rgba(255, 255, 255, 0.3)"}),g=b.defaults(g||{},{withCellId:!0,resourceMap:null});var h,i=this,j=i._table.getCell(a,d),k=j.getContent();return g.withCellId&&f.setAttribute("data-cell-id",j.getCellId()),i._handleMergePointIfNeeded(f,j),i._setCellStyles(f,j.getBlockStyles(),!0),h=e.contentToHtml(k,g.resourceMap),f.innerHTML=h,f},_createTableEl:function(){var a=document,b=a.createElement("table");return b.innerHTML="<colgroup></colgroup><tbody></tbody>",b},_renderColumns:function(a){var b=this,c=b._table;if(!a)return void d.warn("parameter is not valid",a);a.innerHTML="",c.forEachColumn(function(b){var d=c.getColumnWidth(b),e=document.createElement("col");e.style.width=d+"px",a.appendChild(e)})},renderTable:function(a,b,d){var e,f,g,h,i,j=this,k=a.getRowCount(),l=a.getColumnCount();for(b=b||j._createTableEl(),e=b.querySelector("tbody"),j._table=a,j._tableEl=b,h=0;h<k;h++){for(f=document.createElement("tr"),i=0;i<l;i++)g=a.getCell(h,i),g.isMergedCell()||f.appendChild(j._renderCell(h,i,null,{resourceMap:d}));f.style.height=a.getRowHeight(i)+"px",e.appendChild(f)}return j._renderColumns(b.querySelector("colgroup")),j._table=null,j._tableEl=null,c(b).css({"border-collapse":"collapse","table-layout":"fixed","white-space":"nowrap",width:0}),b}}}(),yne_common_data_table_resourceClassMap=function(a){return{image:yne_common_data_table_ImageResource,attach:yne_common_data_table_AttachmentResource}}(),yne_common_data_table_blockStyleConfig=function(a){return yne_common_util_freeze({textAlign:{type:"Enum",possible:{left:!0,right:!0,center:!0,justify:!0},default:"left"},verticalAlign:{type:"Enum",possible:{top:!0,middle:!0,bottom:!0},default:"left"},wrap:{type:"Boolean",default:!1},backColor:{type:"String",default:{BACK_COLOR:"transparent"}.BACK_COLOR}})}(),yne_common_data_table_supportedBlockStyles=function(a){var b=yne_underscore,c=yne_common_data_table_blockStyleConfig,d=b.keys(c)||[];return{isSupport:function(a){return d.indexOf(a)>-1},getConfig:function(a){var b,d=this;return d.isSupport(a)&&(b=c[a]),b},getDefault:function(a){return(this.getConfig(a)||{}).default},getAllDefaults:function(){var a=this,c={};return b.each(d,function(b){c[b]=a.getDefault(b)}),c},getAllStyleNames:function(){return[].concat(d)},bulbStyles2TableStyles:function(a){return a.align&&(a.textAlign=a.align,delete a.align),a},tableStyles2BulbStyles:function(a){return a.textAlign&&(a.align=a.textAlign,delete a.textAlign),a}}}(),yne_common_data_Todo=function(a){var b,c,d,e=yne_jquery,f=yne_underscore,g=yne_common_data_Block,h=yne_common_data_Paragraph,i=yne_common_data_blockTypes,j=yne_jtk_core_L,k=yne_common_util_unknownTree,l=yne_common_util_blockStyles,m=yne_common_data_Rich2HtmlConvertor,n=yne_common_data_RichText,o=yne_common_util_convertPlain;return b={_type:i.TODO,_checked:!1,_legacyResId:null,initialize:function(a){h.prototype.initialize.apply(this,arguments),null!=a.checked&&(this._checked=a.checked),null!=a.legacyResId&&(this._legacyResId=a.legacyResId)},setChecked:function(a){a!==this._checked&&(this._checked=a,this.trigger("checked-change",a))},getChecked:function(){return this._checked},isFromOldTodo:function(){return!!this._legacyResId},getLegacyResId:function(){return this._legacyResId},toXml:function(a){var b,c,e=this;return c=d.__super__.toXml.apply(e,[a]),b=a.createElement("checked"),b.appendChild(a.createTextNode(e.getChecked())),c.appendChild(b),k.appendToXml(e.unknownTree,c),c.setAttribute("compat","true"),c},toJSON:function(){var a=this,b=d.__super__.toJSON.apply(a,arguments);return b.checked=a.getChecked(),b},toHtml:function(a,b,c){var d,f=document.createElement("div"),g=e(document.createElement("div")),h=e(document.createElement("div")),i=this.getChecked(),j=e(f);return j.attr("yne-bulb-block","todo").attr("yne-bulb-checked",i).attr("id",this.getId()).css("display","table"),g.css({display:"inline-flex",position:"relative","line-height":"1",border:"1px solid #bbb",width:"1em",height:"1em"}),i&&(g.css({"background-repeat":"no-repeat","background-position":"center","background-size":"100%","background-image":"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgdmlld0JveD0iMCAwIDUwIDUwIiBzdHlsZT0iaGVpZ2h0OiAxMDAlO3dpZHRoOiAxMDAlO3N0cm9rZS13aWR0aDogMjtzdHJva2U6IGJsYWNrO3RvcDogMDtsZWZ0OiAwO3Bvc2l0aW9uOiBhYnNvbHV0ZTsiICB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnNrZXRjaD0iaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0xNC4xIDI3LjJsNy4xIDcuMiAxNi43LTE2LjgiPjwvcGF0aD4KPC9zdmc+)"}),j.css("text-decoration","line-through")),this._applyBlockStylesOnElement(j),a=a||0,b=null==b?this.getEndOffset():b,d=this.sliceText(a,b,!1),h.html(m.rich2html(d,{withDefault:c})),h.attr("yne-bulb-todo-content","").css({display:"table-cell","word-break":"break-word","padding-left":"8px",width:"100%"}),j.append(g),j.append(h),f.outerHTML},toPlain:function(a,b){a=a||0;var c=this,e=d.getMarker(c),f=c.sliceText(a,b,!1);return e+o(f.toString())},countWords:function(){return this.content.length},toCollabJSON:function(){var a=d.__super__.toCollabJSON.call(this);return a.checked=this.getChecked(),a}},c={CHECKED_MARKER:"✔",UNCHEKED_MARKER:"☐",getMarker:function(a){if(!a)return"";var b=a.getChecked()?d.CHECKED_MARKER:d.UNCHEKED_MARKER;return b+=" "},fromXml:function(a){var b=e(a),c="true"===b.find("> checked:first").text(),f=new d({checked:c});return f.setText(n.fromXml(a)),f.parseIdFromXml(a),b.children().each(function(a,b){switch(b.nodeName){case g.TAG_ID_NAME:case g.LEGACY_TAG_ID_NAME:case"checked":case"text":case"inline-styles":break;case"styles":l.fromXml(f,b);break;default:k.appendToTree(f.unknownTree,b)}}),f},fromJSON:function(a){return c._generalFromJSON(a,!1)},fromCollabJSON:function(a){return c._generalFromJSON(a,!0)},_generalFromJSON:function(a,b){if(!a||!a.blockType||a.blockType!==i.TODO)return void j.warn("jsonObj or jsonObj.content does NOT exist!");var c,e=new d({checked:a.checked});return a.blockId&&e.setId(a.blockId),c=b?n.fromCollabJSON(a.richText):n.fromJSON(a.richText),e.setText(c),f.each(a.styles,function(a,b){e.setBlockStyle(b,a)}),e}},d=h.extend(b,c)}(),yne_common_data_table_TableCell=function(a){var b,c=yne_jtk_core_Class,d=yne_underscore,e=yne_underscorestring,f=yne_jtk_core_L,g=yne_common_data_table_Resource,h=yne_common_data_table_supportedBlockStyles,i=yne_common_data_RichText,j=yne_common_data_table_Lines,k=yne_common_data_table_tableCellUtil,l=yne_common_data_table_tableCellType,m=yne_common_data_listItemMarker,n=yne_common_data_Todo,o=yne_collaboration_collabUtils,p=["mergeWidth","mergeHeight","mergePointDX","mergePointDY"],q=yne_common_data_blockTypes,r=yne_common_data_table_ImageResource,s=yne_common_data_table_AttachmentResource;return b=c.extend({_cellId:null,_content:null,_mergeWidth:null,_mergeHeight:null,_mergePointDX:null,_mergePointDY:null,_styles:null,_locked:!1,_unknown:null,_stylesForEmpty:null,initialize:function(a){var b=this;a=a||{},b._styles={},b._cellId=a.cellId||o.newGUID(),b.setContent(a.content),b.setBlockStyles(a.styles),b.setMergePointAttr(a.mergeWidth,a.mergeHeight),b.setMergedCellAttr(a.mergePointDX,a.mergePointDY),b.setUnknown(a.unknown),b._stylesForEmpty={},delete b.options},getCellId:function(){return this._cellId},_setCellId:function(a){a&&(this._cellId=a)},setBlockStyle:function(a,b){var c=this,e=h.getConfig(a)
;e&&(c.isLocked()||("Enum"===e.type?e.possible[b]||(b=e.default):"Number"!==e.type||d.isNumber(b)?"Boolean"!==e.type||d.isBoolean(b)?d["is"+e.type]&&(d["is"+e.type](b)||(b=b.default)):b="true"===b:(b=null===b||""===b?NaN:Number(b),!isNaN(b)&&b||(b=e.default)),b=b||e.default,c._styles[a]=b,f.log("style-change "+a+": "+b)))},clearStyles:function(){this._styles={}},getBlockStyles:function(){return this._styles},getBlockStylesAsBulb:function(){var a=d.clone(this._styles);return h.tableStyles2BulbStyles(a)},getContent:function(){return this._content},setContent:function(a){var b=this,c=!1;if(!b.isLocked())return a instanceof j?(b._content=a,c=!0,b.isTextNoEmptyCell()&&b.clearStylesForEmpty()):a instanceof g&&(b._content=a,c=!0),c},setBlockStyles:function(a){var b=this;if(!b.isLocked())return a?(d.each(a,function(a,c){b.setBlockStyle(c,a,!1)}),!0):void 0},setInlineStyles:function(a){if(a&&this.isTextNoEmptyCell()){var b=this.getContent();d.each(a,function(a,c){b.setStyle(c,a)})}},getInlineStyles:function(a){if(this.isTextNoEmptyCell()){var b=this.getContent(),c={};return a.forEach(function(a){c[a]=b.getStyle(a)}),c}},getType:function(){var a=this,b=l.TEXT,c=a.getContent();if(c&&c.getType)switch(c.getType()){case g.TYPE_IMAGE:b=l.IMAGE;break;case g.TYPE_ATTACHMENT:b=l.ATTACHMENT}return b},isTextNoEmptyCell:function(){var a=this.getContent();return!!a&&(this.getType()===b.TYPE_TEXT&&!a.isEmpty())},isAttachmentCell:function(){return this.getType()===l.ATTACHMENT},isImageCell:function(){return this.getType()===l.IMAGE},clearMergePointAttr:function(){delete this._mergeWidth,delete this._mergeHeight},clearMergedCellAttr:function(){delete this._mergePointDX,delete this._mergePointDY},getMergePointAttr:function(){var a=this;return{width:a._mergeWidth||0,height:a._mergeHeight||0}},getMergedCellAttr:function(){var a=this;return{dx:a._mergePointDX||0,dy:a._mergePointDY||0}},setMergePointAttr:function(a,b){var c=this;return!(!a&&!b)&&(a>=1&&!b&&(f.warn("No valid mergeHeight, will set 1"),b=1),b>=1&&!a&&(f.warn("No valid mergeWidth, will set 1"),a=1),c._mergeWidth=a,c._mergeHeight=b,c.clearMergedCellAttr(),!0)},setMergedCellAttr:function(a,b){var c=this;if(null!=a&&null!=b&&a>=0&&b>=0&&(a>0||b>0))return c._mergePointDX=a,c._mergePointDY=b,c.clearMergePointAttr(),!0},isMergePoint:function(){var a=this.getMergePointAttr();return a.width>1||a.height>1},isMergedCell:function(){var a=this.getMergedCellAttr();return a.dx>=1||a.dy>=1},setUnknown:function(a){a&&(this._unknown=a)},isLocked:function(){return this._locked},setLocked:function(a){this._locked=!0===a},isEmpty:function(){var a=this,b=a.getType(),c=a._content;return b===l.TEXT&&(!c||c.isEmpty())},getCommonInlineStyle:function(a){var b=this,c=b.getContent();return b.isTextNoEmptyCell()&&c.getCommonStyle?c.getCommonStyle(a):b._stylesForEmpty[a]},getCommonInlineStyles:function(){var a=this,b=a.getContent();return a.isTextNoEmptyCell()&&b.getCommonStyles?b.getCommonStyles():a._stylesForEmpty},setStylesForEmpty:function(a){f.log("setStylesForEmpty",a),d.extend(this._stylesForEmpty,a)},getStylesForEmpty:function(a){var b,c=this;return a?(b={},d.each(a,function(a){b[a]=c._stylesForEmpty[a]}),b):c._stylesForEmpty},clearStylesForEmpty:function(){this._stylesForEmpty={}},toPlain:function(a){var b=this;return b.isMergedCell()?"":k.contentToPlain(b._content,a)},toHtml:function(){f.erro("Should not call TabelCell.toHtml()")},toJSON:function(a){var b,c=this,e={},f={};return c.isMergedCell()&&(e=d.extend(e,c.getMergedCellAttr()),d.extend(f,{mergePointDX:e.dx,mergePointDY:e.dy})),c.isMergePoint()&&(e=d.extend(e,c.getMergePointAttr()),d.extend(f,{mergeWidth:e.width,mergeHeight:e.height})),c.isTextNoEmptyCell()&&(f.value=c._content.toString(),a&&(b=c._content.getCommonStyles(null,null,!0),d.extend(f,k.inlineStyle2oldCell(b)))),a?d.extend(f,k.blockStyle2oldCell(c._styles)):d.extend(f,{cellId:c.getCellId(),content:k.contentToJSON(c._content)},k.blockStyle2oldCell(c._styles)),f},toCollabJSON:function(){var a,b=this,c={};return b.isMergedCell()&&(c=d.extend(c,b.getMergedCellAttr())),b.isMergePoint()&&(c=d.extend(c,b.getMergePointAttr())),a={cellId:b.getCellId(),styles:d.extend({},b._styles),content:k.contentToCollabJSON(b._content)},d.isEmpty(c)||(a.attr=c),a},toXml:function(a,b,c){var e,g,h,i,j,k,m=this,n={};if(m.isMergedCell())return e=m.getMergedCellAttr(),{value:"",mergePointDX:e.dx,mergePointDY:e.dy};switch(m.isMergePoint()&&(e=m.getMergePointAttr(),n={mergeWidth:e.width,mergeHeight:e.height}),g=m.getType(),h=m.getContent(),d.isEmpty(m._styles)||d.extend(n,m._styles),d.isEmpty(m._unknown)||d.extend(n,m._unknown),g){case l.TEXT:i=h.toRichText(),j=i.toJSON(!0),n.value=j.text,j.inlineStyles&&(n.inlineStyles=j.inlineStyles);break;case l.IMAGE:case l.ATTACHMENT:k=h.getResId(),n.value="",n.resource=k,k&&!0===c[k]?f.warn("resource has already in <resource-list>",k,h):(h.toXml(a,b),c[k]=!0);break;default:f.error("unvalid type",g)}return n}},{TYPE_TEXT:"text",TYPE_IMAGE:"image",TYPE_ATTACHMENT:"attachment",create:function(a){if(!a||!a.content)return void f.warn("Failed to create TableCell",a);var c=a.content;return c instanceof j||c instanceof g?new b(a):void f.warn("Failed to create TableCell",a)},makeCellId:function(a,b,c){return[a,"cell",b,c].join("-")},createByTable:function(a,c,d,e){var f=a.getId(),g=b.makeCellId(f,c,d);return b.create({cellId:g,content:e})},_richTextFromJSON:function(a){if(a&&a.value){var b=a.value,c=new i({text:b}),e=k.oldStyleNameMap,f=c.getLength();return d.each(e,function(b,e){var g=b,h=a[e];null!=h&&("font-size"===g&&d.isString(h)&&(h=h.replace("px","")),c.setStyle(0,f,g,h))}),a.inlineStyles&&d.each(a.inlineStyles,function(a,b){d.each(a,function(a){c.setStyle(a.from,a.to,b,a.value)})}),c}},_linesFromJSON:function(a){var c=b._richTextFromJSON(a);return c?j.create({richText:c}):j.createBlank()},_resourceFromJSON:function(a,b){if(a&&a.resource){var c=a.resource,d=b[c];return d&&d.getResId&&d.getResId()===c?d:void 0}},fromJSON:function(a,c,e){a||f.error("Bad json data!");var g={};return g.styles=d.pick(a,h.getAllStyleNames()),d.extend(g,d.pick(a,p),{cellId:a.cellId,content:k.contentFromJSON(a.content,!1,e)||j.createBlank()}),c&&delete g.cellId,b.create(g)},fromCollabJSON:function(a){var c={cellId:a.cellId,styles:a.styles,content:k.contentFromCollabJSON(a.content)};return a.attr&&(c.mergeWidth=a.attr.width,c.mergeHeight=a.attr.height,c.mergePointDX=a.attr.dx,c.mergePointDY=a.attr.dy),b.create(c)},fromXml:function(a){if(!a||!a.tableBlockId||null==a.rowIndex||null==a.colIndex)return void f.warn("Failed to create TableCell from JSON",a);var c,e=this,g=b.makeCellId(a.tableBlockId,a.rowIndex,a.colIndex),i={cellId:g},l=a.cellRawData,m=a.resourceMap,n=e._resourceFromJSON(l,m),o=p,q=h.getAllStyleNames(),r=["value","resource","inlineStyles"].concat(o,q);return n?i.content=n:(c=e._linesFromJSON(l),i.content=c||j.createBlank()),l=l||{},i.unknown=d.omit(l,r.concat(d.keys(k.oldStyleNameMap))),i.styles=d.pick(l,q),d.extend(i,d.pick(l,o)),b.create(i)},blockToCellContent:function(a){if(a){var b,c,g,h,k,l,o=q.getType(a);switch(o){case q.PARAGRAPH:case q.CATALOGUE:c=j.create({richText:a.getText()});break;case q.IMAGE:case q.HANDWRITE:c=r.create({source:a.getSource()});break;case q.ATTACHMENT:c=s.create({source:a.getSource(),resource:a.getResource(),fileName:a.getFileName(),fileLength:a.getFileLength()});break;case q.LIST_ITEM:b=a.getText(),b.getLength()&&(l={},d.each(b.getStylesAtIndex(0),function(a,b){m.isSupportedStyle(b)&&(l[b]=a)})),h=m.makePlainMarker(a,!1),h=i.create(h,!1),l&&h.setStyles(0,h.getLength(),l),h.append(i.create(" ",!1)),g=a.getLevel()||1,k=e.repeat(" ",4*(g-1)),k=i.create(k,!1),k.append(h),k.append(b),c=j.create({richText:k});break;case q.TODO:k=n.getMarker(a),k=i.create(k,!1),b=a.getText(),a.getChecked()&&b.setStyles(0,b.getLength(),{strike:!0}),k.append(b),c=j.create({richText:k});break;default:f.warn("Failed to handle block to cell",o,a)}return c}},blockToCell:function(a){var c,d=b.blockToCellContent(a);return d&&(c=b.create({content:d})),c}})}(),yne_common_data_table_constantConfig=function(a){var b=yne_common_util_freeze,c={DEFAULT_ROW_HEIGHT:40,DEFAULT_COL_WIDTH:70,MIN_ROW_COUNT:1,MIN_COL_COUNT:1,MAX_ROW_COUNT:500,MAX_COL_COUNT:35,ATTACHMENT_MIN_WIDTH:285,ATTACHMENT_MIN_HEIGHT:64,DEFAULT_TABLE_WIDTH:620};return c=b(c,!0)}(),yne_common_data_table_tableUtil=function(a){var b=yne_underscore,c=yne_jtk_core_L,d=yne_common_data_table_TableCell;return{cellsFromJSON:function(a){var b,e,f,g=a.cellsJson,h=a.height,i=a.width,j=a.isUpdateCellId,k=a.resourceList,l=[];if(!g)return null;for(b=0;b<h;b++)for(l[b]=[],e=0;e<i;e++)f=b*i+e,g[f]||c.error("Bag json data, no cellData json, row, col: ",g,b,e),l[b][e]=d.fromJSON(g[f],j,k);return l},cellsToCollabJSON:function(a){return a?b.map(a,function(a){return b.map(a,function(a){return a.toCollabJSON?a.toCollabJSON():a})}):null},cellsFromCollabJSON:function(a){return a?b.map(a,function(a){return b.map(a,function(a){return d.fromCollabJSON(a)})}):null}}}(),yne_common_data_tableDataCheck_createBlankCell=function(){return{value:""}},yne_common_data_tableDataCheck_createBlankTable=function(a){var b=yne_common_data_table_constantConfig,c=yne_common_data_tableDataCheck_createBlankCell;return function(a,d){a=a||1,d=d||1;var e,f=[],g=[],h=[],i=a*d;for(e=0;e<a;e++)g.push(b.DEFAULT_ROW_HEIGHT);for(e=0;e<d;e++)f.push(b.DEFAULT_COL_WIDTH);for(e=0;e<i;e++)h.push(c());return{widths:f,heights:g,cells:h}}}(),yne_common_data_tableDataCheck_size=function(a){var b=yne_common_data_tableDataCheck_createBlankTable,c=yne_common_data_tableDataCheck_createBlankCell,d=yne_underscore,e=yne_common_data_table_constantConfig;return{name:"size",checkAndFix:function(a){if(!a.cells||!d.isArray(a.cells))return{errors:["The `cells` property is not Array type!"],fixedData:b(),stopCheck:!0};var f,g,h=a.cells,i=a.widths,j=a.heights,k=!0,l=!0,m=[];for(i&&d.isArray(i)||(k=!1,m.push("The `widths` property is not Array type!")),j&&d.isArray(j)||(l=!1,m.push("The `heights` property is not Array type!")),k||l?k?l||(j=[],0===i.length&&(i.length=5),j.length=Math.ceil(h.length/i.length)):(i=[],0===j.length&&(j.length=5),i.length=Math.ceil(h.length/j.length)):(i=[],i.length=5,j=[],j.length=Math.ceil(h.length/i.length)),f=i.length*j.length,g=!1;f<h.length;)j.push(e.DEFAULT_ROW_HEIGHT),f=i.length*j.length,g=!0;for(g&&m.push("The widths.length * heights.length is less than cells.length"),f=i.length*j.length,g=!1;f>h.length;)h.push(c()),g=!0;return g&&m.push("The widths.length * heights.length is greater than cells.length"),g=!1,i=d.map(i,function(a){return a&&d.isNumber(a)?a:(g=!0,e.DEFAULT_COL_WIDTH)}),g&&m.push("The `widths` has unvalid value"),g=!1,j=d.map(j,function(a){return a&&d.isNumber(a)?a:(g=!0,e.DEFAULT_ROW_HEIGHT)}),g&&m.push("The `heights` has unvalid value"),{errors:m,fixedData:{widths:i,heights:j,cells:h},stopCheck:!1}}}}(),yne_common_data_tableDataCheck_cellValue=function(a){var b=yne_common_data_tableDataCheck_createBlankCell,c=yne_underscore;return{name:"cellValue",checkAndFix:function(a){var d,e,f,g=a.cells,h=g.length,i=!1,j=!1,k=[];for(d=0;d<h;d++)e=g[d],c.isObject(e)?null==(f=e.value)||c.isString(f)||(j=!0,e.value=f+""):(i=!0,g[d]=b());return i&&k.push("Some cell is NOT Object type"),j&&k.push("The value of some cell is not String type"),{errors:k,fixedData:a,stopCheck:!1}}}}(),yne_common_data_tableDataCheck_mergeDefaults=function(a){var b=yne_underscore;return{name:"mergeDefaults",checkAndFix:function(a){var c=a.cells,d=!1,e=[];return b.each(c,function(a){a.mergeWidth&&!a.mergeHeight?(a.mergeHeight=1,d=!0):a.mergeHeight&&!a.mergeWidth&&(a.mergeWidth=1,d=!0)}),d&&e.push("Some cell has no default value for mergeHeight or mergeWidth"),{errors:e,fixedData:a,stopCheck:!1}}}}(),yne_common_data_tableDataCheck_mergeCells=function(a){var b=yne_underscore,c=function(a,c,d){var e={},f="";return b.some(a,function(c,g){if(!e[g+""]){var h,i,j,k,l,m,n,o,p,q,r,s;if(c.mergeWidth||c.mergeHeight){if(c.mergeWidth&&!b.isNumber(c.mergeWidth))return f="The mergeWidth is not Number type",!0;if(c.mergeHeight&&!b.isNumber(c.mergeHeight))return f="The mergeHeight is not Number type",!0;if(null!=c.mergePointDX||null!=c.mergePointDY)return f="The cell data is not valid, index: "+g,!0;for(h=c.mergeWidth||1,i=c.mergeHeight||1,j=Math.floor(g/d),k=g%d,p=0;p<i;p++)for(l=j+p,o=0;o<h;o++)if(p>0||o>0){if(m=k+o,n=l*d+m,q=a[n],q.mergeWidth||q.mergeHeight)return f="The merged cell should not have `mergeWidth` or `mergeHeight`, merge point cell index: "+g+", merged cell index: "+n,!0;if(q.value)return f="The `value` of merged cell should be empty string,merge point cell index: "+g+", index: "+n,!0;if(r=q.mergePointDX||0,s=q.mergePointDY||0,r!==o||s!==p)return f="The `mergePointDX` or `mergePointDY` of mergedCell is not valid, merge point cell index: "+g+",  merged cell index: "+n,!0;e[n+""]=!0}}e[g+""]=!0}}),f||!0};return{name:"mergeCells",checkAndFix:function(a){var d=a.cells,e=a.heights,f=a.widths,g=c(d,e.length,f.length),h=[];return!0!==g&&(h.push(g),b.each(d,function(a){delete a.mergeWidth,delete a.mergeHeight,delete a.mergePointDX,delete a.mergePointDY})),{errors:h,fixedData:a,stopCheck:!1}}}}(),yne_common_data_tableDataCheck_checkAndFix=function(a){var b=yne_underscore,c=[yne_common_data_tableDataCheck_size,yne_common_data_tableDataCheck_cellValue,yne_common_data_tableDataCheck_mergeDefaults,yne_common_data_tableDataCheck_mergeCells];return function(a){a=a||{};var d,e,f,g=window.JSON.parse(window.JSON.stringify(a)),h=c.length,i=g,j=[],k=function(a){j.push(e.name+".js: "+a)};for(d=0;d<h;d++){if(e=c[d],f=e.checkAndFix(i),b.each(f.errors,k),!0===f.stopCheck)return{errors:j,fixedData:f.fixedData};i=f.fixedData}return{errors:j,fixedData:i}}}(),yne_common_util_forEachTimes=function(a,b,c,d){var e,f,g;for(e=0;e<c;e++)if(g=b?c-e-1:e,null==d){if(!1===a(g))return}else for(f=0;f<d;f++)if(!1===a(g,b?d-f-1:f))return},yne_common_data_Table=function(a){var b=yne_common_data_Block,c=yne_common_data_blockTypes,d=yne_jquery,e=yne_underscore,f=yne_jtk_core_L,g=yne_jtk_web_dom_nodeType,h=yne_common_util_unknownTree,i=yne_common_util_blockStyles,j=yne_common_data_table_tableRenderer,k=yne_common_util_countText,l=yne_common_data_table_tableCellType,m=yne_common_data_table_resourceClassMap,n=yne_common_data_table_TableCell,o=yne_common_data_table_constantConfig,p=yne_common_data_RichText,q=yne_common_data_table_Lines,r=yne_common_data_table_supportedBlockStyles,s=yne_common_data_table_tableUtil,t=yne_common_data_tableDataCheck_checkAndFix,u=yne_common_constants,v=yne_common_util_forEachTimes,w=b.extend({_type:c.TABLE,_tableCells:null,_rowHeights:null,_colWidths:null,_resourceMap:null,initialize:function(a){var c=this;b.prototype.initialize.apply(c,arguments),a=a||{},c.setContentData(a.tableCells,a.rowHeights,a.colWidths),c._resourceMap=a.resourceMap,delete c.options,e.bindAll(c,"_onDetached","_onAttached","_onLockedChange"),c.on("detached",c._onDetached),c.on("attached",c._onAttached),c.on("locked-change",c._onLockedChange)},setContentData:function(a,b,c){var d=this;a&&a.length&&b&&b.length&&c&&c.length&&(d._tableCells=a,d._rowHeights=b,d._colWidths=c,setTimeout(function(){d._checkAndFixTableData()}))},_checkAndFixTableData:function(){var a,b,c=this,d=c.toJSON();try{a=t(d.data),a.errors.length&&(window.console.warn("Table data fix errors:  \n"+a.errors.join("\n")),f.log(d),b=a.fixedData,c._tableCells=s.cellsFromJSON({cellsJson:b.cells,height:b.heights.length,width:b.widths.length,resourceList:d.resourceList}),c._rowHeights=b.heights,c._colWidths=b.widths,c.trigger("content-change"))}catch(a){f.error("Table data fix failed",a)}},getRowCount:function(){var a=this._rowHeights||[],b=a.length;return Math.max(o.MIN_ROW_COUNT,b)},getColumnCount:function(){var a=this._colWidths||[],b=a.length;return Math.max(o.MIN_COL_COUNT,b)},getRowHeight:function(a){return this._rowHeights[a]||o.DEFAULT_ROW_HEIGHT},setRowHeight:function(a,b){var c=this;c.isLocked()||(c._rowHeights[a]=b,c.trigger("row-height-set",a,b))},getColumnWidth:function(a){return this._colWidths[a]||o.DEFAULT_COL_WIDTH},setColumnWidth:function(a,b){var c=this;c.isLocked()||(c._colWidths[a]=b,c.trigger("col-width-set",a,b))},_getCellAt:function(a,b){var c,d=this,e=d._tableCells;return e[a]&&e[a][b]&&(c=e[a][b]),c||f.warn("Failed to get cell at row/col",a,b),c},_findMergePoint:function(a,b){var c,d=this,e=d._getCellAt(a,b);return e&&e.isMergedCell()&&(c=e.getMergedCellAttr(),a-=c.dy,b-=c.dx,e=d._getCellAt(a,b)),e?{row:a,col:b,cell:e}:void f.warn("Failed to find merge point row/col",a,b)},getCell:function(a,b,c){c=e.defaults(c||{},{findMergePointIfNeeded:!1,withPosition:!1});var d,f,g=this;if(!c.findMergePointIfNeeded){if(!(f=g._getCellAt(a,b)))return;return!0===c.withPosition?{cell:f,row:a,col:b}:f}return d=g._findMergePoint(a,b),c.withPosition?d:d&&d.cell?d.cell:null},_getCellSize:function(a,b,c){if(a&&!a.isMergedCell()){var d,f,g=this,h=function(a,b){return a+b};if(a&&!a.isMergedCell())return a.isMergePoint()?(d=a.getMergePointAttr())&&d.width&&d.height&&(f={widths:[],heights:[],rows:[],cols:[]},v(function(a){var b=c+a,d=g.getColumnWidth(b);f.widths.push(d),f.cols.push(b)},!1,d.width),v(function(a){var c=b+a,d=g.getRowHeight(c);f.heights.push(d),f.rows.push(c)},!1,d.height)):f={widths:[g.getColumnWidth(c)],heights:[g.getRowHeight(b)],rows:[b],cols:[c]},f&&(f.width=e.reduce(f.widths,h,0),f.height=e.reduce(f.heights,h,0)),f}},getCellSize:function(a,b){var c=this,d=c.getCell(a,b,{findMergePointIfNeeded:!0,withPosition:!0});if(d&&d.cell)return c._getCellSize(d.cell,d.row,d.col)},getCellSizeById:function(a){var b=this,c=b.getCellById(a);if(c&&c.cell)return b._getCellSize(c.cell,c.row,c.col)},getCellById:function(a){if(g.isElement(a)&&(a=d(a).data("cellId")),a){var b,c,e,f=this,h=f.getRowCount(),i=f.getColumnCount();for(b=0;b<h;b++)for(c=0;c<i;c++)if((e=f.getCell(b,c))&&e.getCellId()===a)return{cell:e,row:b,col:c}}},getPosition:function(a){if(a){var b,c,d=this,e=d.getRowCount(),f=d.getColumnCount();for(b=0;b<e;b++)for(c=0;c<f;c++)if(d.getCell(b,c)===a)return{row:b,col:c}}},isMergePoint:function(a,b){var c=this.getCell(a,b);return c&&c.isMergePoint&&c.isMergePoint()},isMergedCell:function(a,b){var c=this.getCell(a,b);return c&&c.isMergedCell&&c.isMergedCell()},getMergePointAttrAt:function(a,b){var c=this._getCellAt(a,b),d={};return c?c.getMergePointAttr():d},setMergePointAttrAt:function(a,b,c,d){if(!this.isLocked()){var e=this._getCellAt(a,b);e&&(e.setMergePointAttr(c,d),this.trigger("attribute-changed"))}},getMergedCellAttrAt:function(a,b){var c=this._getCellAt(a,b),d={};return c?c.getMergedCellAttr(a,b):d},setMergedCellAttrAt:function(a,b,c,d){if(!this.isLocked()){var e=this._getCellAt(a,b);e&&(e.setMergedCellAttr(c,d),this.trigger("attribute-changed"))}},clearCellAttr:function(a,b){if(!this.isLocked()){var c=this._getCellAt(a,b);c&&(c.clearMergePointAttr(),c.clearMergedCellAttr(),this.trigger("attribute-changed"))}},getContentAt:function(a,b){var c=this.getCell(a,b);if(c)return{content:c.getContent(),type:c.getType()}},setCellContent:function(a,b,c){var d,g,h=this;if(!h.isLocked())return null==c?void f.warn("content is not valid",c):(d=h.getCell(a,b))?(e.isString(c)&&(c=p.create(c)),c instanceof p&&(c=q.create({richText:c})),g=d.setContent(c),g&&h.trigger("cell-content-change",d.getCellId()),g):void f.warn("no cell at row/col",a,b)},setCellInlineStyles:function(a){if(a&&a.styles&&!this.isLocked()){var b=this,c=a.row,d=a.col,e=a.styles,f=b._getCellAt(c,d);return f&&f.isTextNoEmptyCell()?(f.setInlineStyles(e),b.trigger("cell-inline-style-change",c,d)):f.setStylesForEmpty(e),!0}},getCellInlineStyles:function(a){var b=a.row,c=a.col,d=this._getCellAt(b,c);return d.isTextNoEmptyCell()?d.getInlineStyles(a.names):d.getStylesForEmpty(a.names)},setCellBlockStyles:function(a){if(!this.isLocked()){var b,c=a.row,d=a.col,f=a.styles,g=this._getCellAt(c,d);return!g.isMergedCell()&&(f&&!e.isEmpty(f)||g.clearStyles(),r.bulbStyles2TableStyles(f),g.setBlockStyles(f),b=g.getBlockStyles(),this.trigger("cell-block-style-change",c,d,f,b),!0)}},getCellBlockStyles:function(a){var b,c=a.row,d=a.col,f=a.names,g=this._getCellAt(c,d);return!g.isMergedCell()&&(b=g.getBlockStyles(),f&&f.length>0?e.pick(b,f):b)},insertRows:function(a,b,c){if(!this.isLocked()){var d=this,f=a;c=c||[],e.forEach(b,function(a,b){d._tableCells.splice(f,0,a),d._rowHeights.splice(f,0,c[b]||o.DEFAULT_ROW_HEIGHT),f+=1}),d.trigger("row-inserted",a)}},creatRowData:function(){var a,b=this,c=b.getColumnCount(),d=[];for(a=0;a<c;a++)d.push(b.createCell());return d},insertCols:function(a,b,c){if(!this.isLocked()){var d=this,e=d._tableCells,f=a;c=c||[],b.forEach(function(a,b){e.forEach(function(b,c){b&&b.splice(f,0,a[c])}),d._colWidths.splice(f,0,c[b]||o.DEFAULT_COL_WIDTH),f+=1}),d.trigger("col-inserted",a)}},deleteRows:function(a,b){if(!this.isLocked()){var c,d,e=this,f=[];if(!e.isLocked()){for(b=b||1,d=0;d<b;d++)f[d]=e._tableCells.splice(a,1)[0];return c=e._rowHeights.splice(a,b),e.trigger("row-deleted",a,b),{rowsData:f,heights:c}}}},deleteCols:function(a,b){if(!this.isLocked()){var c,d,e=this,f=[];if(!e.isLocked())return b=b||1,e._tableCells.forEach(function(c){for(d=0;d<b;d++)f[d]=f[d]||[],f[d].push(c.splice(a,1)[0])}),c=e._colWidths.splice(a,b),e.trigger("col-deleted",a,b),{colsData:f,widths:c}}},createCell:function(a){a=a||{};var b,c=a.content||q.createBlank(),d=a.styles;return b=n.create({content:c}),d&&b.setBlockStyles(d),b},getCells:function(){return this._tableCells},isMergeRect:function(a){var b,c=this;return!!c.isMergePoint(a.top,a.left)&&(b=c.getMergePointAttrAt(a.top,a.left),b.width>=a.width&&b.height>=a.height)},toXml:function(a){var b,c,d,f=this,g=w.__super__.toXml.apply(f,arguments),j=a.createElement("resource-list"),k=a.createElement("content"),l={},m=[];return f.forEach(function(b,c){var d=f.getCell(b,c),g=d?d.toXml(a,j,l):{},h=e.keys(g);1===h.length&&"value"===h[0]&&""===g.value&&(g={}),m.push(g)}),g.appendChild(j),c={cells:m,widths:[].concat(f._colWidths),heights:[].concat(f._rowHeights)},d=window.JSON.stringify(c),k.appendChild(a.createTextNode(d)),g.appendChild(k),b=a.createElement("styles"),i.toXml(f,b,a),g.appendChild(b),h.appendToXml(f.unknownTree,g),g},toJSON:function(a){var b=this,c=[].concat(b._colWidths),d=[].concat(b._rowHeights),e=[],f={},g={};return b.forEach(function(c,d){var h,i=b.getCell(c,d);i&&i.isAttachmentCell()&&!a&&(h=i.getContent(),f[h.getResId()]=h.getInfo()),i&&i.isImageCell()&&!a&&(h=i.getContent(),g[h.getResId()]=h.getInfo()),e.push(i?i.toJSON(a):null)}),a?{cells:e,widths:c,heights:d}:{blockType:b._type,blockId:b.getId(),resourceList:{imageMap:g,attachMap:f},data:{cells:e,widths:c,heights:d}}},toHtml:function(a,b,c){var e,f=this,g=c?f.getExtraInfo("pcResMap"):null,h=j.renderTable(f,null,g),i=document.createElement("div"),k=d(i);return k.attr("yne-bulb-block","table").css({overflow:"auto"}).append(h),e=i.outerHTML,e=e.replace(/style="(.*?)"/g,function(a){if(a)return a.replace(/\&quot;/g,"")})},forEach:function(a,b){var c=this;c.forEachRow(function(d){return c.forEachColumn(function(b){return a(d,b)},b)},b)},forEachCell:function(a,b){var c=this,d={};c.forEach(function(b,e){var f,g=c.getCell(b,e,{findMergePointIfNeeded:!0,withPosition:!0});if(g&&(f=g.row+"-"+g.col,!0!==d[f]))return d[f]=!0,a(g.cell,g.row,g.col)},b)},forEachRow:function(a,b){var c,d=this,e=0,f=d.getRowCount();for(c=0;c<f;c++)if(!1===a(b?e+f-c:e+c))return!1},forEachColumn:function(a,b){var c,d=this,e=0,f=d.getColumnCount();for(c=0;c<f;c++)if(!1===a(b?e+f-c:e+c))return!1},toPlain:function(a){var b,c=this,d=[];return a=e.defaults(a||{},{returnString:!0,withLineBreak:!1,filter:function(){return!0}}),c.forEach(function(b,e){var f=d[b],g=c.getCell(b,e),h="";f||(f=d[b]=[]),a.filter(g,b,e)&&(h=g?g.toPlain(a.withLineBreak):""),f.push(h)}),a.returnString?(b=e.map(d,function(a){return a.join(" ")}),b=b.join("\n")):d},countWords:function(){var a=this,b=a.toPlain({returnString:!1,withLineBreak:!1,filter:function(a){return a&&a.getType()===l.TEXT}}),c=0;return e.each(b,function(a){e.each(a,function(a){c+=k(a)})}),c},isEmptyContent:function(){var a=this,b=!0;return a.forEachCell(function(a){if(!a.isEmpty())return b=!1,!1}),b},getCommonInlineStyle:function(a,b){var c;return b&&b.getAsRectRange&&(b=b.getAsRectRange()),b&&b.forEachCell?(b.forEachCell(function(b){var d=b.getCommonInlineStyle(a);if(null==c)c=d;else if(c!==d)return c=u.INTERM,!1},!1),c===u.INTERM?null:c):(f.warn("Unvalid parameter",b),null)},getCommonBlockStyle:function(a,b){var c;return b&&b.getAsRectRange&&(b=b.getAsRectRange()),b&&b.forEachCell?(b.forEachCell(function(b){var d=b.getBlockStylesAsBulb()||{};if(null==c)c=d[a];else if(c!==d[a])return c=u.INTERM,!1},!1),c===u.INTERM?null:c):(f.warn("Unvalid parameter",b),null)},getAllResourceInfo:function(){var a,b,c,d,e,f=this,g=[];return f.forEach(function(h,i){var j=f.getCell(h,i),k=f.getExtraInfo("pcResMap");j&&j.isImageCell()&&(a=j.getContent(),b=a.getSource(),c=a.getSource(k),b&&c&&g.push({source:b,extraSource:c})),j&&j.isAttachmentCell()&&(a=j.getContent(),b=a.getSource(),c=a.getSource(k),d=a.getResource(),e=a.getResource(k),b&&c&&d&&e&&g.push({source:b,extraSource:c,resource:d,extraResource:e}))}),g},_onDetached:function(){},_onAttached:function(){},_onLockedChange:function(){},highlight:function(a,b,c){this.trigger("high-light",a,b,c)}},{_validateDimensionArray:function(a,b){return a?e.map(a,function(a){return a>0?a:b}):[b]},validateRowHeights:function(a){return w._validateDimensionArray(a,o.DEFAULT_ROW_HEIGHT)},validColWidths:function(a){return w._validateDimensionArray(a,o.DEFAULT_COL_WIDTH)},_resourceMapFromXml:function(a){var b={};return a?(d(a).children("resource-mono").each(function(a,c){var g=d(c),h=g.find("res-id").text();if(!h)return void f.error("<resource-mono/> node has no res-id",c);e.some(m,function(a,d){var e,f=g.children(d+":first").get(0);if(f&&a&&a.fromXml&&(e=a.fromXml(h,f,c)),e)return b[h]=e,!0})}),b):b},_tableCellsFromXml:function(a,b,c,d){var e,f,g,h=c.length,i=b.length,j=[];for(e=0;e<i;e++)for(j[e]=[],f=0;f<h;f++)g=e*h+f,j[e][f]=n.fromXml({tableBlockId:d.tableBlockId,resourceMap:d.resourceMap,rowIndex:e,colIndex:f,cellRawData:a[g]});return j},fromXml:function(a){var c,e,g,j,k,l=d(a),m=l.children("content:first").eq(0),n=d.trim(m.text()),o=w._resourceMapFromXml(l.children("resource-list:first").get(0)),p=new w({resourceMap:o});p.parseIdFromXml(a);try{c=window.JSON.parse(n)}catch(a){return void f.error(a,n)}return g=c.cells,j=w.validateRowHeights(c.heights),k=w.validateRowHeights(c.widths),e=w._tableCellsFromXml(g,j,k,{tableBlockId:p.getId(),resourceMap:o}),p.setContentData(e,j,k),l.children().each(function(a,c){switch(c.nodeName){case b.TAG_ID_NAME:case b.LEGACY_TAG_ID_NAME:case"content":case"resource-list":break;case"styles":i.fromXml(p,c);break;default:h.appendToTree(p.unknownTree,c)}}),p},fromJSON:function(a,b){if(!a||!a.blockType||a.blockType!==c.TABLE)return void f.warn("jsonObj is not valid!");var d=a.data,e=new w({rowHeights:d.heights,colWidths:d.widths,tableCells:s.cellsFromJSON({cellsJson:d.cells,height:d.heights.length,width:d.widths.length,isUpdateCellId:b,resourceList:a.resourceList})});return a.blockId&&e.setId(a.blockId),e},createBlankTable:function(a,b,c,d){var e,f,g,h=new w,i=[],j=[],k=[];for(c?h.setId(c):c=h.getId(),d&&(g=d/a),e=0;e<b;e++)for(k.push(o.DEFAULT_ROW_HEIGHT),i[e]=i[e]||[],f=0;f<a;f++)0===e&&j.push(g||o.DEFAULT_COL_WIDTH),i[e].push(n.create({content:q.createBlank(),cellId:n.makeCellId(c,e,f)}));return h.setContentData(i,k,j),h}});return w}(),yne_common_data_Unknown=function(a){var b,c,d,e=yne_common_data_blockTypes,f=yne_common_data_Block,g=yne_underscore,h=yne_collaboration_collabUtils;return c={_type:e.UNKNOWN,_styles:null,_xmlNode:null,initialize:function(a){var c=this;c._xmlNode=a.xmlNode,b.__super__.initialize.apply(c,arguments)},setBlockStyle:function(){},setBlockStyles:function(){},getBlockStyles:function(){},getBlockStyle:function(){},getDefaultBlockStyles:function(){},toXml:function(a){var b,c,d=this,e=!1;return g.some(d._xmlNode.childNodes,function(a){return a.nodeName===f.TAG_ID_NAME&&(e=!0),e}),e||(b=a.createElement(f.TAG_ID_NAME),c=a.createTextNode(h.newGUID()),b.appendChild(c),d._xmlNode.appendChild(b)),d._xmlNode},getType:function(){return this._type},toJSON:function(){},toHtml:function(){return""},toPlain:function(){return""},countWords:function(){return 0}},d={fromXml:function(a){var c=new b({xmlNode:a});return c.parseIdFromXml(a),c},fromJSON:function(){}},b=f.extend(c,d)}(),yne_common_data_blockMap=function(a){var b,c=yne_underscore;return b={attach:yne_common_data_Attachment,catalogue:yne_common_data_Catalogue,heading:yne_common_data_Heading,"horizontal-line":yne_common_data_Hr,"list-item":yne_common_data_ListItem,image:yne_common_data_Image,para:yne_common_data_Paragraph,table:yne_common_data_Table,todo:yne_common_data_Todo,unknown:yne_common_data_Unknown},c.each(b,function(a,b){a.prototype._xmlNodeName=b}),b}(),yne_parser_html_handlers_tagHandlers=function(a){var b=yne_underscore,c=yne_jtk_core_L,d={h1:32,h2:24,h3:18,h4:16,h5:13,h6:12},e={1:12,2:13,3:16,4:18,5:24,6:32,7:48},f={b:function(a){a.bold=!0},i:function(a){a.italic=!0},u:function(a){a.underline=!0},strike:function(a){a.strike=!0},code:function(a){a["font-family"]="monospace"},mark:function(a){a["back-color"]="#ffff00",a.color="#000000"},font:function(a,b){var c,d=b.getAttribute("color"),f=b.getAttribute("face"),g=b.getAttribute("size");d&&(a.color=d),f&&(a["font-family"]=f),g&&(c=e[g])&&(a["font-size"]=c)},pre:function(a){a["white-space"]="pre"},a:function(a,b){b&&b.href&&(a.color="#003884",a.underline=!0)}},g=function(a,d){var e=f[a];if(!e)return void c.error("The tag handler for `"+a+"` does not exist!");b.each(d,function(a){f[a]||(f[a]=e)})};return b.each(d,function(a,b){f[b]=function(b){b.bold=!0,b["font-size"]=a}}),g("b",["strong"]),g("i",["em","cite","var","address","dfn"]),g("strike",["s","del"]),g("u",["ins"]),g("code",["tt","kbd","samp","pre","xmp","plaintext","listing"]),f}(),yne_parser_html_utils_convertColor=function(a){var b=yne_tinycolor,c=yne_underscorestring,d="null",e={};return function(a,f){var g,h;if((a=c(a).trim().toLowerCase().value())&&"inherit"!==a){if(f&&"transparent"===a)return a;if(g=e[a])return g===d?void 0:g;if(h=b(a),h.isValid())return 0===h.getAlpha()?void(e[a]=d):(g=h.toHexString(),e[a]=g,g);e[a]=d}}}(),yne_parser_html_handlers_styleHandlers=function(a){var b=yne_underscorestring,c=yne_common_constants,d=yne_underscore,e=yne_parser_html_utils_convertColor,f=["bold","bolder","700","800","900"],g=yne_common_fontMaps,h={"xx-small":12,"x-small":12,small:13,medium:16,large:18,"x-large":24,"xx-large":32};return{bold:{inheritable:!0,action:function(a){var c=a.style.fontWeight;return c=c&&b.trim(c).toLowerCase(),c&&"inherit"!==c?-1!==d.indexOf(f,c):null}},italic:{inheritable:!0,action:function(a){var b=a.style.fontStyle;return b?"italic"===b:null}},underline:{inheritable:!0,action:function(a,b,c){var d=a.style.textDecoration;return!!/(^|\s)underline($|\s)/i.test(d)||!(d&&!c)&&c}},strike:{inheritable:!0,action:function(a,b,c){var d=a.style.textDecoration;return!!/(^|\s)line-through($|\s)/i.test(d)||!(d&&!c)&&c}},"font-family":{inheritable:!0,action:function(a){var b=a.style.fontFamily;return 0===b.trim().indexOf("-apple-system")?g.DEFAULT_FONT:g.getFontFirstValue(b)}},"font-size":{inheritable:!0,action:function(a,c,d){var e=a.style.fontSize;if(e=b.trim(e+""),/^[\d.]+px$/.test(e)?e=parseInt(e,10):/^[\d.]+pt$/.test(e)?e=Math.floor(4*parseFloat(e,10)/3):/^[\d.]+em$/.test(e)?(e=parseFloat(e,10),e*=d||14,e=Math.floor(e)):/^[\d.]+rem$/.test(e)?(e=parseFloat(e,10),e*=10,e=Math.floor(e)):e=h[e],e&&!isNaN(e))return e}},color:{inheritable:!0,action:function(a){var b=a.style.color;return e(b,!1)}},"back-color":{inheritable:!0,action:function(a){var b=a.style.backgroundColor;return e(b,!0)}},align:{inheritable:!0,action:function(a){var c=a.style.textAlign||a.align;if((c=c&&b.trim(c).toLowerCase())&&"inherit"!==c)return c}},"line-height":{inheritable:!0,
requireValues:["font-size"],action:function(a,c){var d=b.trim(a.style.lineHeight+""),e=c["font-size"]||14;if(/^[\d.]+$/.test(d)?d=parseFloat(d,10):/^[\d.]+px$/.test(d)?(d=parseFloat(d,10),d/=e):d=0,d&&!isNaN(d)&&d>1)return d}},indent:{inheritable:!0,action:function(a,b,c){var d=0;return"BLOCKQUOTE"===a.tagName&&(d=1),d+=c||0}},"text-indent":{inheritable:!0,action:function(a){var d=a.style.textIndent;if(d=b.trim(d+""),d=/^[\d.]+px$/.test(d)?parseFloat(d,10):/^[\d.]+pt$/.test(d)?4*parseFloat(d,10)/3:null)return(d=Math.floor(d/c.INDENT_WIDTH))||1}},width:{inheritable:!1,action:function(a){var c=a.style.width||a.width;if(c=b.trim(c+""),/^[\d.]+(px)?$/.test(c)&&(c=parseInt(c,10)),c&&!isNaN(c))return c}},float:{inheritable:!1,action:function(a){return a.style.float}},"white-space":{inheritable:!0,action:function(a){var b=a.style.whiteSpace;if(b&&"inherit"!==b)return b}}}}(),yne_parser_html_handlers_BaseHandler=function(a){var b,c=yne_jtk_core_Class,d=yne_underscore,e=yne_jtk_core_L,f=yne_parser_html_handlers_tagHandlers,g=yne_parser_html_handlers_styleHandlers;return b=c.extend({inheritStyleHandlers:null,uninheritStyleHandlers:null,tagHandler:null,el:null,parent:null,children:null,styles:null,parser:null,options:null,constructor:function(a,b,c,d,e){var f=this;f.el=a,f.children=[],f.parent=b,f.internalStylesParser=c,f.parent&&f.parent.children&&f.parent.children.push(f),f._computeStyles(),f.computeBulbStyles(),f.parser=d,f.options=e},computeBulbStyles:function(){},_findStyleHandler:function(a,c){var f,g=this,h=a?g.inheritStyleHandlers:g.uninheritStyleHandlers,i=h[c];if(d.isFunction(i))return{action:i};if(d.isObject(i)&&i.action)return i;if(!0===i&&(f=b.styleHandlers[c])&&f.action)return f.inheritable!==a?void e.error("The inheritable value of "+c+" is unvalid!"):f},_computeStyles:function(){var a=this,c=a.el,d={},e=a.tagHandler||b.tagHandlers[c.tagName.toLowerCase()];e&&e(d,c),a.styles={},a._computeInheritStyles(d),a._computeUninheritStyles(d)},_computeStyle:function(a,b){var c,e,f,g=this,h=null!=g.inheritStyleHandlers[b],i=g.parent,j=g.el;null==g.styles[b]&&(h&&!i||(c=g._findStyleHandler(h,b))&&c.action&&(c.requireValues&&c.requireValues.length&&d.each(c.requireValues,function(b){g._computeStyle(a,b)}),h?(e=(i.styles||{})[b],f=c.action(j,g.styles,e),f||!1===f||(f=a[b]),f||!1===f||(f=e)):(f=c.action(j,g.styles))||!1===f||(f=a[b]),(f||!1===f)&&(g.styles[b]=f)))},_computeInheritStyles:function(a){var b=this;b.inheritStyleHandlers&&d.each(b.inheritStyleHandlers,function(c,d){c&&b._computeStyle(a,d)})},_computeUninheritStyles:function(a){var b=this;b.uninheritStyleHandlers&&d.each(b.uninheritStyleHandlers,function(c,d){c&&b._computeStyle(a,d)})},setup:function(){},capture:function(){e.warn("Function capture should be implemented by SubClass")},finish:function(){},handleChildrenBySelf:function(){return!1},emit:function(a){var b=this;b.parent&&b.parent.capture(a)},getRoot:function(){var a=this;if(a.parent)return a.parent.getRoot()}},{tagHandlers:f,styleHandlers:g})}(),yne_parser_html_utils_handleParagraphSpaces=function(a){var b=yne_underscore,c=yne_underscorestring,d=["normal","nowrap","pre-line"],e=function(a,b){return b&&"normal"!==b&&"nowrap"!==b?"pre-line"===b?a.replace(/[ \t]+/g," "):a:a.replace(/[ \t\r\n]+/g," ")},f=function(a,b){return b&&"normal"!==b&&"nowrap"!==b?"pre-line"===b?a.replace(/^[ \t]+/g,""):a:a.replace(/^[ \t\r\n]+/g,"")},g=function(a,b){return b&&"normal"!==b&&"nowrap"!==b?"pre-line"===b?a.replace(/[ \t]+$/g,""):a:a.replace(/[ \t\r\n]+$/g,"")},h=function(a){var c=a.styles["white-space"];return!c||b.contains(d,c)};return function(a){var d,i,j,k,l,m;for(b.each(a,function(a){a.text=e(a.text,a.styles["white-space"])}),j=a.length,d=0;d<j&&(k=a[d],k.text=f(k.text,k.styles["white-space"]),!k.text);d++);for(d=0,i=1;i<j;i++)l=a[d],m=a[i],h(l)&&h(m)&&(c.endsWith(l.text," ")&&c.startsWith(m.text," ")&&(m.text=m.text.slice(1)),""===m.text)||(d=i);for(d=j-1;d>=0&&(k=a[d],k.text=g(k.text,k.styles["white-space"]),!k.text);d--);return a}}(),yne_parser_html_handlers_ParagraphHandler=function(a){var b,c=yne_parser_html_handlers_BaseHandler,d=yne_common_data_blockTypes,e=yne_common_data_Heading,f=yne_common_data_Paragraph,g=yne_common_data_Todo,h=yne_common_data_RichText,i=yne_parser_html_utils_handleParagraphSpaces,j=yne_common_constants,k=yne_underscore,l=yne_common_data_Catalogue,m=yne_common_data_Catalogues,n=yne_jquery,o=yne_collaboration_collabUtils;return b=null,c.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0,align:!0,"line-height":!0,indent:!0,"text-indent":!0},computeBulbStyles:function(){var a,c=this,e=c.el,f=e.getAttribute("yne-bulb-block");c.bulbBlock=f,f===d.PARAGRAPH?(a=e.style.marginLeft,a=parseInt(a,10),isNaN(a)||(a=Math.ceil(a/j.INDENT_WIDTH),c.styles.indent=(c.styles.indent||0)+a)):f===d.TODO&&(a=e.querySelector("[yne-bulb-todo-content]"))?e.innerHTML=a.innerHTML:("catalogue-wrap"===e.getAttribute("yne-bulb-type")||!b&&f===d.CATALOGUE)&&(b=new m({}))},setup:function(){this.block=null},capture:function(a){var b=this;a&&!0===a.isBr?b.emitBlock(!0):a&&!0===a.isText?b._appendText(a):a&&!0===a.isEmptyPara?b.emitBlock():b.captureBlock(a),b._hasChild=!0},captureBlock:function(a){this.emitBlock(),this.emit(a)},finish:function(){this.emitBlock(),this._hasChild||this.emit({isEmptyPara:!0})},_getBlock:function(){var a=this;return a.block||(a.block=a.createBlock()),a.block},createBlock:function(){var a,c=this,h=c.el;switch(this.bulbBlock){case d.HEADING:return new e({level:h.getAttribute("yne-bulb-level"),id:h.id});case d.CATALOGUE:return a=n(h).find("a").attr("href"),/#\w+$/.test(a)&&(a=a.match(/\w+$/)[0]),new l({id:o.newGUID(),href:a,ownerList:b});case d.TODO:return new g({id:o.newGUID(),checked:"true"===h.getAttribute("yne-bulb-checked")});default:return new f}},_appendText:function(a){var b=this;b.txtList=b.txtList||[],b.txtList.push(a)},emitBlock:function(a){var b,c,e,f=this,g=f.txtList;c=f._getBlock(),g&&(f.options&&f.options.holdSpaces||(g=i(g)),k.each(g,function(a){f.bulbBlock===d.CATALOGUE&&(a.styles.href=""),a.text&&(e=new h({text:a.text}),b=e.getLength(),k.each(a.styles,function(a,c){e.setStyle(0,b,c,a)}),c.append(e))})),(a||c.getLength()>0)&&(c.setBlockStyles(f.styles),f.emit(c)),f.block=null,f.txtList=null}})}(),yne_parser_html_handlers_DocumentHandler=function(a){var b=yne_parser_html_handlers_ParagraphHandler,c=yne_common_data_Block;return b.extend({constructor:function(a){var c=this;b.call(this,a,null),c.blocks=[]},setup:function(){var a=this;b.prototype.setup.apply(a),a.blocks=[]},emit:function(a){var b=this;a&&a instanceof c&&b.blocks.push(a)},finish:function(){this.emitBlock()},getRoot:function(){return this}})}(),yne_parser_html_handlers_UnknownHandler=function(a){return yne_parser_html_handlers_BaseHandler.extend({_computeStyles:function(){var a=this,b=a.parent;b&&(a.styles=b.styles)},capture:function(a){this.emit(a)}})}(),yne_cssom=function(){var a=window.CSSOM;if(!a&&window.require&&(a=window.require("CSSOM")),!a)throw"no `cssom` library";return a}(),yne_specificity=function(){var a=window.SPECIFICITY;if(!a&&window.require&&(a=window.require("SPECIFICITY")),!a)throw"no `specificity` library";return a}(),yne_parser_html_cssParser_CSSParser=function(a){var b=yne_underscore,c=yne_jtk_core_Class,d=yne_cssom,e=yne_specificity,f=yne_jquery,g=yne_jtk_core_L;return c.extend({_internalStyles:{},constructor:function(){this._internalStyles={}},parse:function(a){var c,e,f,h=this,i={},j={};if(!0===g.DEBUG)c=d.parse(a);else try{c=d.parse(a)}catch(a){return{}}return c.cssRules?(b.each(c.cssRules,function(a){a.selectorText&&a.style&&(j={},e=a.style,b.each(e,function(a){j[a]=e[a]}),-1!==a.selectorText.indexOf(",")?(f=a.selectorText.split(","),b.each(f,function(a){a=a.trim(),i[a]={selectorText:a,style:j}})):(a.selectorText=a.selectorText.trim(),i[a.selectorText]={selectorText:a.selectorText,style:j}))}),h._internalStyles=b.extend(h._internalStyles,i),i):{}},getInternalStyles:function(){return this._internalStyles},getStylesBySpecificity:function(a,c){var d=this,e={},g=d._internalStyles,h=[],i=0;return g?(b.each(g,function(b){try{f(a).is(b.selectorText)&&h.push(b)}catch(a){}}),h.sort(function(a,b){return-1*d._specificityCompare(a.selectorText,b.selectorText)}),b.some(h,function(a){if(a.style&&b.some(a.style,function(a,d){if(i===c.length)return!0;d in e||-1===b.indexOf(c,d)||(e[d]=a,i++)}),i===c.length)return!0}),e):{}},_specificityCompare:function(a,b){return e.compare(a,b)}})}(),yne_parser_html_Parser=function(a){var b,c=yne_underscore,d=yne_jtk_core_Class,e=yne_parser_html_handlers_DocumentHandler,f=yne_parser_html_handlers_UnknownHandler,g=yne_jtk_web_dom_parseHTML,h=yne_parser_html_cssParser_CSSParser;return b=d.extend({_mapper:{},_blackTagList:{},constructor:function(a){var b=this;b._mapper={},b._blackTagList={},c.each(a,function(a,d){!1===a?b._blackTagList[d]=!0:a&&c.isObject(a)&&b.define(d,a)})},parse:function(a,b){var d,f,i,j=this,k=new h,l=/<html[\S\s]*<\/html>/i;return a=a.replace(/<!--[\w\W]*?-->/i,""),l.test(a)&&(a=a.match(l)[0]),d=g(a,document,!0),d?f=new e(d):(d=document.createElement("div"),d.innerHTML=a,f=new e(d)),i=d.getElementsByTagName("style"),i&&c.each(i,function(a){k.parse(a.innerText)}),f.internalStylesParser=k,j._parseRecursively(f,j,b),f.blocks},_shouldBreak:function(a){return!a||!a.style||("none"===a.style.display||"hidden"===a.style.visibility)},_parseRecursively:function(a,b,d){var e,g,h,i,j,k=this,l=a.el;if(!0!==k._shouldBreak(l)){if(a.setup(),!0!==a.handleChildrenBySelf())for(e=l.firstChild;e;)1===e.nodeType?(j=e.tagName.toLowerCase(),k._blackTagList[j]||(h=k._findHandlers(e),h=c.isFunction(h)?h:f,i=new h(e,a,a.internalStylesParser,b,d),k._parseRecursively(i,b,d))):3===e.nodeType&&(g=e.textContent)&&a.capture({text:g,styles:a.styles,isText:!0}),e=e.nextSibling;a.finish()}},define:function(a,c,d){this._mapper[a]={Class:c,priority:d||b.PRIORITY.DEFAULT}},_findHandlers:function(a){var b=[],d=function(a,b){if(a)return a.matches?a.matches(b):a.webkitMatchesSelector?a.webkitMatchesSelector(b):void 0};if(c.each(this._mapper,function(c,e){d(a,e)&&b.push(c)}),0!==b.length)return b.sort(function(a,b){return b.priority-a.priority}),b[0].Class}},{PRIORITY:{HIGH:1,DEFAULT:0,LOW:-1}})}(),yne_parser_html_mathTags=["maction","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msubsup","msup","mtable","mtd","mtext","mtr","munder","munderover","semantics"],yne_parser_html_svgTags=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],yne_parser_html_handlers_AnchorHandler=function(a){var b=yne_parser_html_handlers_BaseHandler;return b.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0},constructor:function(a,c,d){b.call(this,a,c,d)},capture:function(a){var b=this,c=b.el.getAttribute("href");if(!c||"#"===c||0===c.indexOf("javascript"))return void b.emit(a);a&&!0===a.isText?(a.styles.href=a.styles.href||c,b.emit(a)):b.emit(a)}})}(),yne_parser_html_handlers_InlineHandler=function(a){var b=yne_underscore,c=yne_parser_html_handlers_BaseHandler;return c.extend({inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0},inheritBlockStyles:{align:!0,"line-height":!0,indent:!0,"text-indent":!0},_computeInheritStyles:function(){var a=this;c.prototype._computeInheritStyles.apply(a,arguments),a._computeInheritBlockStyles()},_computeInheritBlockStyles:function(){var a,c=this,d=c.parent,e=c.inheritBlockStyles;d&&d.styles&&(a=d.styles,b.each(e,function(b,d){if(!0===b){var e=a[d];e&&(c.styles[d]=e)}}))},capture:function(a){this.emit(a)}})}(),yne_parser_html_handlers_BreakHandler=function(a){var b=yne_parser_html_handlers_InlineHandler;return b.extend({inheritStyleHandlers:!1,inheritBlockStyles:{"line-height":!0,indent:!0,"text-indent":!0},finish:function(){var a=this;a.emit({isBr:!0,styles:a.styles})}})}(),yne_parser_html_handlers_HrHandler=function(a){var b=yne_common_data_Hr,c=yne_underscore,d=yne_common_data_supportedBlockStyles,e=yne_common_data_blockTypes;return yne_parser_html_handlers_BaseHandler.extend({computeBulbStyles:function(){var a,b=this,f=b.el;"hr"===f.getAttribute("yne-bulb-block")&&(a=d.getStyleNamesOfBlock(e.HR),c.each(a,function(a){var c=f.getAttribute("yne-style-"+a);c&&(b.styles[a]=c)}))},finish:function(){var a=this,c=new b;a.styles&&c.setBlockStyles(a.styles),a.emit(c)}})}();var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();yne_common_data_HandWrite=function(a,b,c,d,e){var f=function(a){function f(){return null!==a&&a.apply(this,arguments)||this}return __extends(f,a),f.prototype.initialize=function(a){var e=this;if(null==a||null==a.source||null==a.resource)throw"props and props.source and props.resource  cannot be null";b.prototype.initialize.apply(e,[a]),e._handWriteProps=c.clone(a),e._type=d.HANDWRITE},f.prototype.getSource=function(a){var b,c=this,d=c._handWriteProps.source;return!0===a&&(b=c.getExtraInfo("pcResMap"))&&b[d]&&(d=b[d]),d},f.prototype.getResource=function(a){var b,c=this,d=c._handWriteProps.resource;return!0===a&&(b=c.getExtraInfo("pcResMap"))&&b[d]&&(d=b[d]),d},f.prototype.setStyles=function(){},f.prototype.toHtml=function(a,b,c){var d=this,f=e("",document,!0,!0),g=f.ownerDocument,h=g.createElement("div"),i=$(h),j=$(g.createElement("img"));return i.attr("yne-bulb-block","handwrite"),j.attr({"data-media-type":"handwrite",src:d.getSource(c),"data-res-handwrite":d._handWriteProps.resource}),i.append(j),h.outerHTML},f.prototype.toJSON=function(){var a=this,c=b.prototype.toJSON.apply(a);return c.source=a.getSource(!1),c.resource=a.getResource(!1),c},f.prototype.toPlain=function(){return""},f.prototype.toXml=function(){throw"HandWrite do NOT support toXml till now"},f}(b),g=function(){function a(){}return a.fromXml=function(a){throw"HandWrite do NOT support fromXml till now"},a.fromJSON=function(a){if(!(a&&a.blockType&&a.blockType===d.HANDWRITE&&a.source&&a.resource))throw"jsonObj or jsonObj.source/resource does NOT exist!";var b=new h({source:a.source,resource:a.resource});return a.blockId&&b.setId(a.blockId),b},a}();delete f.prototype.constructor;var h=b.extend(f.prototype,g);return h}(0,yne_common_data_Block,yne_underscore,yne_common_data_blockTypes,yne_jtk_web_dom_parseHTML),yne_parser_html_handlers_ImageHandler=function(a){var b,c=yne_parser_html_handlers_InlineHandler,d=yne_common_data_Image,e=yne_common_data_Attachment,f=yne_common_data_HandWrite,g=yne_common_data_Todo,h=yne_underscore;return b=c.extend({inheritStyleHandlers:!1,uninheritStyleHandlers:{width:!0,float:!0},inheritBlockStyles:{align:!0},_handleNoteLink:function(){var a,b,c,d=this,e=d.el;a=e.getAttribute("data-attr-noteid"),b=e.getAttribute("alt"),a&&b&&(c=d.parent&&d.parent.styles?h.clone(d.parent.styles):{},c.href="note://"+a,c.color="#003884",c.underline=!0,d.emit({text:b,styles:c,isText:!0}))},_handleNoteTodo:function(){var a=this,b=a.el,c=b.getAttribute("data-res-todo"),d=new g({legacyResId:c});a.emit(d)},finish:function(){var a,c,g,i,j,k=this,l=k.el,m=l.getAttribute("src"),n=function(a,b){h.each(a,function(a,c){var d=b.style[a];d&&(k.styles[c]=d)})};return b.isNoteLink(l)?void k._handleNoteLink():b.isTodo(l)?void k._handleNoteTodo():void(m&&(g=l.parentNode,g&&(i=g.getAttribute("yne-bulb-block")),b.isAttachment(l)?(c=l.getAttribute("path"),a=new e({source:m,resource:c,fileName:b.getAttachmentFileName(l),fileLength:b.getAttachmentFileLength(l)}),"attachment"===i&&n({align:"textAlign",float:"float"},g)):b.isImage(l)?("image"===i&&n({align:"textAlign",width:"width",float:"float"},g),a=new d({source:m,title:b.getImageTitle(l)}),k.styles.width&&k.styles.width>620&&(k.styles.width=620)):b.isHandWrite(l)&&(j=l.getAttribute("data-res-handwrite"),a=new f({source:m,resource:j})),a&&(a.setStyles(k.styles),k.emit(a))))}},{isAttachment:function(a){var b=a.getAttribute("path"),c=a.dataset.mediaType;return b&&("attachment"===c||!c)},isImage:function(a){var b=a.dataset.mediaType,c=a.getAttribute("path"),d=["image"];return!c&&(!b||d.indexOf(b)>-1)},isHandWrite:function(a){return"handwrite"===a.dataset.mediaType},isNoteLink:function(a){return"notelink"===a.dataset.mediaType},isTodo:function(a){return"todo"===a.dataset.mediaType},getAttachmentFileName:function(a){return a.getAttribute("filename")||a.getAttribute("alt")||a.getAttribute("title")||""},getImageTitle:function(a){return a.getAttribute("alt")||""},getAttachmentFileLength:function(a){return a.getAttribute("filelength")||""}})}(),yne_parser_html_handlers_ListHandler=function(a){var b,c=yne_parser_html_handlers_BaseHandler,d=yne_common_data_List,e=yne_common_data_ListItem,f=yne_underscore,g=yne_collaboration_collabUtils;return b=c.extend({list:null,level:null,type:null,_itemCounter:null,prevSimilar:null,inheritStyleHandlers:{bold:!0,italic:!0,underline:!0,strike:!0,"font-family":!0,"font-size":!0,color:!0,"back-color":!0,"white-space":!0,align:!0,"line-height":!0,indent:!0,"text-indent":!0},_parseTypeFromElement:function(){return"ul"===this.el.tagName.toLowerCase()?d.UNORDERED:d.ORDERED},_getStartIndexFromElement:function(){var a=this,b=a.type,c=a.el,e=-1;return b!==d.ORDERED?e:("list"===c.getAttribute("yne-block-type")&&(e=parseInt(c.getAttribute("start"),10),isNaN(e)&&(e=-1)),e)},increaseItemCounter:function(){var a,b=this,c=b.prevSimilar;c&&c.increaseItemCounter?c.increaseItemCounter():(a=b._itemCounter||0,a+=1,b._itemCounter=a)},getItemCounter:function(){var a=this,b=a.prevSimilar;return b?b.getItemCounter():a._itemCounter||0},setup:function(){var a,b,c,e=this,f=e._findParentListHandler();e.list=null,e.level=1,f&&(e.level=f.level+1),c=e._parseTypeFromElement(),e.type=c,b=e._getStartIndexFromElement(),b>1&&(a=e._getPreviousSimilar())&&a.getItemCounter()===b-1&&(e.prevSimilar=a,e.list=a.list),e.list||(e.list=new d({type:c,listId:g.newGUID()}))},capture:function(a){var b=this,c=b.level;a instanceof e&&a.getLevel()<c&&a.setLevel(c),b.emit(a)},_findParentListHandler:function(){for(var a=this.parent;a;){if(a instanceof b)return a;a=a.parent}},_getPreviousSimilar:function(){var a,c=this,d=c.level,e=c.type,g=c.parent,h=g.children;return f.some(h,function(c){if(c instanceof b&&c.level===d&&c.type===e)return a=c,!0}),a}})}(),yne_parser_html_handlers_ListItemHandler=function(a){var b=yne_parser_html_handlers_ParagraphHandler,c=yne_common_data_ListItem,d=yne_parser_html_handlers_ListHandler;return b.extend({setup:function(){var a=this;a.ownerListHandler=a._findOwnerListHandler()},captureBlock:function(a){var b=this,c=null;b.emitBlock(),!b._listed&&a.getType&&"paragraph"===a.getType()?(c=b.createBlock(),c.append(a.getText()),b.emit(c)):b.emit(a)},emit:function(a){var d=this;a instanceof c&&(d._listed=!0),b.prototype.emit.call(d,a)},createBlock:function(){var a,d,e=this,f=e.ownerListHandler;return!e._listed&&f&&f.list?(f.increaseItemCounter(),d=f.list,a=new c({list:d}),d&&d.addItem&&d.addItem(a),a):b.prototype.createBlock.call(e)},_findOwnerListHandler:function(){for(var a=this.parent;a;){if(a instanceof d)return a;a=a.parent}}})}(),yne_parser_html_utils_isWhiteColor=function(a){var b=yne_tinycolor;return function(a){return!!a&&b.equals(a,"white")}}(),yne_parser_html_handlers_TableHandler=function(a){var b=yne_parser_html_handlers_BaseHandler,c=yne_common_data_Table,d=yne_common_data_table_TableCell,e=yne_common_data_table_Lines,f=yne_common_data_table_ImageResource,g=yne_common_data_table_AttachmentResource,h=yne_common_data_table_supportedBlockStyles,i=yne_parser_html_handlers_ImageHandler,j=yne_jtk_core_L,k=yne_jquery,l=yne_underscore,m=yne_parser_html_utils_isWhiteColor,n=yne_parser_html_handlers_styleHandlers,o=yne_common_data_blockTypes,p=function(a,b){var c;if(a&&a.tagName){if((c=(a.tagName+"").toLowerCase())===b+"")return!0;if(l.contains(b,c))return!0}},q=function(a,b,c){if(!a)return c;var d=a.getAttribute(b);return d=parseInt(d||c,10),isNaN(d)&&(d=c),d},r=function(a,b,c){if(!a)return c;var d=a.style[b];return d=parseInt(d||c,10),isNaN(d)&&(d=c),d};return b.extend({DEFAULT_HEIGHT:40,DEFAULT_WIDTH:70,_styleHandlers:{bold:{tagList:["b","strong"],styleHandler:function(a){return n.bold.action(a,{},null)}},lineThrough:{tagList:["strike","s","del"],styleHandler:function(a){return n.strike.action(a,{},null)}},underline:{tagList:["u","ins"],styleHandler:function(a){return n.underline.action(a,{},null)}},italic:{tagList:["i","em","cite","var","address","dfn"],styleHandler:function(a){return n.italic.action(a,{},null)}},fontName:function(a){var b=n["font-family"].action(a,{},null);return b||("FONT"===a.tagName?(b=a.getAttribute("face"))||null:void 0)},fontSize:function(a){var b=n["font-size"].action(a,{},null);if(b)return b+"px"},textColor:function(a){var b=n.color.action(a,{},null);return b||("FONT"===a.tagName?(b=a.getAttribute("color"))||null:void 0)},backColor:function(a){return n["back-color"].action(a,{},null)},textAlign:function(a){return n.align.action(a,{},null)}},_tableStyleHandlers:{verticalAlign:function(a){var b=["THEAD","TBODY","TFOOT"];if(a)return a.style.verticalAlign||a.getAttribute("valign")||(a.tagName&&l.contains(b,a.tagName)?"middle":void 0)},textAlign:function(a){if(a)return a.style&&a.style.textAlign?a.style.textAlign:a.getAttribute("align")},textColor:function(a){return n.color.action(a,{},null)},backColor:function(a){return a.style.backgroundColor||null},bold:function(a){return a&&a.tagName&&"TH"===a.tagName?"true":n.bold.action(a,{},null)?"true":void 0},italic:function(a){if(n.italic.action(a,{},null))return"true"},underline:function(a){if(n.underline.action(a,{},null))return"true"},lineThrough:function(a){if(n.strike.action(a,{},null))return"true"},fontName:function(a){return n["font-family"].action(a,{},null)},fontSize:function(a){var b=n["font-size"].action(a,{},null);if(b)return b+"px"}},constructor:function(a,b,c,d){var e=this;e.el=a,e.parent=b,e.internalStylesParser=c,e._parser=d},handleChildrenBySelf:function(){return!0},_inheritStyles:function(a,b,c){var d=this,e={};return c=c||{},l.each(d._styleHandlers,function(d,f){var g;!1!==a[f]&&(l.isFunction(d)?g=d(b):(d.styleHandler&&(g=d.styleHandler(b)),!g&&d.tagList&&(g=p(b,d.tagList))),g&&"inherit"!==g||(g=c[f]),e[f]=g)}),e},_mergeStyles:function(a,b){var c=this,d=k.trim(a.value),e=d.length;l.each(c._styleHandlers,function(c,d){0===e?b[d]?a[d]=b[d]:a[d]=!1:a[d]&&b[d]!==a[d]&&(a[d]=!1)})},_inheritTableStyles:function(a,b){var c=this,d={},e=["TABLE","THEAD","TBODY","TFOOT","TR","TD","TH"];return l.contains(e,a.tagName+"")?(b=b||{},l.each(c._tableStyleHandlers,function(c,e){var f=c(a);null!=f&&"inherit"!==f||(f=b[e]),null!=f&&(d[e]=f)}),d):{}},_parseImage:function(a,b){var c,d,e=a.getAttribute("src");if(i.isNoteLink(a))return d=a.getAttribute("alt")||"",void(b.value+=d);e&&(i.isAttachment(a)?(c=a.getAttribute("path"),b.value=g.create({source:e,resource:c,fileLength:i.getAttachmentFileLength(a),fileName:i.getAttachmentFileName(a)})):i.isImage(a)&&(b.value=f.create({source:e})))},_shouldAddLineBreak:function(a){a=(a+"").toLowerCase();var b=["article","aside","blockquote","br","button","caption","col","colgroup","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","map","ol","output","p","pre","progress","section","textarea","tfoot","ul","video"];return l.contains(b,a)},_isLinkCell:function(a){if(!a)return!1;var b,c,d,e,f,g,h,i=a.querySelectorAll("a"),j=function(a){return!a||(1===a.nodeType?""===k.trim(a.textContent||""):3!==a.nodeType||""===k.trim(a.nodeValue||""))};if(!i||!i.length||1!==i.length)return!1;for(b=i[0],d=b,c=d.parentNode;c&&c!==a;){for(e=c.childNodes,f=e.length,g=0;g<f;g++)if((h=e[g])!==d&&!j(h))return!1;d=c,c=d.parentNode}return!0},_parseCell:function(a,b,c){var d,h,i,j,k,n=this,p={value:""},r=n.internalStylesParser,s=["font-size","font-family","font-style","font-weight","color","background-color","background","text-decoration","text-align","vertical-align","white-space","word-wrap","word-space"],t=e.createBlank(),u=!1;return k=n._parser.parse(a.innerHTML),l.any(k,o.isTextBlock.bind(o))?l.each(k,function(a){o.isTextBlock(a)?t.appendRichText(a.getText()):(o.isImage(a)||o.isAttachment(a)||o.isTable(a)||o.isHr(a))&&n._blockList.push(a)}):l.each(k,function(a){(o.isTable(a)||o.isHr(a))&&n._blockList.push(a),u?(o.isImage(a)||o.isAttachment(a))&&n._blockList.push(a):o.isImage(a)?(t=f.create({source:a.getSource(),width:a.getStyles("width"),height:a.getStyles("height")}),u=!0):o.isAttachment(a)&&(t=g.create({source:a.getSource(),resource:a.getResource(),fileLength:a.getFileLength(),fileName:a.getFileName()}),u=!0)}),d={value:t},d.value&&p.link&&(d.link=p.link),c===n.DEFAULT_HEIGHT&&(d.wrap="true"),l.each(n._styleHandlers,function(a,b){!0===p[b]?d[b]="true":p[b]&&(d[b]=p[b])}),h=q(a,"colspan",1),h>1&&(d.mergeWidth=h,d.mergeHeight=d.mergeHeight||1),h=q(a,"rowspan",1),h>1&&(d.mergeHeight=h,d.mergeWidth=d.mergeWidth||1),i=n._inheritTableStyles(a,b),l.each(i,function(a,b){null==d[b]&&a&&(d[b]=a)}),j=r.getStylesBySpecificity(a,s),l.each(j,function(b,c){var d=a.style.getPropertyValue(c);null!=d&&""!==d||a.style.setProperty(c,b)}),l.each(n._tableStyleHandlers,function(b,c){var e=b(a);null==d[c]&&null!=e&&(d[c]=e)}),m(d.backColor)&&delete d.backColor,d},_isArrayFull:function(a,b){var c;if(0===b)return!1;for(c=0;c<b;c++)if(null==a[c])return!1;return!0},_parseTbodyCells:function(a,b,c){var d,f=this,g=l.filter(b.children,f._isTableRow),h=[],i=a.widths.length,j=a.heights.length,k=0;return d=f._inheritTableStyles(b,c),l.each(g,function(b){var c=l.filter(b.children,f._isTableCell),g=f._inheritTableStyles(b,d),m=k,n=h[m];if(0!==c.length){for(;n&&f._isArrayFull(n,i);)k++,m++,n=h[m];for(n||(n=h[m]=[]),l.each(c,function(b){for(var c,d,i,k,l,o,p,r,s,t=0,u=n[t];u;)t++,u=n[t];for(c=t,k=f._parseCell(b,g,a.heights[m]),n[c]=k,d=q(b,"rowspan",1),i=q(b,"colspan",1),d>j-m&&(d=j-m,k.mergeHeight=d),l=0;l<d;l++)for(p=m+l,s=h[p],s||(s=h[p]=[]),o=0;o<i;o++)r=c+o,s[r]||(s[r]={mergePointDX:o,mergePointDY:l,value:e.createBlank(!0)})});n.length<i;)n.push({value:""});k++}}),h},_isTableCell:function(a){if(!a||!a.tagName)return!1;var b=a.tagName||"",c=["TD","TH"];return l.contains(c,b)},_isTableRow:function(a){return!(!a||!a.tagName)&&"TR"===a.tagName},_getTbodySize:function(a){var b,c,d,e,f,g,h=this,i=[],j=0,k=0,m=[];for(l.each(a,function(b){var c,d,e=k,f=i[e];if(c=l.filter(b.children,h._isTableCell),0!==c.length){for(;f&&h._isArrayFull(f,j);)e++,f=i[e];k=e,f||(f=i[e]=[],m[e]=a[e]),l.each(c,function(b,c){var g,j,k,l,n,o,p=q(b,"colspan",1),s=q(b,"rowspan",1),t=r(b,"width",0)||q(b,"width",0);for(d+=p,t=Math.max(Math.round(t/p),h.DEFAULT_WIDTH),l=c;null!=f[l];)l++;for(k=0;k<p;k++)n=l+k,f[n]=t;for(g=1;g<s;g++)for(j=e+g,o=i[j],o||(o=i[j]=[],m[j]=a[j]),k=0;k<p;k++)n=l+k,o[n]=t}),d=f.length,j<d&&(j=d)}}),b=i.length,g=[],c=0;c<j;c++){for(e=(i[0]||[])[c]||h.DEFAULT_WIDTH,d=1;d<b;d++)(f=(i[d]||[])[c])&&f>e&&(e=f);g.push(e)}return{rows:b,columns:j,columnWidthList:g,compactTrList:l.compact(m)}},_createBlankRow:function(a){for(var b=[];a>0;)b.push({value:""}),a--;return b},_parseColgroup:function(a){var b=this,c=l.filter(a.children,b._isCol);return l.map(c,function(a){return parseFloat(a.style.width)})},_isCol:function(a){return!(!a||!a.tagName)&&"COL"===a.tagName},_parseTbody:function(a,b,c){var d,e,f,g,h=this,i=l.filter(a.children,h._isTableRow),j=0,k={},m=[],n=0;for(g=h._getTbodySize(i),i=g.compactTrList,k.heights=l.map(i,function(a){if(a.style.height)return parseFloat(a.style.height);var b=l.filter(a.children,h._isTableCell),c=0;return l.some(b,function(a){if(!a.getAttribute("rowspan")){var b=r(a,"height",0)||q(a,"height",0);if(b)return c=b,!0}}),c=Math.max(c,h.DEFAULT_HEIGHT)});k.heights.length<g.rows;)k.heights.push(h.DEFAULT_HEIGHT);if(n=0,l.each(g.columnWidthList,function(a){n+=a}),n<c?(e=Math.ceil((c-n)/g.columns),m=l.map(g.columnWidthList,function(a){return a+e})):m=g.columnWidthList,k.widths=m,d=h._parseTbodyCells(k,a,b),f=d.length,(j=k.heights.length)>f)for(;f<j;)d.push(h._createBlankRow(g.columns)),f++;else if(j<f)for(;j<f;)k.heights.push(h.DEFAULT_HEIGHT),j++;return k.cells=d,k},_extendBodyInfo:function(a,b){var c,d,e,f=a.cells,g=a.heights.length,h=a.widths.length;if(!(h>=b))for(c=0;c<g;c++)for(d=f[c],e=d.length;e<b;e++)d.push({value:""})},_convertToTableCells:function(a,b){var c,f,g,i,k=a.length,m=[];for(c=0;c<k;c++)for(f=a[c],m[c]=[],g=0;g<b;g++)i=f[g],i?m[c].push(d.create({content:i.value||e.createBlank(),mergeWidth:i.mergeWidth,mergeHeight:i.mergeHeight,mergePointDX:i.mergePointDX,mergePointDY:i.mergePointDY,styles:l.pick(i,h.getAllStyleNames())})):j.error("No tdInfo  at row, col: "+c+", "+g);return m},_mergeTbody:function(a){if(a&&a.length){var b,c=this,d=0,e=[],f=[],g={};return l.each(a,function(a){var c=a.widths.length;c>d&&(d=c,b=a.widths)}),l.each(a,function(a){c._extendBodyInfo(a,d)}),l.each(a,function(a){e=e.concat(a.heights),f=f.concat(a.cells)}),f=c._convertToTableCells(f,d),g.widths=b,g.heights=e,g.cells=f,g}},_parseTable:function(a){var b,c,d=this,e=l.toArray(a.children),f=["thead","tbody","tfoot"],g={thead:[],tbody:[],tfoot:[]},h=[],i=d._blockList.length,j=d._inheritTableStyles(a,{}),k=r(a,"width",0)||q(a,"width",0);d._blockList.push(0),l.each(e,function(a){var b,e=(a.tagName||"").toLowerCase();"colgroup"===e&&(c=d._parseColgroup(a)),l.contains(f,e)&&(b=d._parseTbody(a,j,k),l.extend(b.widths,c),g[e].push(b))}),l.each(f,function(a){var b=g[a];b&&b.length&&(h=h.concat(b))}),(b=d._mergeTbody(h))&&(d._blockList[i]=b)},setup:function(){this._blockList=[]},finish:function(){var a=this;a._parseTable(a.el),l.each(a._blockList,function(b){var d;b&&b.heights&&b.cells&&b.cells.length>0?d=new c({tableCells:b.cells,rowHeights:b.heights,colWidths:b.widths}):b&&(d=b),d&&a.emit(d)})}})}(),yne_parser_html_handlers_TodoHandler=function(a){var b=yne_underscore,c=yne_common_data_Todo;return yne_parser_html_handlers_InlineHandler.extend({finish:function(){var a,d,e=this.el;"todo"===e.getAttribute("data-media-type")&&(a=e.getAttribute("data-attr-content"),d=e.getAttribute("data-attr-checked"),b.isUndefined(a)&&b.isUndefined(d)||this.emit(new c({text:a||"",checked:"true"===d})))}})}(),yne_parser_html_handlers_handlerMap={AnchorHandler:yne_parser_html_handlers_AnchorHandler,BreakHandler:yne_parser_html_handlers_BreakHandler,HrHandler:yne_parser_html_handlers_HrHandler,ImageHandler:yne_parser_html_handlers_ImageHandler,InlineHandler:yne_parser_html_handlers_InlineHandler,ListHandler:yne_parser_html_handlers_ListHandler,ListItemHandler:yne_parser_html_handlers_ListItemHandler,ParagraphHandler:yne_parser_html_handlers_ParagraphHandler,TableHandler:yne_parser_html_handlers_TableHandler,
TodoHandler:yne_parser_html_handlers_TodoHandler},yne_parser_html_tagConfig=function(a){var b=yne_underscore,c=yne_parser_html_mathTags,d=yne_parser_html_svgTags,e=!1,f=yne_parser_html_handlers_handlerMap,g={a:f.AnchorHandler,abbr:f.InlineHandler,acronym:f.InlineHandler,address:f.ParagraphHandler,applet:e,area:e,article:f.ParagraphHandler,aside:f.ParagraphHandler,audio:e,b:f.InlineHandler,base:e,basefont:e,bdi:f.InlineHandler,bdo:f.InlineHandler,bgsound:e,big:f.InlineHandler,blink:f.InlineHandler,blockquote:f.ParagraphHandler,body:f.ParagraphHandler,br:f.BreakHandler,button:e,canvas:e,center:f.ParagraphHandler,cite:f.InlineHandler,code:f.InlineHandler,command:e,content:e,data:e,datalist:e,dd:f.ParagraphHandler,del:f.InlineHandler,details:f.ParagraphHandler,dfn:f.InlineHandler,dialog:e,dir:f.InlineHandler,div:f.ParagraphHandler,dl:f.ParagraphHandler,dt:f.ParagraphHandler,element:e,em:f.InlineHandler,embed:e,fieldset:f.ParagraphHandler,figcaption:f.ParagraphHandler,figure:f.ParagraphHandler,font:f.InlineHandler,footer:f.ParagraphHandler,form:f.ParagraphHandler,frame:e,frameset:e,h1:f.ParagraphHandler,h2:f.ParagraphHandler,h3:f.ParagraphHandler,h4:f.ParagraphHandler,h5:f.ParagraphHandler,h6:f.ParagraphHandler,header:f.ParagraphHandler,hgroup:f.ParagraphHandler,hr:f.HrHandler,html:f.ParagraphHandler,i:f.InlineHandler,iframe:e,image:e,img:f.ImageHandler,input:f.TodoHandler,ins:f.InlineHandler,isindex:e,kbd:f.InlineHandler,keygen:e,label:f.InlineHandler,legend:f.ParagraphHandler,li:f.ListItemHandler,link:e,listing:e,main:f.ParagraphHandler,map:e,mark:f.InlineHandler,marquee:f.ParagraphHandler,menu:e,menuitem:e,meta:e,meter:f.InlineHandler,multicol:f.ParagraphHandler,nav:f.ParagraphHandler,nobr:f.InlineHandler,noembed:e,noframes:e,noscript:e,object:e,ol:f.ListHandler,optgroup:e,option:e,output:f.InlineHandler,p:f.ParagraphHandler,param:e,picture:e,plaintext:f.ParagraphHandler,pre:f.ParagraphHandler,progress:e,q:f.InlineHandler,rp:f.InlineHandler,rt:f.InlineHandler,rtc:f.InlineHandler,ruby:f.ParagraphHandler,s:f.InlineHandler,samp:f.InlineHandler,script:e,section:f.ParagraphHandler,select:e,shadow:e,small:f.InlineHandler,source:e,spacer:e,span:f.InlineHandler,strike:f.InlineHandler,strong:f.InlineHandler,style:e,sub:f.InlineHandler,summary:f.ParagraphHandler,sup:f.InlineHandler,table:f.TableHandler,template:e,textarea:f.ParagraphHandler,time:f.InlineHandler,title:e,track:e,tt:f.InlineHandler,u:f.InlineHandler,ul:f.ListHandler,var:f.InlineHandler,video:e,wbr:e,xmp:e},h=function(a,c){a&&a.length&&b.each(a,function(a){null==c[a]&&(c[a]=e)})};return h(c,g),h(d,g),g}(),yne_parser_html_mso_ListHandler=function(a){function b(a,b){var c=a.match(/(@[\w_\-:\s]+)\n\s*\{(.|\n)*?\}/gm);null!==c&&c.forEach(function(a){var c=/@([\w_\-:\s]+)/.exec(a)[1].trim(),d=a.substring(a.indexOf("{")+1,a.indexOf("}")).trim(),e={};d.split(";").forEach(function(a){var b;-1!==a.indexOf(":")&&(b=a.split(":"),e[b[0].trim()]=b[1].trim())}),b[c]||(b[c]={}),g.extend(b[c],e)})}var c=yne_parser_html_handlers_ParagraphHandler,d=yne_common_data_List,e=yne_common_data_ListItem,f=yne_jtk_core_L,g=yne_underscore,h=yne_collaboration_collabUtils;return c.extend({setup:function(){var a,b,e,f,g,i,j,k=this.getRoot();c.prototype.setup.call(this),(a=this.el.getAttribute("style"))&&(b=/mso-list:(l\d+) (level\d+)/.exec(a))&&(g=b[1],i=b[2],e=this._getStyles(),(f=e["list "+g+":"+i])&&(j=k["mso-"+g],j||(j=k["mso-"+g]=new d({type:"bullet"===f["mso-level-number-format"]?d.UNORDERED:d.ORDERED,listId:h.newGUID()})),this.list=j,this.level=Number(i.replace("level","")),this.el.querySelector('[style="mso-list:Ignore"]').remove()))},createBlock:function(){if(!this.list)return c.prototype.createBlock.call(this);var a=this,b=a.list,d=new e({list:b,level:a.level});return b&&b.addItem&&b.addItem(d),d},_getStyles:function(){var a,c=this.getRoot(),d=this.el.ownerDocument,e={};return c.msoStyles?c.msoStyles:(a=d.querySelectorAll("style"),g.each(a,function(a){1===a.childNodes.length&&3===a.firstChild.nodeType&&b(a.firstChild.textContent,e)}),f.log(e),c.msoStyles=e,e)}})}(),yne_parser_html_convert=function(a){var b,c=yne_parser_html_Parser,d=yne_parser_html_tagConfig,e=yne_parser_html_mso_ListHandler;return function(a,f){return b||(b=new c(d),b.define(".MsoListParagraph",e,c.PRIORITY.HIGH)),b.parse(a,f)}}(),yne_parser_plain_createRichText=function(a){var b=yne_common_data_RichText;return function(a,c){var d;return a+="",a=a.replace(/[\r\n]/g,""),d=new b({text:a}),c&&d.setStyles(0,d.getLength(),c),d}}(),yne_common_commands_link_LinkMatch={test:function(a){var b=/(https?:\/\/|www\.|ssh:\/\/|ftp:\/\/)[a-z0-9&_+\-\?\/\.=\#,:,@]+$/i,c=/[a-z0-9_+\-\.]+@[a-z0-9_+\-\.]+$/i;return a=String(a),b.test(a)||c.test(a)||!1},matchEnd:function(a){var b,c,d=/(https?:\/\/|www\.|ssh:\/\/|ftp:\/\/)[a-z0-9&_+\-\?\/\.=\#,:@%\(\)~]+$/i,e=/[a-z0-9_+\-\.]+@[a-z0-9_+\-\.]+$/i;return a=String(a),(b=d.exec(a))?(c=b[0],{mail:!1,fullURI:0===c.toLowerCase().indexOf("www.")?"http://"+c:c,result:b}):(b=e.exec(a),b?(c=b[0],{mail:!0,fullURI:"mailto:"+c,result:b}):void 0)}},yne_parser_plain_parseLine=function(a){var b=yne_parser_plain_createRichText,c=yne_common_data_Paragraph,d=yne_common_commands_link_LinkMatch,e=yne_underscore;return function(a,f,g,h){if(null!=a){var i,j,k=new c;return h||(i=d.matchEnd(a))&&0===i.result.index&&e.extend(f||(f={}),{href:i.fullURI,underline:!0,color:"#003884"}),j=b(a,f),k.setText(j),g&&e.each(g,function(a,b){k.setBlockStyle(b,a)}),k}}}(),yne_parser_plain_convert=function(a){var b=yne_jtk_core_L,c=yne_underscore,d=yne_parser_plain_parseLine;return function(a,e,f,g){var h,i=[];return a?(h=a.split(/\r\n?|\n/))&&h.length?(c.each(h,function(a){var b=d(a,c.clone(e),c.clone(f),g);b&&i.push(b)}),b.log("to paste text",i),i):void b.warn("lines do not exist or lines.length is 0!"):void b.warn("no text when paste plain text!")}}(),yne_parser_json_createBlock=function(a){var b=yne_common_data_Attachment,c=yne_common_data_blockTypes,d=yne_common_data_Catalogue,e=yne_common_data_Heading,f=yne_common_data_Hr,g=yne_common_data_Image,h=yne_common_data_ListItem,i=yne_common_data_Paragraph,j=yne_common_data_Table,k=yne_common_data_Todo,l=yne_common_data_HandWrite,m=yne_jtk_core_L;return function(a){if(!a||!a.blockType)return void m.warn("jsonObj is null or jsonObj has no `blockType` property!");var n,o=a.blockType;switch(o){case c.PARAGRAPH:n=i.fromJSON(a);break;case c.LIST_ITEM:n=h.fromJSON(a);break;case c.IMAGE:n=g.fromJSON(a);break;case c.ATTACHMENT:n=b.fromJSON(a);break;case c.TABLE:n=j.fromJSON(a,!0);break;case c.HR:n=f.fromJSON(a);break;case c.HEADING:n=e.fromJSON(a);break;case c.CATALOGUE:n=d.fromJSON(a);break;case c.TODO:n=k.fromJSON(a);break;case c.HANDWRITE:n=l.fromJSON(a);break;default:m.warn("jsonObj.blockType = "+o)}return n}}(),yne_parser_json_convert=function(a){var b=yne_jtk_core_L,c=yne_underscore,d=yne_common_data_List,e=yne_common_data_Catalogues,f=yne_common_data_blockTypes,g=yne_parser_json_createBlock,h=yne_collaboration_collabUtils;return function(a){var i,j,k,l=[],m={},n={},o={};if(c.isString(a))try{i=window.JSON.parse(a)}catch(c){b.error("parse json string error: ",a)}else c.isArray(a)&&(i=a);if(i&&i.length)return b.log("createBlocksFromJSON array: ",i),c.each(i,function(a){var b;(b=g(a))&&(a.listId&&a.listType&&f.isListItem(b)&&(j=a.listId,k=m[j],k||(k=new d({type:a.listType,listId:a.listId}),m[j]=k),b.setOwnerList(k)),a.ownerId&&f.isCatalogue(b)&&(j=a.ownerId,o[j]||(o[j]=h.newGUID(),n[o[j]]=new e({id:o[j]})),k=n[o[j]],b.setOwnerList(k)),l.push(b))}),l}}(),yne_parser_ocr_convert=function(a){var b=yne_jtk_core_L,c=yne_underscore,d=yne_common_data_RichText,e=yne_common_data_Paragraph,f=1.5,g={create:function(){var a={};return a.data={},a.push=function(b,c){c||(c=1),a.data[b]?a.data[b]+=c:a.data[b]=c},a.count=function(){return Object.keys(a.data).length},a.mergeKeys=function(b){var d,e,f,h,i,j=g.create(),k=a.data;return c.each(a.orderedKeys(),function(a){f&&a-f<b?(h=k[f],i=k[a],e=h+i,d=(f*h+a*i)/e,j.push(d,e),f=null):(f&&j.push(f,k[f]),f=a)}),f&&j.push(f,k[f]),j.count()!==a.count()?j.mergeKeys(b):j},a.mostFrequencyKey=function(){var b,d=0;return c.each(a.data,function(a,c){a>=d&&(d=a,b=parseInt(c))}),b},a.orderedKeys=function(){var b;return b=Object.keys(a.data),b.sort(function(a,b){return a-b})},a}},h=function(a){var b={},c=a.split(",");return b.left=parseInt(c[0]),b.top=parseInt(c[1]),b.width=parseInt(c[2]),b.height=parseInt(c[3]),b.right=b.left+b.width,b.bottom=b.top+b.height,b},i=function(a,b){var c=(b.box.bottom-a.box.top)/a.box.height,d=(b.box.bottom-a.box.top)/b.box.height;return Math.max(c,d)>.8},j=function(a){return/^[a-z][a-z\d.,\/#!$%\^&\*;:{}=\-_`~()]*$/i.test(a)},k=function(a){var b=[/Epdf/,/For Evaluation Purposes Only/],c=!1;return b.forEach(function(b){b.test(a)&&(c=!0)}),c},l=function(a,b){a.box.top=a.box.top<b.box.top?a.box.top:b.box.top,a.box.bottom=a.box.bottom>b.box.bottom?a.box.bottom:b.box.bottom,a.box.left=a.box.left<b.box.left?a.box.left:b.box.left,a.box.right=a.box.right>b.box.right?a.box.right:b.box.right,a.box.height=a.box.bottom-a.box.top,a.box.width=a.box.right-a.box.left,a.words=b.words.concat(a.words),a.text=b.text+"  "+a.text},m=function(a){var b,d,e=a.json,f=[];for(e.box=h(e.boundingBox),c.each(e.lines,function(a){var d,g="";a.box=h(a.boundingBox),c.each(a.words,function(a){a.box=h(a.boundingBox),j(a.text)&&(g+=" "),g+=a.text}),a.text=g,k(a.text)?(d=e.lines.indexOf(a),f.push(d)):(b&&i(a,b)&&(l(a,b),d=e.lines.indexOf(b),f.push(d)),b=a)}),d=f.length-1;d>=0;d-=1)e.lines.splice(f[d],1)},n=function(a){var b,d=a.json,e=g.create(),f=g.create(),h=g.create(),i=g.create(),j=g.create(),k={};c.each(d.lines,function(a){e.push(a.box.left),f.push(a.box.right),b&&h.push(a.box.bottom-b.box.bottom),b=a,c.each(a.words,function(a){j.push(a.box.height),i.push(a.box.width)})}),k.baseLineHeight=h.mostFrequencyKey(),k.baseWordWidth=i.mostFrequencyKey(),k.baseFontHeight=j.mostFrequencyKey(),k.regionLeft=e.mergeKeys(k.baseFontHeight).mostFrequencyKey(),k.regionRight=f.mergeKeys(k.baseFontHeight).mostFrequencyKey(),a.stat=k},o=function(a){var b,c,d,e,g,h,i=a.json,j=[],k=a.stat.regionLeft,l=a.stat.regionRight,m=a.stat.baseWordWidth,n=a.stat.baseLineHeight,o=!1,p=!1,q="";for(b={startLineIndex:0},g=0;g<i.lines.length;g+=1){if(e=i.lines[g],o=p,k+m*f<e.box.left&&g!==b.startLineIndex&&(o=!0),d&&e.box.bottom-d.box.bottom>n*f&&(o=!0),o){for(b.endLineIndex=g-1,b.text=q.trim(),j.push(b),c=Math.floor((e.box.bottom-d.box.bottom)/n-1),h=0;h<c;h+=1)j.push({text:""});b={startLineIndex:g},q=e.text}else q+=e.text;d=e,p=l-m*f>e.box.right}b.endLineIndex=g,b.text=q,j.push(b),a.paragraphs=j},p=function(a){var b=a.json,d=a.stat,e=a.paragraphs;c.each(e,function(a){var c,e=b.lines[a.startLineIndex];e&&(c=e.words[0])&&Math.ceil((c.box.left-d.regionLeft)/d.baseWordWidth)/2>=1&&(a.text="\t"+a.text)})},q=function(a){var b,c,f,g=new e;return f=a.fontSize,b=a.text,b=b.replace(/[\r\n]/g,""),c=new d({text:b}),c.setStyle(0,c.getLength(),"font-size",f),g.setText(c),g},r=function(a){var b={};return b.json=a,m(b),n(b),o(b),p(b),b};return function(a){var d,f,g=[];if(c.isString(a))try{d=window.JSON.parse(a)}catch(c){b.error("parse json string error: ",a)}return c.isArray(a)&&(d=a),d&&c.each(d,function(a){c.each(a.regions,function(a){var b=r(a);c.each(b.paragraphs,function(a){f=q(a),g.push(f)})}),g.push(new e)}),g}}(),yne_parser_Parser=function(a){var b=yne_parser_html_convert,c=yne_parser_plain_convert,d=yne_parser_json_convert,e=yne_parser_ocr_convert,f=yne_jtk_core_L;return{parseHtml:function(a){var c=b(a);return f.log("parseHtml OK",c),c},parsePlain:function(a,b,d,e){return c(a,b,d,e)},parseJSON:function(a){return d(a)},parseOCR:function(a){return e(a)}}}(),yne_common_data_HeaderFooter=function(a){var b,c=yne_jtk_core_Base,d=yne_jquery,e=yne_underscore,f=yne_common_data_blockTypes,g=yne_common_util_unknownTree;return b=c.extend({_type:f.HEADER_FOOTER,_blockId:null,_locked:!1,_isReadOnly:!1,initialize:function(a){a=a||{};var b=this;b._blockId=a.isFooter?"footer-fixed-id":"header-fixed-id",b._content=a.content||"",b._align=a.align||"center",b.isFooter=!0===a.isFooter,b.unknownTree={},b.unknownStyles={}},getContent:function(a,c){return b.format(this._content,c)},getType:function(){return this._type},setAlign:function(a){this._align=a},getAlign:function(){return this._align},getBlockStyle:function(a){if("align"===a)return this.getAlign()||"center"},setContent:function(a){this._content=a},setContentAndStyle:function(a,b){var c=this;null!=a&&(this._content=a),null!=b&&(c._align=b),c.trigger("change",a,b)},toXml:function(a){var b,c=this,d=c.isFooter?"footer":"header",e=a.createElement(d),f=a.createElement("styles"),h=a.createElement("text"),i=a.createTextNode(c.getContent());return h.appendChild(i),e.appendChild(h),b=a.createElement("align"),b.appendChild(a.createTextNode(c.getAlign())),f.appendChild(b),g.appendToXml(c.unknownStyles,f),e.appendChild(f),g.appendToXml(c.unknownTree,e),e.setAttribute("compat","true"),e},getInfo:function(){var a=this;return{content:a.getContent(),align:a.getAlign(),isFooter:a.isFooter}},getId:function(){return this._blockId},setId:function(a){this._blockId=a},setLocked:function(a,b){var c=this;c._locked===a&&b&&!b.lockUpdated||(c._locked=a,c.trigger("locked-change",b))},isLocked:function(){return this._locked},isValidForCollab:function(){return!0},resetLockState:function(){this._locked=!1},toCollabJSON:function(){return{headerFooterInfo:this.getInfo()}},setReadOnly:function(a){this._isReadOnly=!!a},isReadOnly:function(){return this._isReadOnly},highlight:function(a,b,c){this.trigger("high-light",a,b,c)},getHighlight:function(a){if(a&&a.length){var b=this,c=b._content,d=[];return e.each(a,function(a){for(var b=a.getLength(),e=0,f=c.indexOf(a,e);-1!==f;)d[f]={start:f,end:f+b},f=c.indexOf(a,f+b)}),d=e.compact(d),d.length?d:null}}},{format:function(a,b){return a?(b=b||{},null!=b.pageIndex&&(a=a.replace(/:p/,b.pageIndex+1)),b.pageCount&&(a=a.replace(/:n/,b.pageCount)),a):a},parse:function(a,b){return a.replace(/\d+/,function(a){return parseInt(a,10)===b.pageIndex+1?":p":a}).replace(/\d+/,function(a){return parseInt(a)===b.pageCount?":n":a})},fromXml:function(a){var c=d(a),e=c.find(">text").text(),f=c.find("styles>align").text(),h=new b({content:e,align:f,isFooter:"footer"===a.nodeName});return c.children().each(function(a,b){switch(b.nodeName){case"text":break;case"styles":d(b).children().each(function(a,c){"align"!==c.nodeName&&g.appendToTree(h.unknownStyles,b)});break;default:g.appendToTree(h.unknownTree,b)}}),h},createBlank:function(a){return new b({content:"",isFooter:!0===a})}})}(),yne_common_util_ListItemNode=function(a){var b=yne_jtk_core_Class,c=yne_underscore,d=yne_jtk_core_L;return b.extend({constructor:function(a,b,e,f,g){var h=this;d.DEBUG&&(h._debugId=c.uniqueId()),h.level=a||0,h.block=b,h._start=e,h._end=f,h.addChildNodes(g)},addChildNodes:function(a){var b=this;a&&(c.isArray(a)||(a=[a]),c.each(a,function(a){a.parentNode=b,b.childNodes||(b.childNodes=[]),b.childNodes.push(a)}))},childrenCount:function(){var a=this,b=a.childNodes;return b?b.length:0},hasChildren:function(){return this.childrenCount()>0},isOrdered:function(){var a=this;return a.block?a.block.isOrdered():!!a.parentNode&&a.parentNode.isOrdered()},getStartIndex:function(){var a=this;return a.block?a.block.getIndex():1},isChildOrdered:function(){var a=this,b=a.childNodes||[],c=b[0];return!!c&&c.isOrdered()},getChildStartIndex:function(){var a=this,b=a.childNodes||[],c=b[0];return c?c.getStartIndex():1},toHtml:function(a){var b,d,e,f,g,h,i=this,j=i.block,k=[];return a=!0===a,i.hasChildren()?(g=j?j.toHtml(i._start,i._end,a):"",k.push(g),b=i.isChildOrdered()?"ol":"ul",e="<"+b+' yne-block-type="list"',d=i.getChildStartIndex(),d>1&&(e+=' start="'+d+'"'),e+=">",k.push(e),h=i.childNodes,c.each(h,function(b){var c=b.toHtml(a);k.push(c)}),f="</"+b+">",k.push(f)):(g=j?j.toHtml(i._start,i._end,a):"<li></li>",k.push(g)),k=k.join("")}})}(),yne_common_util_events=function(a){var b=yne_jtk_core_L,c=yne_underscore;return{bubble:function(a,d,e,f){if(!a||!d||!e)return void b.log("arguments are not valid",arguments);var g=c.isArray(a);c.each(a,function(a,b){a&&(g?b=a:!0===a&&(a=b),!0===f&&d.off(b),d.on(b,e.trigger.bind(e,a)))})},addListeners:function(a,d,e,f){if(!a||!d||!e)return void b.log("arguments are not valid",arguments);c.each(a,function(a,b){!0===f&&d.off(b),d.on(b,e[a].bind(e))})}}}(),yne_common_data_Note=function(a){var b,c,d,e=yne_underscore,f=yne_backbone,g=yne_jtk_core_Class,h=yne_jquery,i=yne_underscorestring,j=yne_common_data_blockMap,k=yne_common_data_Block,l=yne_common_data_Unknown,m=yne_parser_Parser,n=yne_common_data_Paragraph,o=yne_jtk_core_L,p=yne_common_data_List,q=yne_common_data_ListItem,r=yne_common_data_Catalogues,s=yne_common_data_HeaderFooter,t=yne_common_data_blockTypes,u=yne_common_constants,v=yne_common_data_supportedInlineStyles,w=yne_common_util_ListItemNode,x=yne_common_util_schemaVersion,y=function(a){return a instanceof n&&!a.isEmpty()||t.isTable(a)&&!a.isEmptyContent()},z=yne_collaboration_collabUtils,A=x.getDefaultAsString(),B=yne_common_util_events,C=yne_common_util_clearString,D=yne_common_data_RichText,E=function(a){var b=document.createElement("span");return b.innerHTML=a,b.textContent};return b={blocks:null,originalBlockIds:null,_extraInfo:null,_isValidForCollab:!0,_isReadOnly:!1,_noteId:null,_contentParseTimer:null,headUnknownNodeList:null,initialize:function(){var a=this;a._extraInfo={},a._noteId=z.newGUID(),a.blocks=[],a.originalBlockIds=[],a.headUnknownNodeList=[],a.schemaVersion=A,a.fileVersion=0},isEmptyContent:function(){var a,b=this,c=b.blocks;return!!(c&&1===c.length&&(a=c[0])&&a.isEmptyContent)&&a.isEmptyContent()},getNoteId:function(){return this._noteId},isSameNote:function(a){return a===this._noteId},getBlockById:function(a){return this._header&&a===this._header.getId()?this._header:this._footer&&a===this._footer.getId()?this._footer:e.find(this.blocks,function(b){return a===b.getId()})},getBlockAt:function(a){return this.blocks[a]},getBlockIndex:function(a){var b=this;return e.indexOf(b.blocks,a)},getBlockIndexById:function(a){var b,c=this,d=-1;return b=c.getBlockById(a),b&&(d=c.getBlockIndex(b)),d},getPreBlock:function(a){var b=this,c=b.getBlockIndex(a);if(c>0)return b.getBlockAt(c-1)},getNextBlock:function(a){var b=this,c=b.getBlockIndex(a);if(c>=0)return b.getBlockAt(c+1)},getLastBlock:function(){var a=this;return e.last(a.blocks)},lastBlockIsEasyInput:function(){var a=this,b=a.getLastBlock();return t.isTextBlock(b)},getInterBlocks:function(a,b,c){var d=this,e=d.blocks,f=d.getBlockIndex(a),g=d.getBlockIndex(b);return c?e.slice(f,g+1):e.slice(f+1,g)},getAllBlocks:function(){return this.blocks},getCommonInlineStyle:function(a,b){if(a&&b){var c,d=a.getStartBlockRange(),f=a.getEndBlockRange(),g=d.block,h=f.block,i=null,j=[],k=!0;return y(g)&&(j.push(g.getCommonInlineStyle(b,d)),k=!1),(g!==h&&(c=this.getInterBlocks(g,h),e.each(c,function(a){y(a)&&(j.push(a.getCommonInlineStyle(b)),k=!1)}),y(h)&&(j.push(h.getCommonInlineStyle(b,f)),k=!1)),k)?(t.isTextBlock(g)&&(i=g.getInlineStyleForEmpty(b,!0)),i||v.getDefault(b)):(e.some(j,function(a){if(null===i)i=a;else if(null!=a&&i!==a)return i=u.INTERM,!0}),i)}},getRangeBlockStyle:function(a,b){if(a&&b){var c=a.getStartBlockRange(),d=a.getEndBlockRange(),f=c.block,g=d.block,h=this.getInterBlocks(f,g,!0),i=null;return a.isSingleTableSelected()?h[0]?h[0].getCommonBlockStyle(b,c):o.warn("No table block find, need update noteRange"):(e.each(h,function(a){var c=a.getBlockStyle(b);i=null===i?c:i===c?i:u.INTERM}),i)}},isSameList:function(a,b){var c,d,e,f,g,h,i,j,k,l;if(!a)return o.error("isSameList:noteRange should not be null"),!1;for(c=a.getStartBlockRange(),d=a.getEndBlockRange(),e=c.block,f=d.block,g=this.getInterBlocks(e,f,!0),l=g.length,h=0;h<l;h++)if((i=g[h])instanceof n){if(!(i instanceof q))return!1;if(j=i.getOwnerList(),j.getType()!==b)return!1;if(k){if(k!==i.getOwnerList())return!1}else k=j}return!!k},insert:function(a,b){var c=this;if(!b)throw"cannot insert null block";c.blocks.splice(a,0,b),c._bindEventsForBlock(b),b.trigger("attached",c),c.trigger("insert-block",a,b)},append:function(a){var b=this,c=b.blocks;b.insert(c.length,a)},replace:function(a,b){var c=this,d=c.blocks.splice(a,1,b)[0];return d?(d.trigger("detached",c),c._unbindEventsForBlock(d)):o.warn("oldBlock should not be null"),b&&(c._bindEventsForBlock(b),b.trigger("attached",c)),c.trigger("replace-block",a,b,d),d},remove:function(a,b){var c=this,d=c.blocks.splice(a,1)[0];d&&(d.trigger("detached",c),c._unbindEventsForBlock(d),c.trigger("remove-block",a,b))},removeBlock:function(a){var b=this;b.remove(b.getBlockIndex(a))},removeBlockById:function(a,b){var c=this;c.remove(c.getBlockIndexById(a),b)},toXml:function(){var a,b,c,d,f,g,h,j=this,k="<?xml",l='<?xml version="1.0"?>\n',m="http://note.youdao.com",n=document.implementation,p=n.createDocument(m,"note",null),q=p.createElement("head"),r=p.createElement("body"),s={},t=j.getSchemaVersion(),u=j.getFileVersion(),v=p.documentElement,w=[];return v.appendChild(q),v.appendChild(r),t&&v.setAttribute("schema-version",t),v.setAttribute("file-version",u),e.each(j.blocks,function(a){var b,c,d,f,g,h;a&&a.toXml&&(b=a.toXml(p)),b?b.listItem?(c=b,r.appendChild(c.listItem),f=c.listId,s[f]||(s[f]=!0,d=p.createElement("list"),g=c.ownerList.unknownAttrs,e.each(g,function(a){var b=a.cloneNode(!0);d.setAttributeNode(b)}),d.setAttribute("id",f),d.setAttribute("type",c.listType),q.appendChild(d))):("catalogue"===b.tagName&&(h=b.getAttribute("catalogue-id"),-1===w.indexOf(h)&&w.push(h)),r.appendChild(b)):o.warn("block.toXml() failed!")}),e.each(j.headUnknownNodeList,function(a){if(a&&a.cloneNode){var b=a.cloneNode(!0);q.appendChild(b)}}),h=q.querySelectorAll("catalogue-wrap"),e.each(h,function(a){q.removeChild(a)}),e.each(w,function(a){a&&(g=p.createElement("catalogue-wrap"),g.setAttribute("id",a),g.setAttribute("compat","true"),q.appendChild(g))}),b=j.getHeaderFooter(!1),c=j.getHeaderFooter(!0),b&&(a=b.toXml(p))&&q.appendChild(a),c&&(a=c.toXml(p))&&q.appendChild(a),d=new window.XMLSerializer,f=d.serializeToString(p),i.startsWith(f,k)||(f=l+f),f},_parseCataloguesToHtml:function(a){var b,c,d,e=document.createElement("div"),f="";for(d=0;d<a.length;d++)b=a[d],c=b.block,f+=c.toHtml();return c.getOwnerList(),e.setAttribute("yne-bulb-type","catalogue-wrap"),e.innerHTML=f,e.outerHTML},_parseListItemsToTree:function(a){var b,c,d,e,f,g,h,i,j,k=new w(0),l=a.length;for(f=k,b=0;b<l;b++){if(c=a[b],d=c.block,e=c.range||{},i=d.getLevel(),h=new w(i,d,e.start,e.end),(j=i-f.level)>1)for(;i-f.level>1;)g=new w(f.level+1),f.addChildNodes(g),f=g;else if(j<1)for(;i-f.level<1;)f=f.parentNode;f.addChildNodes(h),f=h}return k},_toHtmlWithSameOwnerList:function(a,b){var c,d,f=this,g=e.first(a).block;return t.isListItem(g)?(c=f._parseListItemsToTree(a))&&(d=c.toHtml(!0===b)):t.isCatalogue(g)&&(d=f._parseCataloguesToHtml(a)),d||""},toHtml:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this,s=r.blocks,u=s.length,v=[],w=[];for(b=!0===b,a?(h=a.getStartBlockRange(),i=a.getEndBlockRange(),j=h.block,k=i.block,l=r.getBlockIndex(j),m=r.getBlockIndex(k),q=a.isInSingleBlock()):(l=0,m=u-1),d=l;d<=m;d++)p=null,n=d===l,o=d===m,c=s[d],n&&h?(p=h,q||(p=p.clone(!0),p.expandToEnd())):o&&i&&(p=i,q||(p=p.clone(!0),p.expandToStart())),t.isListItem(c)||t.isCatalogue(c)?(g=c.getOwnerList(),f&&f!==g&&w.length&&(e=r._toHtmlWithSameOwnerList(w,b),v.push(e),w=[]),w.push({block:c,range:p||null}),f=g):(f=null,w.length&&(e=r._toHtmlWithSameOwnerList(w,b),v.push(e),w=[]),e=p?p.getDataAsHtml(b):c.toHtml(null,null,b),v.push(e));return w.length&&(e=r._toHtmlWithSameOwnerList(w,b),v.push(e)),v=v.join("")},toPlain:function(a){var b=this,c=a?e.filter(b.blocks,a):b.blocks,d=e.map(c,function(a){return a.toPlain()});return d=d.join("\n")},_parseWordCountInfo:function(a){var b=/[A-z0-9~!@#$%^&*()_+{}|:"<>?`\-=[\]\\;',.\/]+/g,c=/[\u4e00-\u9fa5\u3002\uff1b\uff0c\uff1a\u201c\u201d\uff08\uff09\u3001\uff1f\u300a\u300b]/g,d=/\s+/g,e=a.match(b),f=a.match(c),g=a.replace(b,"").replace(d,""),h=g.length,i=f?f.length:0,j=e?e.length:0,k=h-i;return{nonChinese:j+k,chinese:i,all:i+j+k}},countWords:function(a,b){var c,d,e=this,f=function(a){return!t.isHr(a)};return a&&(c=!0,d=e._parseWordCountInfo(a.getDataAsPlain(e,f))),(!a||!d.all&&b)&&(c=!1,d=e._parseWordCountInfo(e.toPlain(f))),{count:d.all,isSelected:c,detail:d}},destroy:function(){var a=this;e.each(a.blocks,function(b){a._unbindEventsForBlock(b)}),a.blocks=null,a._isReadOnly=!1,a._isValidForCollab=!0},_listenerEventsForBlock:function(){return{"get-extra-info":"_onGetExtraInfo","get-default-set-font":"_onGetDefaultSetFont"}},_bubbleEventsForBlock:function(a){var b={};return t.isTable(a)&&(b=e.extend(b,{"color-picker-show":!0,"yne-user-action-collection":!0,"get-block-view":!0})),b},_bindEventsForBlock:function(a){var b,c=this;a&&(c._unbindEventsForBlock(a),b=c._listenerEventsForBlock(a),B.addListeners(b,a,c),b=c._bubbleEventsForBlock(a),B.bubble(b,a,c))},_unbindEventsForBlock:function(a){if(a){var b=this,c=function(b){b&&e.each(b,function(b,c){a.off(c)})};c(b._listenerEventsForBlock(a)),c(b._bubbleEventsForBlock(a))}},getFileVersion:function(){return this.fileVersion},setFileVersion:function(a){this.fileVersion=a},setSchemaVersion:function(a){if(x.isLessThanDefault(a))return void o.warn("schema version is older than current, need upgrade!");this.schemaVersion=a||A},getSchemaVersion:function(){return this.schemaVersion||A},getAllResouceIds:function(){var a=this,b=[];return e.each(a.blocks,function(a){var c=a.getResourceIds();c&&c.length&&(b=b.concat(c))}),b=e.uniq(b)},getAllResourceInfo:function(a,b){var c,d,f,g,h=[];return a=a||this.blocks,b=b||[t.IMAGE,t.ATTACHMENT,t.HANDWRITE,t.TABLE],e.each(this.blocks,function(a){t.isAttachment(a)&&b.indexOf(t.ATTACHMENT)>-1||t.isHandWrite(a)&&b.indexOf(t.HANDWRITE)>-1?(c=a.getSource(!1),d=a.getSource(!0),f=a.getResource(!1),g=a.getResource(!0),c&&d&&f&&g&&h.push({source:c,extraSource:d,resource:f,extraResource:g})):t.isImage(a)&&b.indexOf(t.IMAGE)>-1?(c=a.getSource(!1),d=a.getSource(!0),c&&d&&h.push({blockId:a.getId(),source:c,extraSource:d})):t.isTable(a)&&b.indexOf(t.TABLE)>-1&&(h=h.concat(a.getAllResourceInfo()))}),h},getImageBySource:function(a,b){return e.filter(this.blocks,function(c){return t.isImage(c)&&c.getSource(b)===a})},findAttachmentByResource:function(a,b){return e.filter(this.blocks,function(c){return t.isAttachment(c)&&c.getResource(b)===a})},_triggerExtraInfoChange:function(){var a=this;e.each(a.blocks,function(a){a.trigger("extra-info-change")})},setExtraInfo:function(a){var b=this;b._extraInfo=a,b._triggerExtraInfoChange()},getExtraInfo:function(a){var b=this;return a?(b._extraInfo||{})[a]:b._extraInfo},setExtraInfoWithKey:function(a,b,c,d){var e=this,f=e._extraInfo,g=f[a];f||(f={},d=!0),g||(f[a]=g={}),g[b]=c,!0===d?e.setExtraInfo(f):e._extraInfo=f},highlight:function(a,b){var c,d,f=this,g=[];b=e.defaults(b||{},{ignoreCase:!1}),a&&a.length?(c=[],e.each(a,function(a){a&&!/\s/.test(a)&&(a=new D({text:a}),c.push(a))}),c=c.length?c:null,d=f.blocks.slice(),f._header&&d.unshift(f._header),f._footer&&d.push(f._footer),e.each(d,function(a){a.highlight(c,b,function(a){g.push(a)})}),f.trigger("high-light",g),e.isFunction(b.callback)&&b.callback(g.length)):f.trigger("high-light",[])},nextHighlight:function(){this.trigger("next-high-light")},preHighlight:function(){this.trigger("pre-high-light")},setReadOnly:function(a){var b=this;(a=!!a)!==b._isReadOnly&&(b._isReadOnly=a,b.trigger("read-only-change",a),e.each(b.blocks,function(b){b.setReadOnly(a)}))},isReadOnly:function(){return this._isReadOnly},_setBlockLocked:function(a,b,c){var d,f=this;d=e.isArray(a)?a:[a],e.each(d,function(d){var g;if(!(g=e.isString(d)?f.getBlockById(d):d))return void o.log("BlockLock: skip non-existing block",a);g.setLocked(b,c)})},lockBlock:function(a,b){this._setBlockLocked(a,!0,b)},unlockBlock:function(a){this._setBlockLocked(a,!1)},_onGetExtraInfo:function(a,b){b(this.getExtraInfo(a))},_onGetDefaultSetFont:function(a){this.trigger("get-default-set-font",function(b){a(b)})},isValidForCollab:function(){return this._isValidForCollab},setValidForCollab:function(a){this._isValidForCollab=a},reset:function(){var a=this;a.destroy(),a._noteId=z.newGUID(),a.headUnknownNodeList=[],a.blocks=[],a.originalBlockIds=[],null!=a._contentParseTimer&&(clearTimeout(a._contentParseTimer),a._contentParseTimer=null),a._header=null,a._footer=null},isBlank:function(){var a=this;return!a.blocks||0===a.blocks.length},getHeaderFooter:function(a){return a?this._footer:this._header},setHeaderFooter:function(a,b,c){b?this._footer=a:this._header=a,c&&this.trigger("header-footer-changed",b)},updateContentParseTimer:function(a){this._contentParseTimer!==a&&(clearTimeout(this._contentParseTimer),this._contentParseTimer=a),null==a&&this.trigger("content-parse-done")},isParsingData:function(){return null!=this._contentParseTimer},hasHandWriteBlock:function(){var a=this,b=!1;return e.some(a.blocks,function(a){return t.isHandWrite(a)&&(b=!0),b}),b}},c={fromXml:function(a,b,f,g){var i,j,k,l,m,q,t={},v={};return b||(b=new d),g=e.defaults(g||{},{progressCallBack:function(){},isAsync:!1}),q=g.progressCallBack,e.isString(a)?(a=C.clear(a),i=h.parseXML(a)):i=a,q({percent:.1}),o.log(i),j=h(i).find("note:first"),k=j.attr("schema-version"),k&&b.setSchemaVersion(k),l=j.attr("file-version"),l=l||0,b.setFileVersion(l),j&&j.get(0)?(j.find("head").children().each(function(a,c){var d,e=c.nodeName;switch(e){case"list":d=p.fromXml(c),t[h(c).attr("id")]=d;break;case"catalogue-wrap":d=r.fromXml(c),v[h(c).attr("id")]=d;break;case"header":d=s.fromXml(c),b.setHeaderFooter(d,!1,!0);break;case"footer":d=s.fromXml(c),b.setHeaderFooter(d,!0,!0);break;default:d=h(c).attr(u.COMPAT),x.isCompatible(d)&&(d=c.cloneNode(!0),b.headUnknownNodeList.push(d))}}),q({percent:.15}),m=j.find("body").children(),c._parseXMLBodyInBatch(m,0,b,t,v,f,q,g.isAsync),b):(b.isBlank()&&b.append(n.createBlank()),q({percent:1}),b.updateContentParseTimer(null),b)},fromHtml:function(a,b,f,g){var h,i=m.parseHtml(a);return b||(b=new d),g=e.defaults(g||{},{progressCallBack:function(){},isAsync:!1}),h=g.progressCallBack,c._parseHTMLInBatch(i,0,b,f,h,g.isAsync)?b:null},fromOCR:function(a,b){var c=m.parseOCR(a),f=0;return b=b||new d,e.each(c,function(a){a&&(b.append(a),f++)}),f?b:null},createBlank:function(a,b){var c=n.createBlank(a);return b||(b=new d),b.append(c),b},_parseHTMLInBatch:function(a,b,d,f,g,h){var i,j,k,l=Date.now(),m=!1,n=d.getExtraInfo("pcTodoMap");if(null==a&&0===a.length)return g({percent:1}),d.updateContentParseTimer(null),!1;for(;b<a.length;)if(i=a[b],t.isImage(i)&&f&&f.length>0&&e.each(f,function(a){if(a.resId===i.getResId())return void i.setImageInfo(a)}),t.isTodo(i)&&i.isFromOldTodo()&&(k=i.getLegacyResId(),k&&n&&n[k]?(i.setText(E(window.JSON.parse(n[k]).content)),i.setChecked(window.JSON.parse(window.JSON.parse(n[k]).checked))):i=null),i&&(d.append(i),m=!0),b++,b>=a.length?(g({percent:1}),d.updateContentParseTimer(null)):g({percent:.15+b/a.length*.85}),h&&Date.now()-l>100){j=setTimeout(c._parseHTMLInBatch.bind(null,a,b,d,f,g,h),10),d.updateContentParseTimer(j);break}return m},_parseXMLBodyInBatch:function(a,b,d,f,g,i,m,n){var o,p,q,r,s,v,w,y,A=Date.now();if(null==a||0===a.length)return m({percent:1}),void d.updateContentParseTimer(null);for(;b<a.length;){if(o=a[b],p=o.nodeName,q=j[p],r=h(o).attr(u.COMPAT),(!q&&x.isCompatible(r)||q&&r&&!x.isCompatible(r))&&(q=l),q&&q.fromXml){if(!(s=q.fromXml(o)))throw d.updateContentParseTimer(null),o;for(v=k.parseResourceList(o),s.setResourceIds(v),t.isListItem(s)&&s.setOwnerList(f[h(o).attr("list-id")]),t.isImage(s)&&i&&i.length>0&&e.each(i,function(a){if(a.resId===s.getResId())return void s.setImageInfo(a)}),t.isCatalogue(s)&&s.setOwnerList(g[h(o).attr("catalogue-id")]),d.append(s),s.isValidForCollab()||d.setValidForCollab(!1),y=s.getId();d.originalBlockIds.indexOf(y)>-1;)y=z.newGUID();y!==s.getId()&&(d.setValidForCollab(!1),s.setId(y)),d.originalBlockIds.push(y)}
if(++b>=a.length)m({percent:1}),d.updateContentParseTimer(null);else if(m({percent:.15+b/a.length*.85}),n&&Date.now()-A>100){w=setTimeout(c._parseXMLBodyInBatch.bind(null,a,b,d,f,g,i,m,n),10),d.updateContentParseTimer(w);break}}}},e.extend(b,f.Events),d=g.extend(b,c)}(),yne_common_util_htmlConvert=function(a){var b=yne_common_data_Note;return{xml2html:function(a){return(b.fromXml(a)||new b).toHtml()},html2xml:function(a){return(b.fromHtml(a)||new b).toXml()},html2html:function(a){return(b.fromHtml(a)||new b).toHtml()}}}(),yne_pc_util_convertHtmlWithResMap=function(a){var b=yne_underscore,c=yne_jtk_web_dom_parseHTML;return function(a,d){if(!a||!d)return a;var e=c(a),f=e.querySelectorAll("img[data-media-type=attachment]"),g=e.querySelectorAll("img[data-media-type=image]"),h=function(a,c){b.each(a,function(a,b){a&&c.setAttribute(b,a)})};return b.each(f,function(a){var b=a.getAttribute("src"),c=a.getAttribute("path"),e=a.getAttribute("filelength"),f=a.getAttribute("filename"),g={"data-res-id":c,src:d[b],"data-attr-org-src-id":b,"data-attr-org-img-file":d[b],"data-file-name":f,"data-file-length":e,class:"editor-attachment"};h(g,a)}),b.each(g,function(a){var b=a.getAttribute("src"),c={src:d[b],"data-attr-org-src-id":b};h(c,a)}),e.innerHTML}}(),yne_common_util_isXml=function(a){var b=yne_jquery;return function(a){return!!a&&(a=b.trim(a+""),/^<\?xml /i.test(a))}}(),yne_common_util_attachmentParse=function(a){var b=yne_underscore;return{getFileType:function(a){if(b.isUndefined(a))return null;var c=a.toLowerCase().split(".");return{table:"table",pdf:"pdf",txt:"txt",text:"txt",mht:"html",doc:"word",docx:"word",excel:"excel",xls:"excel",xlsx:"excel",csv:"excel",ppt:"ppt",pps:"ppt",pptx:"ppt",ppsx:"ppt",flash:"flash",swf:"flash",flv:"flash",compress:"compress",zip:"compress",rar:"compress","7z":"compress",audio:"audio",mp3:"music",aac:"music",ogg:"music",wav:"music",flac:"music",m4a:"music",ape:"music",wma:"music",video:"video",rm:"video",rmvb:"video",avi:"video",mkv:"video",mpg:"video",mpeg:"video",wmv:"video",ts:"video",m4v:"video",mp4:"video",image:"image",jpg:"image",jpeg:"image",gif:"image",png:"image",bmp:"image",md:"md",scan:"scan",html:"html",htm:"html"}[c[c.length-1]]||"other"},getSizeString:function(a){var b=["B","KB","MB","GB","TB"],c=0,d=parseInt(a);if(d=d||0,isNaN(d))return"未知大小";if(d<=0)return"";for(;d>=1024&&c<3;)c++,d/=1024;return String(Math.floor(100*d)/100)+b[c]},splitFileFullName:function(a){if(b.isUndefined(a))return null;var c,d,e=a.lastIndexOf(".");return e<0?(c=a,d=""):0===e?(c="",d=a):(c=a.substring(0,e-1),d=a.substring(e-1)),{fileName:c,fileType:d}},getFileIconByName:function(a){var b="src--svg--type_other_large",c=this.getFileType(a);return c&&(b="src--svg--type_"+c+"_large"),b}}}(),yne_common_util_attachmentPresentProcess=function(a){var b=yne_jquery,c=yne_underscore,d=yne_common_util_attachmentParse;return{processHtmlContent:function(a){var e=a.attr("title")||a.attr("filename");if(e){var f=a.attr("filelength"),g=b('<div class="attachment-container"></div>'),h=d.getFileType(e),i=d.getSizeString(f),j=d.splitFileFullName(e),k=h?"src--svg--type_"+h+"_large":"src--svg--type_other_large",l=b('<div class="attachment-icon svg-common '+k+'"></div>'),m=b('<div class="attachment-title"><p class="attachment-title-name">'+c.escape(j.fileName)+'</p><p class="attachment-title-type">'+c.escape(j.fileType)+"</p></div>"),n=b('<div class="attachment-size">'+i+"</div>");return g.append(l).append(m).append(n),a.replaceWith(g),g}},elementAppendAttchCss:function(a,b){var c=this,d=function(b){a.append("<style>"+b.css+"</style>")};c._loadAttachCssFile(b,d)},getAttachStyle:function(a,b){var c=this,d=function(b){a.innerTag="<style>"+b.css+"</style>"};c._loadAttachCssFile(b,d)},_loadAttachCssFile:function(a,c){var d=this,e="../css/presenter_attachment.less";window.less?d._loadAttachLessFile(e,a,c):b.ajax({url:"../../../node_modules/less/dist/less.js",async:!1===a}).done(function(){d._loadAttachLessFile(e,a,c)})},_loadAttachLessFile:function(a,c,d){b.ajax({url:a,async:!1===c}).done(function(a){window.less.render(a,{sync:!0===c},function(a,b){d(b)})})}}}(),yne_common_util_addPrintStyle=function(a){var b=yne_underscore,c=yne_jquery,d=yne_jtk_core_L,e=yne_jtk_web_dom_parseHTML,f=yne_common_util_attachmentPresentProcess;return function(a){var g=e(a),h=g.querySelectorAll("img[data-media-type=attachment]"),i=g.querySelectorAll("img[data-media-type=image]"),j=g.querySelectorAll("div[yne-bulb-block=paragraph]"),k=g.querySelectorAll("ol"),l=g.querySelectorAll("ul"),m={};return b.each([j,k,l],function(a){b.each(a,function(a){a.style.fontFamily='"宋体", sans-serif',a.style.zoom="1.15"})}),b.each(h,function(a){f.processHtmlContent(c(a))}),b.each(i,function(a){var b,d=c(a);d.attr("alt")&&(b=document.createElement("div"),b.className="img-title",b.appendChild(document.createTextNode(d.attr("alt"))),d.after(b))}),!0===d.DEBUG?f.getAttachStyle(m,!0):c.ajax({url:"./presenter.css",dataType:"text",async:!1}).done(function(a){m.innerTag="<style>"+a+"</style>"}).fail(function(){d.error("load presenter.css file failed")}),a="<head>"+m.innerTag+"</head>"+g.outerHTML}}(),yne_pc_convertor_convertorApi=function(a){var b=yne_common_util_htmlConvert,c=yne_pc_util_convertHtmlWithResMap,d=yne_common_util_isXml,e=yne_jtk_core_L,f=yne_common_util_addPrintStyle;return{content2html:function(a,g,h){var i,j,k,l,m=this;if(e.log("content2html",a,g,h),!g)return void m.trigger("content2html-ok",a,"");if(l=d(g),e.DEBUG)i=l?b.xml2html(g):b.html2html(g);else try{i=l?b.xml2html(g):b.html2html(g)}catch(a){j=a+""}if(j)return void m.trigger("content2html-error",a,j);if(h){try{k=window.JSON.parse(h)}catch(a){k=null}k&&(i=c(i,k))}l&&(i=f(i)),m.trigger("content2html-ok",a,i)}}}(),yne_pc_convertor_main=function(a){var b=yne_jtk_core_L,c=yne_underscore,d=yne_pc_convertor_Bridge,e=yne_jtk_core_Base,f=yne_pc_convertor_convertorApi,g=c.extend({initialize:function(){}},f),h=e.extend(g),i=new h,j=new d({convertor:i});i.on("content2html-ok",function(a,b){j.callNativeApi("OnConvertSuccess",[a,"html",b])}),i.on("content2html-error",function(a,b){j.callNativeApi("OnConvertError",[a,"html",b])}),j.ready(),b.DEBUG&&(window.debugBridge=j)}();